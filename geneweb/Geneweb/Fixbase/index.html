<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Fixbase (geneweb.Geneweb.Fixbase)</title><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">geneweb</a> &#x00BB; <a href="../index.html">Geneweb</a> &#x00BB; Fixbase</nav><header class="odoc-preamble"><h1>Module <code><span>Geneweb.Fixbase</span></code></h1><p>All the function of this module scan the base and fix what is considered as corrupted data.</p><p>They all share a same signature : <code>let check_XXX ?report progress base = ...</code></p><p>The optionnal <code>report</code> function should be used to track changes.</p><p><code>progress i max</code> keep tracks of the progress of a task. When called, task is about <code>i/max</code> done.</p><p>Note that it does not actually commit the changes, so if you do not want a dry run, apply <code>Gwdb.commit_patches</code></p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-patch"><a href="#type-patch" class="anchor"></a><code><span><span class="keyword">type</span> patch</span><span> = </span></code><ol><li id="type-patch.Fix_NBDS" class="def variant constructor anchored"><a href="#type-patch.Fix_NBDS" class="anchor"></a><code><span>| </span><span><span class="constructor">Fix_NBDS</span> <span class="keyword">of</span> <a href="../../Gwdb/index.html#type-iper">Gwdb.iper</a></span></code></li><li id="type-patch.Fix_AddedUnion" class="def variant constructor anchored"><a href="#type-patch.Fix_AddedUnion" class="anchor"></a><code><span>| </span><span><span class="constructor">Fix_AddedUnion</span> <span class="keyword">of</span> <a href="../../Gwdb/index.html#type-iper">Gwdb.iper</a></span></code></li><li id="type-patch.Fix_AddedParents" class="def variant constructor anchored"><a href="#type-patch.Fix_AddedParents" class="anchor"></a><code><span>| </span><span><span class="constructor">Fix_AddedParents</span> <span class="keyword">of</span> <a href="../../Gwdb/index.html#type-iper">Gwdb.iper</a></span></code></li><li id="type-patch.Fix_ParentDeleted" class="def variant constructor anchored"><a href="#type-patch.Fix_ParentDeleted" class="anchor"></a><code><span>| </span><span><span class="constructor">Fix_ParentDeleted</span> <span class="keyword">of</span> <a href="../../Gwdb/index.html#type-iper">Gwdb.iper</a></span></code></li><li id="type-patch.Fix_AddedChild" class="def variant constructor anchored"><a href="#type-patch.Fix_AddedChild" class="anchor"></a><code><span>| </span><span><span class="constructor">Fix_AddedChild</span> <span class="keyword">of</span> <a href="../../Gwdb/index.html#type-ifam">Gwdb.ifam</a></span></code></li><li id="type-patch.Fix_RemovedUnion" class="def variant constructor anchored"><a href="#type-patch.Fix_RemovedUnion" class="anchor"></a><code><span>| </span><span><span class="constructor">Fix_RemovedUnion</span> <span class="keyword">of</span> <a href="../../Gwdb/index.html#type-iper">Gwdb.iper</a> * <a href="../../Gwdb/index.html#type-ifam">Gwdb.ifam</a></span></code></li><li id="type-patch.Fix_RemovedDuplicateUnion" class="def variant constructor anchored"><a href="#type-patch.Fix_RemovedDuplicateUnion" class="anchor"></a><code><span>| </span><span><span class="constructor">Fix_RemovedDuplicateUnion</span> <span class="keyword">of</span> <a href="../../Gwdb/index.html#type-iper">Gwdb.iper</a> * <a href="../../Gwdb/index.html#type-ifam">Gwdb.ifam</a></span></code></li><li id="type-patch.Fix_AddedRelatedFromPevent" class="def variant constructor anchored"><a href="#type-patch.Fix_AddedRelatedFromPevent" class="anchor"></a><code><span>| </span><span><span class="constructor">Fix_AddedRelatedFromPevent</span> <span class="keyword">of</span> <a href="../../Gwdb/index.html#type-iper">Gwdb.iper</a> * <a href="../../Gwdb/index.html#type-iper">Gwdb.iper</a></span></code></li><li id="type-patch.Fix_AddedRelatedFromFevent" class="def variant constructor anchored"><a href="#type-patch.Fix_AddedRelatedFromFevent" class="anchor"></a><code><span>| </span><span><span class="constructor">Fix_AddedRelatedFromFevent</span> <span class="keyword">of</span> <a href="../../Gwdb/index.html#type-iper">Gwdb.iper</a> * <a href="../../Gwdb/index.html#type-iper">Gwdb.iper</a></span></code></li><li id="type-patch.Fix_MarriageDivorce" class="def variant constructor anchored"><a href="#type-patch.Fix_MarriageDivorce" class="anchor"></a><code><span>| </span><span><span class="constructor">Fix_MarriageDivorce</span> <span class="keyword">of</span> <a href="../../Gwdb/index.html#type-ifam">Gwdb.ifam</a></span></code></li><li id="type-patch.Fix_MissingSpouse" class="def variant constructor anchored"><a href="#type-patch.Fix_MissingSpouse" class="anchor"></a><code><span>| </span><span><span class="constructor">Fix_MissingSpouse</span> <span class="keyword">of</span> <a href="../../Gwdb/index.html#type-ifam">Gwdb.ifam</a> * <a href="../../Gwdb/index.html#type-iper">Gwdb.iper</a></span></code></li><li id="type-patch.Fix_WrongUTF8Encoding" class="def variant constructor anchored"><a href="#type-patch.Fix_WrongUTF8Encoding" class="anchor"></a><code><span>| </span><span><span class="constructor">Fix_WrongUTF8Encoding</span> <span class="keyword">of</span> <span><a href="../../Gwdb/index.html#type-ifam">Gwdb.ifam</a> option</span>
  * <span><a href="../../Gwdb/index.html#type-iper">Gwdb.iper</a> option</span>
  * <span><span>(<a href="../../Gwdb/index.html#type-istr">Gwdb.istr</a> * <a href="../../Gwdb/index.html#type-istr">Gwdb.istr</a>)</span> option</span></span></code></li><li id="type-patch.Fix_UpdatedOcc" class="def variant constructor anchored"><a href="#type-patch.Fix_UpdatedOcc" class="anchor"></a><code><span>| </span><span><span class="constructor">Fix_UpdatedOcc</span> <span class="keyword">of</span> <a href="../../Gwdb/index.html#type-iper">Gwdb.iper</a> * int * int</span></code></li></ol></div><div class="spec-doc"><p>All possible patches that could be automatically deducted from inconsistent or absent information in the database</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_NBDS"><a href="#val-check_NBDS" class="anchor"></a><code><span><span class="keyword">val</span> check_NBDS : 
  <span>?report:<span>(<span><a href="#type-patch">patch</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Gwdb/index.html#type-base">Gwdb.base</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>For every person in the base synchronise his birth, death, baptism and burial events with his fields and vice versa.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_families_parents"><a href="#val-check_families_parents" class="anchor"></a><code><span><span class="keyword">val</span> check_families_parents : 
  <span>?report:<span>(<span><a href="#type-patch">patch</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Gwdb/index.html#type-base">Gwdb.base</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>For every family's parent in the base add current family to the parent's union if absent.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_families_children"><a href="#val-check_families_children" class="anchor"></a><code><span><span class="keyword">val</span> check_families_children : 
  <span>?report:<span>(<span><a href="#type-patch">patch</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Gwdb/index.html#type-base">Gwdb.base</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>For every family's children in the base add current family to the children's ascendants if absent. Doesn't modify consanguinity rate.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_persons_parents"><a href="#val-check_persons_parents" class="anchor"></a><code><span><span class="keyword">val</span> check_persons_parents : 
  <span>?report:<span>(<span><a href="#type-patch">patch</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Gwdb/index.html#type-base">Gwdb.base</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>For every person checks their ascendants. If it references to the dummy family, then remove this reference. Otherwise add the person to the family's children if absent.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_persons_families"><a href="#val-check_persons_families" class="anchor"></a><code><span><span class="keyword">val</span> check_persons_families : 
  <span>?report:<span>(<span><a href="#type-patch">patch</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Gwdb/index.html#type-base">Gwdb.base</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>For every person in the base removes all duplicate families and families where person isn't a parent.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_pevents_witnesses"><a href="#val-check_pevents_witnesses" class="anchor"></a><code><span><span class="keyword">val</span> check_pevents_witnesses : 
  <span>?report:<span>(<span><a href="#type-patch">patch</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Gwdb/index.html#type-base">Gwdb.base</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>For every person's event's witness add current person to the list of related of the witness if absent.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_fevents_witnesses"><a href="#val-check_fevents_witnesses" class="anchor"></a><code><span><span class="keyword">val</span> check_fevents_witnesses : 
  <span>?report:<span>(<span><a href="#type-patch">patch</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Gwdb/index.html#type-base">Gwdb.base</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>For every family's event's witness add family's father to the list of related of the witness if absent.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fix_marriage_divorce"><a href="#val-fix_marriage_divorce" class="anchor"></a><code><span><span class="keyword">val</span> fix_marriage_divorce : 
  <span>?report:<span>(<span><a href="#type-patch">patch</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Gwdb/index.html#type-base">Gwdb.base</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>For every family in the base synchronise its fields with marriage and divorce events.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fix_missing_spouses"><a href="#val-fix_missing_spouses" class="anchor"></a><code><span><span class="keyword">val</span> fix_missing_spouses : 
  <span>?report:<span>(<span><a href="#type-patch">patch</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Gwdb/index.html#type-base">Gwdb.base</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>For every family, if a parent refers to a person dummy person (with dummy iper). Fix this person and add the family to their union list. If this situation happens, an explaination is that the person has been incorrectly deleted, instead of just erasing their personal details.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fix_utf8_sequence"><a href="#val-fix_utf8_sequence" class="anchor"></a><code><span><span class="keyword">val</span> fix_utf8_sequence : 
  <span>?report:<span>(<span><a href="#type-patch">patch</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Gwdb/index.html#type-base">Gwdb.base</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>For every person's and family's field, remplace it with normalized UTF8 version.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fix_key"><a href="#val-fix_key" class="anchor"></a><code><span><span class="keyword">val</span> fix_key : 
  <span>?report:<span>(<span><a href="#type-patch">patch</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Gwdb/index.html#type-base">Gwdb.base</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>For every person in the base, update their occurence number if someone with same key (normalized first name and last name, and occurence number) already exists.</p></div></div></div></body></html>