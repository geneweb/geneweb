<!-- $Id: perso_module/siblings.txt v 7.00 13/01/2017 16:51:21 hg -->
%( op_m=1 simple: name %)
%( op_m=2 complete: name, marriages %)
%( op_m=3 photos: complete with photo %)

%let;op_m;%if;(op_m!="")%op_m;%else;1%end;%in;
%let;op_fl;1%in; %( flèche frère suivant %)

%if;((op_m=1 or op_m=2 or op_m=3) and has_siblings)
  <h3 class="highlight">
    %if;(bvar.full_siblings="yes")
      [*full siblings]%nn;
    %else;
      [*siblings]%nn;
    %end;
    %reset_count;
    %if;(op_fl=1 and evar.cgl!="on")
      %foreach;father.child;
        %if;is_sibling_before;
          %incr_count;
          <a class="ml-2" href="%prefix;%child.access;" title="%apply;capitalize(nth([previous sibling],sex))"><span class="fa fa-caret-left text-success"></span></a>%nn;
        %end;
      %end;
      %if;(count=0)<span class="fa fa-caret-left invisible"></span>%end;
      <a href="%prefix;i=%father.index;;m=D;t=T;v=1;image=on"><img class="mx-1" src="%image_prefix;/gui_create.png" height="18" style="margin-bottom:6px" alt="Tree"/></a>%nn;
      %if;((p_mod="" or p_mod="zz") and has_parents)
        %if;(not cancel_links)
          <a class="" data-toggle="collapse" href="#collapseExample2" aria-expanded="false" aria-controls="collapseExample2" title="[*visualize/show/hide/summary]1/[visualize/show/hide/summary]2 [ascendants tree]">%nn;
            <sup><i class="fa fa-caret-up text-success"></i></sup></a>
        %end;
      %end;
      %foreach;father.child;
        %if;is_sibling_after;
            <a href="%prefix;%child.access;" title="%apply;capitalize(nth([next sibling],sex))"><span class="fa fa-caret-right text-success"></span></a>
        %end;
      %end;
    %end;
  </h3>
  <ul>
    %let;cur;%index;%in;
    %foreach;father.child;
      %if;(bvar.full_siblings="yes")
        %if;(op_m=1)
          %if;(bvar.always_surname="yes")
            %apply;short_display_siblings()
          %else;
            %apply;short_display_siblings_noname()
          %end;
        %elseif;(op_m=2)
          %apply;long_display_siblings()
        %elseif;(op_m=3)
          %apply;display_sibling()
        %end;
      %else;
        %if;(index!=cur)
          %if;(op_m=1)
            %if;(bvar.always_surname="yes")
              %apply;short_display_siblings()
            %else;
              %apply;short_display_siblings_noname()
            %end;
          %elseif;(op_m=2)
            %apply;long_display_siblings()
          %end;
        %end;
      %end;
    %end;
  </ul>
%end;
%(aaa %father.nb_families;, %mother.nb_families;<br>%)
%reset_count;
%foreach;father.family;
    %if;(spouse.index!=mother.index)
        %if;(nb_children>0)%incr_count;%end;
    %end;
%end;
%let;half_father;%count;%in;
%reset_count;
%foreach;mother.family;
    %if;(spouse.index!=father.index)
        %if;(nb_children>0)%incr_count;%end;
    %end;
%end;
%let;half_mother;%count;%in;
%(aaa2 %half_father;, %half_mother;<br>%)

%if;(op_m=1 and (half_father != 0 or half_mother != 0))
  <h3 class="highlight">[*half siblings]</h3>
  %if;(half_father != 0)
        [*on %s's side:::] %apply;short_display_person("father")
      %if;(father.nb_families > 1 and half_father != 0)
        %foreach;father.family;
          %if;(spouse.index!=mother.index and half_father!=0 and spouse.has_children)
            <ul>
              %apply;li_SD("spouse")
                [with] %apply;short_display_person("spouse")
                %if;has_children;
                  <ul>
                    %foreach;child;
                      %apply;short_display_siblings()
                    %end;
                  </ul>
                %end;
              </li>
            </ul>
          %end;
        %end;
      %end;
  %end;
  %if;(half_mother != 0)
        [*on %s's side:::] %apply;short_display_person("mother")
      %if;(mother.nb_families > 1 and half_mother != 0)
        %foreach;mother.family;
          %if;(spouse.index!=father.index and half_mother!=0 and spouse.has_children)
            <ul>
              %apply;li_SD("spouse")
                [with] %apply;short_display_person("spouse")
                %if;has_children;
                  <ul>
                    %foreach;child;
                      %apply;short_display_siblings()
                    %end;
                  </ul>
                %end;
              </li>
            </ul>
          %end;
        %end;
      %end;
    %end;
<!--  perso_module/freresoeur_complet (deux listes de demi frères côte à côte) -->
%elseif;(op_m=2 and (half_father != 0 or half_mother != 0))
  <table style="border:%border;;width:100%">
      <tr>
        %if;(half_father != 0)
          <td style="width:47%%;vertical-align: top">
            [*on %s's side:::] %apply;long_display_person("father")
          </td>
          <td style="width:6%%;vertical-align: top">&nbsp;</td>
        %end;
        %if;(half_mother != 0)
          <td style="width:47%%;vertical-align: top">
            [*on %s's side:::] %apply;long_display_person("mother")
          </td>
        %end;
      </tr>
      <tr>
        %if;(father.nb_families > 1 and half_father != 0)
          <td style="vertical-align: top">
            %foreach;father.family;
              %if;(spouse.index!=mother.index and half_father!=0 and spouse.has_children)
                <ul>
                  %apply;li_SD("spouse")
                    [with] %apply;long_display_person("spouse")
                  </li>
                  %if;has_children;
                    <li class="list-unstyled"><ul>
                      %foreach;child;
                        %apply;long_display_siblings()
                      %end;
                    </ul></li>
                  %end;
                </ul>
              %end;
            %end;
          </td>
          <td></td>
        %end;
        %if;(mother.nb_families > 1 and half_mother != 0)
          <td style="vertical-align: top">
            %foreach;mother.family;
              %if;(spouse.index!=father.index and half_mother!=0 and spouse.has_children)
                <ul>
                  %apply;li_SD("spouse")
                    [with] %apply;long_display_person("spouse")
                  </li>
                  %if;has_children;
                    <li class="list-unstyled"><ul>
                      %foreach;child;
                        %apply;long_display_siblings()
                      %end;
                    </ul></li>
                    %end;
                </ul>
              %end;
            %end;
          </td>
        %end;
      </tr>
    </table>
<!--  Freres et soeurs complet photo (from templf) -->
%elseif;(op_m=3 and (half_father != 0 or half_mother != 0))
  <table style="border-width:%border;;width:100%%">
    <tr>
      %foreach;parent;
        %if;(parent.nb_families>1)
          <td style="width:47%%">
            %apply;display_shared_parent%with;
            %apply;image_MF("parent","13")
            %apply;short_display_person("parent")%end;
          </td>
        %end;
        %if;(not is_last)
          <td style="width:6%%;vertical-align: top">&nbsp;</td>
        %end;
      %end;
    </tr>
    <tr>
      %if;(father.nb_families>1)
        <td style="vertical-align: top">
          %foreach;father.family;
            %if;(spouse.index!=mother.index)
              %apply;list_half_siblings()
            %end;
          %end;
        </td>
      %end;
      %if;(mother.nb_families>1)
        <td style="vertical-align: top">
          %foreach;mother.family;
            %if;(spouse.index!=father.index)
              %apply;list_half_siblings()
            %end;
          %end;
        </td>
      %end;
    </tr>
  </table>
%end;
