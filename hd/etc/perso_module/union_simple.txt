<!--  Union simple -->

%define;relations_tree(z1)
    %reset_count;
    href="%prefix;spouse=on;m=RLM;image=%evar.image;;%nn;
    %foreach;witness;
        %incr_count;i%count;=%witness.index;;t%count;=[marriage event];%nn;
        %incr_count;i%count;=z1;%nn;
        %end;
    %incr_count;i%count;=%index;;t%count;=%if;(sex=0)[him/her]0%elseif;(sex=1)[him/her]1%else;0%end;%nn;
    %if;browsing_with_sosa_ref;
        %incr_count;i%count;=%sosa_ref.index;;t%count;=sosa_1;%nn;
    %end;
    " title="[*relations tree]"
     %reset_count;
%end;

%define;list_witness_of_kind(kindx)
  %reset_count;
  %foreach;event_witness;
  %if;(event_witness_kind = [kindx]0)
    %incr_count;
  %end;
  %end;
  %let;k_cnt;%count;%in;
  %if;(k_cnt>0)
  %if;(k_cnt=1)[*kindx]0%else;[*kindx]1%end;[:]%sp;
  %end;
  %reset_count
  %foreach;event_witness;
  %if;(event_witness_kind = [kindx]0)
    %incr_count;
    %apply;short_display_person("event_witness")
    %if;(count=k_cnt).
    %else;
      %if;(count=k_cnt-1)%sp;[and]%sp;%else;,%sp;%end;
    %end; 
  %end;
  %end;
%end;

%reset_count;
%define;test_templ(ix)
  %if;(bvar.module_perso_ix="timeline")%incr_count;%end;
%end;

%if;(bvar.module_perso_tplnb!="" and bvar.module_perso_tplnb>0)
  %for;i;0;bvar.module_perso_tplnb;
    %apply;test_templ(i)
  %end;
%end;
%let;timeline;%if;(count>0)yes%else;no%end;%in;
%if;has_families;
  <h3 class="highlight">[*family/families]0%if;(evar.cgl!="on")<a href="%prefix;%suffix;m=D;t=T;v=2;image=on"><img class="ml-2" src="%image_prefix;/gui_create.png" height="20" style="margin-bottom:6px" alt="tree desc."/></a>%end;</h3>
  <ul class="marriage_perso">
    %( On remet les compteurs à zéro et on commence à compter à 1 %)
    %reset_count; %incr_count;
    %foreach;family;
      %apply;li_SD("spouse")
        %if;(wizard)
          <a href="%prefix;m=MOD_FAM;i=%family.index;;ip=%index;">
            <img class="mr-1" src="%image_prefix;/picto_molette.png" width="13" height="13" alt="[modify::family/families]0" title="[modify::family/families]0"%/>%nn;
          </a>%nn;
        %end;
        %apply;long_married("self")%sp;
        %apply;short_display_person("spouse")
        %if;(has_witnesses)
          %sp;([witness/witnesses]w[:]
          %foreach;witness;%( witness_kind ne marche pas dans ce contexte !! fwitness non plus %)
            %if;not is_first;, %end;
            %apply;short_display_person("witness")
          %end;
          %if;(evar.cgl!="on")<a %apply;relations_tree(index)><img class="ml-1" src="%image_prefix;/gui_create.png" height="15" alt="tree"/></a>%nn;
          %end;)%nn;
        %end;
        %if;((wizard or friend or bvar.no_note_for_visitor="" or bvar.no_note_for_visitor="no") and has_comment)
          &nbsp;%[[see] <a href="#note-wed-%count;" id="wed-callnote-%count;">[note/notes]0</a>]%nn;
          %incr_count;
        %end;
        %if;are_divorced;, [divorced]0%divorce_date;%end;
        %if;are_separated;, [separated]0%sp;%end;
        %if;has_children;,%sp;[having as children]0[:]
          %( On sauvegarde l'ancienne valeur de count %)
          %let;prev_count;%count;%in;
          <ul>
            %foreach;child;
              %apply;li_SDC("child")
                %apply;image_MF("child","13")
                %apply;short_display_person("child")
              </li>
            %end;
          </ul>
          %( On rétablie l'ancienne valeur de count %)
          %apply;init_count(prev_count)
        %end;
        %if;(evar.opt = "from" and wizard)<em>(%origin_file;)</em><br%/>%nl;%end;
      </li>
    %end;
  </ul>
%end;
