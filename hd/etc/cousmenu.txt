<!DOCTYPE html>
<html lang="%lang;">
<head>
  <!-- $Id: cousmenu.txt, v7.1 24/11/2022 02:36:23 ddr a2 Exp $ -->
  <!-- Copyright (c) 1998-2023 INRIA -->
  <title>%nn;
   [*relationship link between]%sp;
      %if;(public_name != "")%public_name;%else;%first_name;%end;
      %if;(qualifier != "") %qualifier;%end;
      %sp;%surname;
  </title>
  <meta name="robots" content="none">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  %include;favicon
  %include;css
  %include;hed
</head>
<body%body_prop;>
%message_to_wizard;
<div class="container%if;(e.v!="" and e.v>8)-fluid%end;">
%include;perso_utils
%include;menubar
  <h1>%nn;
    [*link between]%sp;
    %if;(public_name != "")%public_name;%else;%first_name;%end;
    %if;(qualifier != "") <em>%qualifier;</em>%end;
    %sp;%surname;
    %(%if;(alias != "") <em>(%alias;)</em>%end;%)
    %sp;[and] [close family]
  </h1>
%let;min;%if;(not has_children)1%else;0%end;%in;
%let;max;%if;(bvar.max_anc_level!="" and bvar.max_anc_level<max_anc_level)%bvar.max_anc_level;%elseif;(static_max_anc_level!="")%static_max_anc_level;%end;%in;
%define;picklvl(vvv)
  <a role="button" class="btn btn-light btn-sm%if;((e.v="" and vvv=3) or (e.v!="" and e.v=vvv)) disabled font-weight-bold%end;" href="%url_set.v.vvv;"%sp;
  title="[*ascending/descending (degree)]0 vvv%if;(vvv=0) ([self])%end;">vvv</a>%nn;
%end;
<div class="col-auto d-flex justify-content-between btn-toolbar px-3" role="toolbar" aria-label="button to select max ascending level">
  <div class="ml-auto py-0 btn-group%if;(e.v!="" and e.v>3) mr-4%end; flex-wrap" role="group" aria-label="button v from 0 to max">
    %for;i;min;max;%apply;picklvl(i)%end;
  </div>
</div>
%define;cousin_lex_tt(vvv,www)
  %( condition pour garder la tooltip (title="") vide si elle n'est pas définie pour la langue en cours %)
  %if;([cousins.vvv.www tt]!="[cousins.vvv.www tt]")[cousins.vvv.www tt]1%else;%end;
%end;
%empty_sorted_listc;
%define;list_ancestor(vvv)
  %( TODO remove implexes %)
  %reset_count1;%reset_count2;
  %foreach;ancestor_level;
    %if;(level=vvv+1)
      %foreach;ancestor;
        %( add ancestor index to listc>item.1 to filter it afterwards with indexes of cousins
        same cousin.l1.0 instead of ancestor loop but it's not ignoring unknown "? ?" %)
        %if;(ancestor!="? ?")%apply;add_in_sorted_listc(ancestor.index)%end;
        %incr_count1;
        %(%if;(is_first)<span class="text-nowrap">%nn;
        %else;
          %if;(count1%2=1)%if;(ancestor="? ?")%incr_count2;%else;</span> <span class="text-nowrap">%end;%end;
        %end;
        %if;(count1%2=0 and ancestor!="? ?" and count2!=1) & %end;
        %if;(ancestor!="? ?")%ancestor;%end;
        %if;(count1%2=0)%reset_count2;%if;(not is_last) • %else;</span>%end;%end;%)
      %end;
    %end;
  %end; 
%end;
%define;link(vvv,lll,ttt,ddd,ccc)
 %let;evarv;%if;(e.v="")3%else;%e.v;%end;%in;
 %let;width;%expr((100/(evarv+1))*vvv)%in;
 %if;("ddd"="disabled" and vvv!=0)
 %else;
   <td%if;(vvv>0) colspan="%expr(vvv+1)"%end; %if;(vvv=0)style="width:%expr(100/lll)%%"%end; class="table-%if;(vvv=0)info%elseif;(vvv %2 = 1)primary%else;danger%end;" >
     <div class="%if;(vvv>=0)border-right %(border-bottom %)border-%if;(i=0)success%elseif;(vvv%2=1)primary%else;danger%end;%end; d-flex flex-column justify-content-between">
       <div class="%(font-weight-bold%)">vvv/0</div>
       <a role="button" href="%prefix;%access;&m=C&v1=vvv&v2=0"
        class="btn btn-light ddd w-100" style="height:80px;"
         data-toggle="tooltip" data-html="true" title="%apply;cousin_lex_tt(vvv,0)">
         %if;(vvv=0)<span class="badge badge-xl badge-success">1</span>%incr_count;%end; ttt%nn;
         <div class="d-flex justify-content-center"><div class="mt-1 mx-3 small text-muted">%apply;list_ancestor(vvv)</div></div></a>
      %(<div>%expr(100/.(2^vvv)) %%</div>%)
      </div>
    </td>
  %end;
%end;
%define;one_ancestor(vvv,ttt)
  %reset_count1;%reset_count2;
    %foreach;ancestor_level;
      %if;(level=vvv+1)
        %foreach;ancestor;
          %incr_count2;
          %if;(ancestor!="? ?")%incr_count;%else;%incr_count1;%end;
        %end;
      %end;
    %end;
  %apply;link%with;vvv%and;%and;<span class="badge badge-xl badge-%if;(vvv %2 = 1)primary%else;danger%end;"> %expr(count2-count1)</span> ttt%and;%if;(count2=0)disabled%end;%and;%end;
%end;
%define;link_cousin(vvv,www,ttt,sss)
  %let;cousins_vvv_www_float;%cous_paths_cnt.vvv.www;%in;
  %let;cousins_vvv_www;%expr(cousins_vvv_www_float)%in;
  %(%let;cousins_vvv_www;%expr(cousins_vvv_www_float/.1)%in;%)
  <button type="button" data-toggle="tooltip" data-html="true" title="sss" class="flex-shrink-1 btn btn-light%if;(cousins_vvv_www!="" and cousins_vvv_www=0) disabled%end; position-relative" style="height:80px"><div class="stretched-link h-100" data-toggle="modal" data-target="#modal_vvv_www">%nn;
    %let;cousins_paths_vvv_www;%expr(cous_paths_cnt.vvv.www)%in;
    <span class="badge badge-xl badge-%if;(vvv=0)info%elseif;(vvv%2=1)primary%else;danger%end;">%cousins_vvv_www;</span>%nn;
    %if;(cousins_paths_vvv_www!=0)+<span class="badge badge-xl badge-info">%cousins_paths_vvv_www;</span>%end;
    %for;i;0;cousins_paths_vvv_www;%incr_count3;%end;
    <br>ttt</div></button>%(<div>%if;(vvv=0)%expr((100/.(2^(vvv+www))))%else;%expr((100/.(2^(vvv+www-1))))%end; %%</div>%)
    %for;i;0;cousins_vvv_www;%incr_count;%end;
%end;
%define;cousin_lex(vvv,www)
  [cousins.vvv.www]1
%end;
%define;index(ppp,vvv,xxx)
 %ppp_of_index.vvv.xxx;
%end;
%empty_sorted_list;
%empty_sorted_listb;
%define;cous_mod(vvv,www)
<div class="modal fade" id="modal_vvv_www" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title self-align-center">%cous_paths_cnt.vvv.www; paths pour ~½ %if;(cous_paths_cnt.vvv.www=1)[cousins.vvv.www]0%else;[cousins.vvv.www]1%end;%(<small class="text-muted">%cous_paths_cnt.vvv.www; paths !</small> identique depuis changement d'hier %)
        </h4>
        <div>vvv/www</div>
      </div>
      <div class="modal-body">
        %if;(www=0)
          %( copier liste des ancêtres de cousins.txt? %)
        %else;
          <ul class="card-columns"%if;(cous_paths_cnt.vvv.www>135) style="column-count:7"%elseif;(cous_paths_cnt.vvv.www>90) style="column-count:5"%elseif;(cous_paths_cnt.vvv.www>45) style="column-count:3"%end;>
            %empty_sorted_list;
            %empty_sorted_listb;
            %cous_paths.vvv.www;
            %foreach;cous_path;
              %apply;add_in_sorted_list%with;%cousin.surname; %cousin.first_name %cousin.occ;%and;%nn;
                <li class="list-group-item d-flex justify-content-%(%if;(cousin.nbr=2)start%else;between%end;%) align-items-center%( nbr_%cousin.nbr;%)"%( title="%cousin.first_name;.%cousin.occ; %cousin.surname;"%)>%nn;
                  <a href="%prefix;m=RL&i=%cousin.anc.index;&l1=vvv&i1=%self.index;&l2=www&i2=%cousin.index;"%sp;
                  %( comme cousin.anc.index est différent pas de filtrage des doublons possible > m=RL avec un ifam? ... %)
                  %( pu de %nbr; pour le moment > &dag=on ajouté en bouton sur relmenu %)
                  class="stretched-link" data-toggle="tooltip" data-html="true"
                     title='%(%cousin.anc.first_name; %cousin.anc.surname;%)
                     %cousin.anc_f_index; | 
                    %sp;&%apply;index("f", cousin.anc_f_index, "marriage_date")%sp;'>
                    %cousin.surname; %cousin.first_name;%cousin.dates;</a>
                  %(%if;(cousin.nbr=1 or cousin.nbr>2)
                    <div class="">
                    <span class="badge badge-%if;(cousin.nbr%2=1)primary%else;success%end; badge-pill">
                    <a href="%prefix;em=R&et=A&ei=%self.index;&i=%cousin.index;" title="graphe de parenté">%cousin.nbr;</a></span>
                    </div>
                  %end;%)
               </li>%and;%nn;
                %cousin.index;%end;
              %apply;add_in_sorted_listb%with;%cousin.index;%end;
              %apply;add_in_sorted_listc%with;%cousin.index;%end;
            %end;
            listb %listb_size; cousins !
            %foreach;sorted_list_item;%item.2;%end;
          </ul>
        %end;
      </div>
      <div class="modal-footer">
        %( TODO : buttons to filter/highligh/afficher f(number of common ancestors nca) 
          ça déconne on voudrait que les entrées pour les nbr existants list item.5 : 1 2 3 4 6 
          mais on pu de liste ni de count… pour trier. sauf en faisant une bidouille à la vider et la remplir derrière.. %)
              <a role="button" class="btn btn-primary"
                title="filter by nbr = 1 (half ½ [parente]">1</a>
                <a role="button" class="btn btn-primary"
                title="filter by nbr = 2* (1 ancêtre+1 ancêtre)">2*</a>
               <a role="button" class="btn btn-primary"
                title="filter by nbr = 2 (même couple le plus courant)">2</a>
                <a role="button" class="btn btn-primary"
                title="filter by nbr > 2"> + 2</a>
        <a role="button" href="%prefix;%access;&m=C&v1=vvv&v2=www" class="btn btn-primary"><i class="fa-solid fa-wave-square"></i> Détail des chemins c(vvv,www)</a>
        <a role="button" href="%prefix;m=RLM%foreach;sorted_list_item;&i1=%self.index;&i%expr(item.3+1)=%item.4;%end;&t1=[cousins.vvv.www]" class="btn btn-primary">Graphe RLM</a>
        %(<a role="button" class="disabled" href="%prefix;m=RLM%foreach;sorted_list_item;&i1=%self.index;&i%expr(item.3+1)=%item.4;%end;&spouse=on&t1=[cousins.vvv.www]" class="btn btn-primary">Graphe RLM with spouses</a>%)
      </div>
    </div>
  </div>
</div>
%end;

%( table of cousins.i.j-vvv+i (i.k),  
   table size v (asc) × v+%cousins.max_d; (desc) %)
%define;table(xxx)
  %let;max;%expr(cousins.max_d+xxx)%in;
  <table id="quickrel" class="table table-responsive-sm text-center mb-0 mt-3">
    %for;j;1;max;
      <tr>%nn;
        %for;i;0;xxx;
          %let;k;%expr(j+i-xxx)%in;
          %if;(i!=0 and k=0)
            %apply;one_ancestor%with;%i%and;%apply;cousin_lex(i,0)%end;
          %elseif;(k<0)
            %(%if;(i!=0)
              <td class="border-0"></td>
            %end;%)
          %else;
             %if;(i=0 and j=xxx)
               %apply;link%with;0%and;j%and;
               <b>%if;is_male;[him/her]0%elseif;is_female;[him/her]1%end;</b>%nn;
               %and;disabled%and;%end;
             %else;
               <td %if;(j=xxx)style="width:%expr(100/xxx)%%"%end; class="table-%if;(i=0)info%elseif;(i %2 = 1)primary%else;danger%end;">
                 <div class="%if;(i>=0)border-right %(border-bottom %)border-%if;(i=0)success%elseif;(i%2=1)primary%else;danger%end;%end; d-flex flex-column justify-content-between">
                   <span class="%(font-weight-bold %)">%i;/%k</span>
                   %apply;link_cousin%with;%i;%and;%k;
                     %and;%apply;cousin_lex(i,k)
                     %and;%apply;cousin_lex_tt(i,k)
                   %end;
                 </div>
                 %let;tot;%apply;cous(i,k)%in;
                 %if;(tot!=0)%apply;cous_mod(i,k)%end;
               </td>%nn;
             %end;
          %end;
        %end;
      </tr>
    %end;
    <tr><td colspan="%xxx;">[coefficient of relationship]<br>[half DNA]<br>[one ancestor counted]</td></tr>
  </table>
%end;
%reset_count;%reset_count3;
%if;(e.v="")
  %apply;table(7)
%else;
  %apply;table(e.v+1)
%end;
%let;paths;%expr(count+count3)%in;
Total[:] %count; %if;(count=1)[person/persons]0%else;[person/persons]1%end;%if;(count3>0) (+ <span class="badge badge-info">%count3;</span> = %paths; %if;(paths=1)[path/paths]0%else;[path/paths]1%end;)%end;. (# ascendants +  # descendants + #cousins > devrait valoir %listc_size; (listc))
%(Listc_size =  comptage de la liste des indexes des ascendants + des cousins.l1.l2, on peut éventuellement lui fournir les cousins.l1.0 ascendants : c’est le nombre d'individus uniques dans le tableau ça devrait être la même valeur que la somme des comptages %)

%(TODO : play with sorted_listb! 
<div class="d-flex flex-wrap">
indexes des cousins à nbr=1 et nbr>2 :
%foreach;sorted_listb_item;
  %if;(item.2!=2)
    %if;(item.2=1)%item.1;-%nn;
    %elseif;(item.2 > 2)<span class="bg-light">%item.2;×i%item.1;-</span>%end;
  %end;
%end;
</div>
%foreach;sorted_listb_item;%item.2;%end; %)
%include;trl
%include;copyr
</div>
%include;js
<script>
$(function () {
  $('[data-toggle="tooltip"]').tooltip()
})
$(function () {
  $('[data-toggle="popover"]').popover()
})
</script>
</body>
</html>
