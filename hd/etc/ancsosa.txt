<!DOCTYPE html>
<html lang="%lang;">
<head>
  <!-- $Id: ancsosa.txt,v7.00 02/03/2018 05:16:40 $ -->
  <!-- Copyright (c) 1998-2017 INRIA -->
  <title>%nn;
    %if;(evar.t = "D")
      [*ancestors] ... [up to] ...%nn;
    %elseif;(evar.t = "N" and evar.only = "on")
      [*generation/generations]0 %evar.v;
    %else;
      %apply;a_of_b%with;
        %if;(evar.t = "M")
          %if;(evar.evt = "on")[*missing events]%else;[*missing ancestors]%end;
        %else;[*ancestors]
        %end;
      %and;
        %if;(public_name != "")%public_name;%else;%first_name;%end;
        %if;(qualifier != "") %qualifier;%end;
        %sp;%surname;
      %end;
      %if;(evar.cgl="on")
        %let;nb_gen;%apply;min(evar.v, max_anc_level)%in;
        %apply;togen(nb_gen).
      %end;
    %end;
  </title>
  <meta name="robots" content="none">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="shortcut icon" href="%image_prefix;/favicon_gwd.png">
%include.css;
%base_header;
</head>
<body%body_prop;>
%message_to_wizard;
<div class="container-fluid">

%if;not cancel_links;
  %import;menubar;
%end;

%let;central_index;%index;%in;

%define;tothegen(xx)
  [to the %s generation:::xx]%nn;
%end;

%define;thegen(xx)
  [*the %s generation:::xx]%nn;
%end;

%define;togena(xx)
  %if;(xx = 1)[specify::generation/generations]0%nn;
  %elseif;(xx = 2)[to the parents]%nn;
  %elseif;(xx = 3)[to the grandparents]%nn;
  %elseif;(xx = 4)[to the great-grandparents]%nn;
  %else;
    %apply;tothegen%with;
      %apply;nth([nth (generation)], xx)
    %end;
  %end;
%end;

%define;togen(xx)
  %if;(xx = 1)[specify::generation/generations]0%nn;
  %elseif;(xx = 2)[to the parents]%nn;
  %elseif;(xx = 3)[to the grandparents]%nn;
  %elseif;(xx = 4)[to the great-grandparents]%nn;
  %else;
    %apply;tothegen%with;
      %apply;nth([nth (generation)], xx)
    %end;
  %end;
%end;

%define;gen(xx)
  %if;(evar.xx = 1)[*specify::generation/generations]0%nn;
  %elseif;(evar.xx = 2)[*the parents]%nn;
  %elseif;(evar.xx = 3)[*the grandparents]%nn;
  %elseif;(evar.xx = 4)[*the great-grandparents]%nn;
  %else;
    %apply;thegen%with;
      %apply;nth([nth (generation)], evar.xx)
    %end;
  %end;
%end;

%define;image_MF(xx)
  %if;(wizard and not cancel_links)
    <a href="%prefix;m=MOD_IND;i=%xx.index;" title="[*modify::] %xx.first_name;%if;(xx.occ!="0").%xx.occ;%end; %xx.surname;">
  %end;
  %if;xx.is_male;
    <i class="fa fa-mars male mr-1"></i>%nn;
  %elseif;xx.is_female;
    <i class="fa fa-venus female mr-1"></i>%nn;
  %else;
    <i class="fa fa-neuter neuter mr-1"></i>%nn;
  %end;%nn;
  %if;(wizard and not cancel_links and not xx.is_restricted)</a>%end;
%end;

%define;letter(xx)
  %apply;nth%with;
    /a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y/z
  %and;xx%end;
%end;

%define;living_interval_dates(xxx, yyy)
  %if;(evar.after != "" and evar.before != "")
    ,%sp;[living between %s and %s:::xxx:yyy]
  %elseif;(evar.before != "")
    ,%sp;[living before %s:::yyy]
  %elseif;(evar.after != "")
    ,%sp;[living after %s:::xxx]
  %else; %( On n'affiche rien %)
  %end;
%end;

%define;ancestor_missing_birth(xx)
  %if;(xx.has_birth_date or xx.has_birth_place)
    %if;xx.has_birth_date; %xx.slash_birth_date;%end;
    %if;xx.has_birth_place; - %xx.birth_place;%end;
  %elseif;(xx.has_baptism_date or xx.has_baptism_place)
    %if;xx.has_baptism_date; %xx.slash_baptism_date;%end;
    %if;xx.has_baptism_place; - %xx.baptism_place;%end;
  %else;
    &nbsp;
  %end;
%end;

%define;ancestor_missing_death(xx)
  %if;xx.is_dead;
    %if;xx.has_death_date; %xx.slash_death_date;%end;
    %if;xx.has_death_place; - %xx.death_place;%end;
  %elseif;xx.is_buried;
    %if;xx.has_burial_date; %xx.slash_burial_date;%end;
    %if;xx.has_burial_place; - %xx.burial_place;%end;
  %elseif;xx.is_cremated;
    %if;xx.has_cremation_date; %xx.slash_cremation_date;%end;
    %if;xx.has_cremation_place; - %xx.cremation_place;%end;
  %else;
    &nbsp;
  %end;
%end;

%define;display_missing_ancestor_info(xx)
  %if;(evar.birth = "on")
    <td>%apply;ancestor_missing_birth("xx")</td>
  %end;
  %if;(evar.death = "on")
    <td>%apply;ancestor_missing_death("xx")</td>
  %end;
  %if;(evar.spouse = "on")
    <td>
      %if;xx.has_families;
        %if;(not xx.has_parents and xx.first_name != "?" and xx.surname != "?")
          %foreach;xx.family;
            %if;(spouse.first_name != "?" and spouse.surname != "?")
              %if;(family_cnt > 1),%sp;%end;
              %apply;image_MF("spouse")
              %apply;link(spouse.access, spouse)
            %end;
          %end;
        %end;
      %end;
    </td>
  %end;
%end;

%define;somebody_long_info(xx)
  %if;xx.has_aliases;
    %foreach;xx.alias;, [alias] <em>%alias;</em>%end;
  %end;
  %if;(("xx" = "ancestor" or xx.sosa_in_list = "") and xx.has_nobility_titles)
    <em>%nn;
    %foreach;xx.nobility_title;, %nobility_title;%end;
    </em>%nn;
  %end;
  %if;(xx.has_birth_date or xx.has_birth_place)
    , %if;xx.is_male;[born]0%elseif;xx.is_female;[born]1%else;[born]2%end;
    %if;xx.has_birth_date; %xx.on_birth_date;%end;
    %if;xx.has_birth_place;, %xx.birth_place;%end;
  %end;
  %if;(xx.has_baptism_date or xx.has_baptism_place)
    , %if;xx.is_male;[baptized]0%elseif;xx.is_female;[baptized]1%nn;
    %else;[baptized]2%end;
    %if;xx.has_baptism_date; %xx.on_baptism_date;%end;
    %if;xx.has_baptism_place;, %xx.baptism_place;%end;
  %end;
  %if;xx.is_dead;, %xx.died;
    %if;(xx.has_death_date) %xx.on_death_date;%end;
    %if;(xx.has_death_place), %xx.death_place;%end;
  %end;
  %if;xx.is_buried;,
    %if;xx.is_male;[buried]0%else;[buried]1%end;
    %if;xx.has_burial_date; %xx.on_burial_date;%end;
    %if;xx.has_burial_place;, %xx.burial_place;%end;%nl;
  %end;
  %if;xx.is_cremated;,
    %if;xx.is_male;[cremated]0%else;[cremated]1%end;
    %if;xx.has_cremation_date; %xx.on_cremation_date;%end;
    %if;xx.has_cremation_place;, %xx.cremation_place;%end;%nl;
  %end;
  %if;xx.computable_death_age;%sp;
    ([age at death:] %xx.death_age;)%nn;
  %end;
%end;

%define;link(aa, xx)
  %if;(evar.cgl = "on")xx%else;<a href="%prefix;aa">xx</a>%end;
%end;

%define;link2(xx)
  %if;(evar.cgl = "on")%xx;%else;<a href="%prefix;%xx.access;">%xx;</a>%end;
  %xx.title;%xx.dates;
%end;

%define;my_link(aa, xx, rr)
  %if;(evar.cgl = "on" or rr)xx%else;<a href="%prefix;aa">xx</a>%end;
%end;

%define;somebody_extra_info(xx)
  %if;xx.has_occupation;, %xx.occupation;%end;
  %if;(evar.rel = "on" and xx.has_relations)
    %foreach;xx.relation;%nl;
      (%relation_type;:
      %if;has_relation_him;
        %apply;link2(relation_him.var)
        %if;(relation_him.sosa_in_list != ""),
          [see] <a href="#%relation_him.sosa_in_list;">%nn;
          %relation_him.sosa_in_list;</a>%nn;
        %end;
      %end;
      %if;has_relation_her;
        %if;has_relation_him;,%nl;%end;
        %apply;link2(relation_her.var)
        %if;(relation_her.sosa_in_list != ""),
          [see] <a href="#%relation_her.sosa_in_list;">%nn;
          %relation_her.sosa_in_list;</a>%nn;
        %end;
      %end;)%nn;
    %end;
    %foreach;xx.related;%nl;
      (%related_type;:
       %apply;link2(related.var)
       %if;(related.sosa_in_list != ""),
         [see] <a href="#%related.sosa_in_list;">%nn;
         %related.sosa_in_list;</a>%nn;
       %end;)%nn;
    %end;
  %end;
%end;

%define;somebody(xx)
  <b>%apply;my_link(xx.access, xx, xx.is_restricted)</b>%nn;
  %apply;somebody_long_info("xx")
  %apply;somebody_extra_info("xx")
%end;

%define;somebody_spouse_parent(xx)
  <b>%apply;my_link(spouse.xx.access, spouse.xx, spouse.is_restricted)</b>%nn;
  %if;spouse.xx.has_nobility_titles;,
    <a href="%prefix;m=TT;sm=S;t=%spouse.xx.nobility_title.ident_key;
    ;p=%spouse.xx.nobility_title.place_key;">%nn;
      <em>%spouse.xx.nobility_title;</em></a>%nn;
  %end;
  %spouse.xx.dates;
  %if;(spouse.xx.sosa_in_list != "")%sp;
    ([see] <a href="#%spouse.xx.sosa_in_list;"><b>%spouse.xx.sosa_in_list;
    </b></a>)%nn;
  %end;
%end;

%define;image_sosa(xxx,yyy)
  <img src="%image_prefix;/sosa.png" style="border: none" alt="sosa" title="[direct ancestor of %s:::xxx], [*Sosa] yyy"%/>%nn;
%end;

%define;display_sosa(xx)
  %if;(xx.has_sosa and bvar.display_sosa="yes")
    %if;not cancel_links;<a href="%prefix;%xx.sosa_link;">%end;
    %apply;image_sosa%with;%sosa_ref.first_name_key_strip;%sp;
    %sosa_ref.surname_key_strip;
    %and;%xx.sosa;%end;
    %if;not cancel_links;</a>%end;%sp;
  %end;
%end;

%define;short_display_person(xx)
  %apply;display_sosa("xx")
  %if;(xx.index=central_index)<b>%xx;</b>%else;
    %if;(cancel_links or xx.is_restricted)%xx;
    %else;<a href="%prefix;%xx.access;">%xx;</a>%end;
  %end;
  %xx.title;%xx.dates;
%end;


%define;married_to(is_male, date_place)
  %if;("is_male" = 1)
    %if;are_married;[married%t to:::date_place]0%nn;
    %elseif;are_not_married;[relationship%t to:::date_place]0%nn;
    %elseif;are_engaged;[engaged%t to:::date_place]0%nn;
    %elseif;is_no_sexes_check;[relationship%t to:::date_place]0%nn;
    %elseif;is_no_mention;date_place [with]%nn;
    %end;
  %else;
    %if;are_married;[married%t to:::date_place]1%nn;
    %elseif;are_not_married;[relationship%t to:::date_place]1%nn;
    %elseif;are_engaged;[engaged%t to:::date_place]1%nn;
    %elseif;is_no_sexes_check;[relationship%t to:::date_place]1%nn;
    %elseif;is_no_mention;date_place [with]%nn;
    %end;
  %end;
%end;

%(
  Long display
%)

%define;child_notes(spec)
  %if;(child.sosa_in_list = "" and
       (evar.src = "on" and child.has_sources or
        evar.notes = "on" and (child.has_notes or child.has_event)))
    <dt><a href="#%ancestor.anc_sosa.v;" name="notes-%ancestor.anc_sosa.v;
    %if;("spec" != "")-spec%end;
    %apply;letter(child_cnt)"><b>%ancestor.anc_sosa;
    %if;("spec" != "")-spec%end;
    %apply;letter(child_cnt)</b></a>:</dt>
    <dd>
    %if;(evar.notes = "on" and (child.has_notes or child.has_event))
      <table><tr><td>
        %child.notes;
        %if;child.has_event;
          <table>
            %foreach;child.event;
              <tr>
                <td valign="top" style="white-space: nowrap;" width="1">
                  <span class="edate">
                    %if;event.has_date;%event.date; :
                    %else;--- :
                    %end;
                  </span>
                </td>
                <td valign="top">
                  <span>
                    %apply;capitalize(event.name)%sp;
                    %if;event.has_spouse;([with] %event.spouse;)%end;
                    %if;event.has_place; - %event.place; %end;
                  </span>
                  %if;event.has_witnesses;
                    <p style="margin:0;">
                      %foreach;event_witness;
                        <span>%apply;capitalize(event_witness_kind) :</span>
                        %apply;short_display_person("event_witness")<br/>
                      %end;
                    </p>
                  %end;
                  %if;event.has_note;<div>%event.note;</div>%end;
                    %if;event.has_src;<span><em>[*source/sources]1: %event.src;</em></span>%end;
                </td>
              </tr>
            %end;
          </table>
        %end;
      </td></tr></table>
      <br>
    %end;
    %if;(evar.src = "on" and child.has_sources)
      <em style="font-size:80%%">[*source/sources]1:<br>
      %foreach;child.source;
        - %source_type;: %source;<br>
      %end;
      </em>
      <br>
    %end;
    </dd>
  %end;
%end;

%define;long_display_notes()
  <h3>
    %if;(evar.notes = "on")[*note/notes]1%else;[*source/sources]1%end;
    <a name="ns">&nbsp;</a>
  </h3>
  <dl>
  %foreach;ancestor_level;
    %if;(evar.v != "" and level <= evar.v
         and (evar.only != "on" or level = evar.v))
      %foreach;ancestor;
        %if;((evar.src = "on" and ancestor.has_sources or
              evar.notes = "on" and (ancestor.has_notes or ancestor.has_event))
             and ancestor.same = "")
          <dt><b><a href="#%ancestor.anc_sosa.v;
          " name="notes-%ancestor.anc_sosa.v;
          ">%ancestor.anc_sosa;</a></b>:</dt>
          <dd>
          %if;(evar.notes = "on" and (ancestor.has_notes or ancestor.has_event))
            <table><tr><td>
              %ancestor.notes;
              %if;ancestor.has_event;
                <table>
                  %foreach;ancestor.event;
                    <tr>
                      <td valign="top" style="white-space: nowrap;" width="1">
                        <span class="edate">
                          %if;event.has_date;%event.date; :
                          %else;--- :
                          %end;
                        </span>
                      </td>
                      <td valign="top">
                        <span>
                          %apply;capitalize(event.name)%sp;
                          %if;event.has_spouse;([with] %event.spouse;)%end;
                          %if;event.has_place; - %event.place; %end;
                        </span>
                        %if;event.has_witnesses;
                          <p style="margin:0;">
                            %foreach;event_witness;
                              <span>%apply;capitalize(event_witness_kind) :</span>
                              %apply;short_display_person("event_witness")<br/>
                            %end;
                          </p>
                        %end;
                        %if;event.has_note;<div>%event.note;</div>%end;
                          %if;event.has_src;<span><em>[*source/sources]1: %event.src;</em></span>%end;
                      </td>
                    </tr>
                  %end;
                </table>
              %end;
            </td></tr></table>
            <br>
          %end;
          %if;(evar.src = "on" and ancestor.has_sources)
            <em style="font-size:80%%">[*source/sources]1:<br>
            %foreach;ancestor.source;
              - %source_type;: %source;<br>
            %end;
            </em>
            <br>
          %end;
          </dd>
        %end;
        %if;(evar.siblings = "on" and
       ancestor.is_female and ancestor.same = "")
          %( siblings %)
          %if;(ancestor.index != self.index)
            %foreach;ancestor.family;
              %if;(family.index = ancestor.family.index)
                %foreach;child;
                  %apply;child_notes("")
                %end;
              %end;
            %end;
            %( father's other families %)
            %foreach;ancestor.spouse.family;
              %if;(spouse.index != ancestor.index)
                %foreach;child;
                  %apply;child_notes(family_cnt)
                %end;
              %end;
            %end;
            %( mother's other families %)
            %foreach;ancestor.family;
              %if;(spouse.index != ancestor.spouse.index)
                %foreach;child;
                  %apply;child_notes(family_cnt)
                %end;
              %end;
            %end;
          %end;
        %end;
      %end;
    %end;
  %end;
  </dl>
%end;

%define;long_display_ancestor_personal()
  %apply;somebody("ancestor").
  %if;(evar.only != "on" and ancestor.father_sosa != "")
    [*parents]:%sp;
    <b><a href="#%ancestor.father_sosa;">%ancestor.father_sosa;</a></b>%sp;
    [and]%sp;
    <b><a href="#%ancestor.mother_sosa;">%ancestor.mother_sosa;</a></b>.
  %end;
  %if;(evar.siblings = "on")
    %foreach;ancestor.family;
      %if;(ancestor.index = index or family.index != ancestor.family.index)
        %apply;capitalize%with;
          %apply;married_to%with;
            %ancestor.is_male;
          %and;
            %if;(ancestor.index != index) (%family_cnt;)%end;
            %if;(on_marriage_date != "") %on_marriage_date;%end;
            %if;(marriage_place != ""), %marriage_place;, %end;
          %end;%sp;
        %end;
        %apply;somebody("spouse")%nn;
        %if;spouse.has_parents;,%sp;
          %apply;a_of_b%with;
            %if;spouse.is_male;[son/daughter/child]0
            %else;[son/daughter/child]1%end;
          %and;
            %apply;somebody_spouse_parent("father") [and]
            %apply;somebody_spouse_parent("mother")
          %end;
        %end;.
      %end;
    %end;
  %end;
  %if;((evar.notes = "on" and (ancestor.has_notes or ancestor.has_event) and evar.inline = "on") or (evar.src = "on" and ancestor.has_sources and evar.inline = "on"))
    <p class="asc_notes_src_inline">
      %if;(evar.notes = "on" and (ancestor.has_notes or ancestor.has_event))
        [*note/notes]0 : %apply;clean_html_tags(ancestor.notes)
        <br>
        %if;ancestor.has_event;
          <table>
            %foreach;ancestor.event;
              <tr>
                <td valign="top" style="white-space: nowrap;" width="1">
                  <span class="edate">
                    %if;event.has_date;%event.date; :
                    %else;--- :
                    %end;
                  </span>
                </td>
                <td valign="top">
                  <span>
                    %apply;capitalize(event.name)%sp;
                    %if;event.has_spouse;([with] %event.spouse;)%end;
                    %if;event.has_place; - %event.place; %end;
                  </span>
                  %if;event.has_witnesses;
                    <p style="margin:0;">
                      %foreach;event_witness;
                        <span>%apply;capitalize(event_witness_kind) :</span>
                        %apply;short_display_person("event_witness")<br/>
                      %end;
                    </p>
                  %end;
                  %if;event.has_note;<div>%event.note;</div>%end;
                    %if;event.has_src;<span><em>[*source/sources]1: %event.src;</em></span>%end;
                </td>
              </tr>
            %end;
          </table>
        %end;
        <br>
      %end;
      %if;(evar.src = "on" and ancestor.has_sources)
        <em>
          [*source/sources]1 :
          %foreach;ancestor.source;
            %source_type;: %apply;clean_html_tags(source)
            %if;(not is_last),%sp;%end;
          %end;
        </em>
      %end;
    </p>
  %end;
  %if;((evar.notes = "on" and (ancestor.has_notes or ancestor.has_event) or evar.src = "on" and ancestor.has_sources) and evar.inline != "on")
    %if;(evar.notes = "on")%[[*note/notes]0%sp;
    %else;%[[*source/sources]1%sp;
    %end;
    <b><a href="#notes-%ancestor.anc_sosa.v;">%ancestor.anc_sosa;</a></b>%].
  %end;
%end;

%define;child_long_info(spec)
  <b>%apply;my_link(child.access, child.child_name, child.is_restricted)%nn;</b>%nn;
  %apply;somebody_long_info("child")
  %if;(child.sosa_in_list != "").
    %if;(evar.only != "on")[*see]%sp;
      <a href="#%child.sosa_in_list;"><b>%child.sosa_in_list;</b></a>.
    %end;
  %else;
    %apply;somebody_extra_info("child").
    %foreach;child.family;
      %if;(evar.inline= "on" and (((child.has_notes or child.has_event) and evar.notes = "on") or (child.has_sources and evar.src = "on")))
        <br>
      %end;
      %apply;capitalize%with;
        %apply;married_to%with;
          %child.is_male;
        %and;
          %if;(on_marriage_date != "") %on_marriage_date;%end;
          %if;(marriage_place != ""), %marriage_place;, %end;
        %end;%sp;
      %end;
      %apply;somebody("spouse")%nn;
      %if;spouse.has_parents;,%sp;
        %apply;a_of_b%with;
          %if;spouse.is_male;[son/daughter/child]0
          %else;[son/daughter/child]1%end;
        %and;
          %apply;somebody_spouse_parent("father") [and]
          %apply;somebody_spouse_parent("mother")
        %end;
      %end;.
      %if;are_divorced;[*divorced]0%divorce_date;.%nl;
      %elseif;are_separated;[*separated]0.%nl;
      %end;
    %end;
    %if;((evar.notes = "on" and (child.has_notes or child.has_event) and evar.inline = "on") or (evar.src = "on" and child.has_sources and evar.inline = "on"))
      <p class="asc_notes_src_inline">
        %if;(evar.notes = "on" and (child.has_notes or child.has_event))
          [*note/notes]0 : %apply;clean_html_tags(child.notes)
          <br>
          %if;child.has_event;
            <table>
              %foreach;child.event;
                <tr>
                  <td valign="top" style="white-space: nowrap;" width="1">
                    <span class="edate">
                      %if;event.has_date;%event.date; :
                      %else;--- :
                      %end;
                    </span>
                  </td>
                  <td valign="top">
                    <span>
                      %apply;capitalize(event.name)%sp;
                      %if;event.has_spouse;([with] %event.spouse;)%end;
                      %if;event.has_place; - %event.place; %end;
                    </span>
                    %if;event.has_witnesses;
                      <p style="margin:0;">
                        %foreach;event_witness;
                          <span>%apply;capitalize(event_witness_kind) :</span>
                          %apply;short_display_person("event_witness")<br/>
                        %end;
                      </p>
                    %end;
                    %if;event.has_note;<div>%event.note;</div>%end;
                      %if;event.has_src;<span><em>[*source/sources]1: %event.src;</em></span>%end;
                  </td>
                </tr>
              %end;
            </table>
          %end;
          <br>
        %end;
        %if;(evar.src = "on" and child.has_sources)
          <em>
            [*source/sources]1 :
            %foreach;child.source;
              %source_type;: %apply;clean_html_tags(source)
              %if;(not is_last),%sp;%end;
            %end;
          </em>
        %end;
      </p>
    %end;
    %if;((evar.notes = "on" and (child.has_notes or child.has_event) or evar.src = "on" and child.has_sources) and evar.inline != "on")
      %if;(evar.notes = "on")%[[*note/notes]0%sp;
      %else;%[[*source/sources]1%sp;
      %end;
      <b>
        <a href="#notes-%ancestor.anc_sosa.v;%if;("spec" != "")-spec%end;%apply;letter(child_cnt)">
          %ancestor.anc_sosa;%if;("spec" != "")-spec%end;%apply;letter(child_cnt)
        </a>
      </b>%].
    %end;
  %end;
%end;

%define;long_display_ancestor_families()
  %if;ancestor.is_male;
    ...
    %foreach;ancestor.family;
      %if;(family.index = ancestor.family.index)
        %apply;married_to%with
          %ancestor.is_male;
        %and;
          %if;(on_marriage_date != "") %on_marriage_date;%end;
          %if;(marriage_place != ""), %marriage_place;, %end;
        %end;...
      %end;
    %end;
  %else;
    %foreach;ancestor.family;
      %if;(family.index = ancestor.family.index)
        ...
        %if;(evar.witn = "on" and has_witnesses)([witness/witnesses]1:
          %foreach;witness;
            %if;(not is_first),%nl;%end;
            %apply;link2(witness.var)
          %end;),
        %end;
        %if;(evar.comm = "on" and (has_comment or has_marriage_note))
          (%comment;
           %if;has_marriage_note;
             %marriage_note;
           %end;)%nl;
        %end;
        <i>[having as children]:</i>
        <p>
          <ol style="list-style-type:lower-latin">
          %foreach;child;
            %if;(evar.siblings = "on" or child.sosa_in_list != "")
              <li>%apply;child_long_info("")</li>
            %end;
          %end;
          </ol>
        </p>
      %end;
    %end;
    %if;(evar.siblings = "on")
      %( father's other children %)
      %foreach;ancestor.spouse.family;
        %if;(spouse.index != ancestor.index and nb_children > 0)
          <i>... [having as children]%sp;</i>
          <a href="#%family.father.sosa_in_list;
          "><b>%family.father.sosa_in_list;
          </b></a>-(X%family_cnt;):
          <p><ol style="list-style-type:lower-latin">
          %foreach;child;
            <li>%apply;child_long_info(family_cnt)</li>
          %end;
          </ol></p>
        %end;
      %end;
      %( mother's other children %)
      %foreach;ancestor.family;
        %if;(spouse.index != ancestor.spouse.index and nb_children > 0)
          <i>... [having as children]%sp;</i>
          <a href="#%family.mother.sosa_in_list;
          "><b>%family.mother.sosa_in_list;
          </b></a>-(X%family_cnt;):
          <p><ol style="list-style-type:lower-latin">
          %foreach;child;
            <li>%apply;child_long_info(family_cnt)</li>
          %end;
          </ol></p>
        %end;
      %end;
    %end;
  %end;
%end;

%define;dates_in_interval(xx)
  %if;(evar.after != "" and
       (xx.birth_date.year = "" and
        xx.baptism_date.year = "" and
        xx.death_date.year = "" and
        xx.burial_date.year = "" and
        xx.cremated_date.year = "" or
        xx.birth_date.year != "" and
        xx.birth_date.year < evar.after or
        xx.baptism_date.year != "" and
        xx.baptism_date.year < evar.after or
        xx.death_date.year != "" and
        xx.death_date.year < evar.after or
        xx.burial_date.year != "" and
        xx.burial_date.year < evar.after or
        xx.cremated_date.year != "" and
        xx.cremated_date.year < evar.after) or
       evar.before != "" and
       (xx.birth_date.year = "" and
        xx.baptism_date.year = "" and
        xx.death_date.year = "" and
        xx.burial_date.year = "" and
        xx.cremated_date.year = "" or
        xx.birth_date.year != "" and
        xx.birth_date.year > evar.before or
        xx.baptism_date.year != "" and
        xx.baptism_date.year > evar.before or
        xx.death_date.year != "" and
        xx.death_date.year > evar.before or
        xx.burial_date.year != "" and
        xx.burial_date.year > evar.before or
        xx.cremated_date.year != "" and
        xx.cremated_date.year > evar.before))false%nn;
  %else;true%end;
%end;

%(
   Display ascend in table
%)

%define;table_header()
  <tr class="ascends_table_header align-middle">
    %reset_count;
    %if;(evar.num="on")
      <th scope="row" class="text-center align-middle" rowspan="2" title="[*Sosa]">№</th>
      %incr_count;
    %end;
    <th scope="row" class="pl-2 align-middle" rowspan="2">[*person/persons]0</th>
    %incr_count;
    %if;(evar.birth="on" and evar.birth_place="on")
      <th class="text-center" colspan="2">[*birth]</th>
      %incr_count;%incr_count;
    %elseif;(evar.birth="on" and evar.birth_place!="on")
      <th scope="row" class="text-center" rowspan="2">[*date of birth]</th>
      %incr_count;
    %elseif;(evar.birth!="on" and evar.birth_place="on")
      <th scope="row" class="text-center" rowspan="2">[*birth place]</th>
      %incr_count;
    %end;
    %if;(evar.marr="on")
      <th scope="row" class="pl-2 align-middle" rowspan="2">[*spouse/spouses]1</th>
      %incr_count;
    %end;
    %if;((evar.marr_date="on" and evar.marr_place="on") or
         (evar.marr_date="on" and evar.child="on") or (evar.marr_place="on" and evar.child="on"))
      <th class="text-center"%sp;
        colspan="%if;(evar.marr_date="on" and evar.marr_place="on" and evar.child="on")3%else;2%end;">%nn;
        [*marriage/marriages]0%nn;
      </th>
      %if;(evar.marr_date="on" and evar.marr_place="on" and evar.child="on")
        %incr_count;%incr_count;%incr_count;%else;%incr_count;%incr_count;%end;
    %elseif;(evar.marr_date="on" and evar.marr_place!="on" and evar.child!="on")
      <th scope="row" class="text-center" rowspan="2">[*date of marriage]</th>
      %incr_count;
    %elseif;(evar.marr_date!="on" and evar.marr_place="on" and evar.child!="on")
      <th scope="row" class="text-center text-middle" rowspan="2">[*marriage place]</th>
      %incr_count;
    %elseif;(evar.marr_date!="on" and evar.marr_place!="on" and evar.child="on")
      <th scope="row" class="text-center" rowspan="2" title="[*nb children]/[nb children] [total]">
        <span class="fa fa-child"></span>
      </th>
      %incr_count;
    %end;
    %if;(evar.death="on" and evar.death_place="on")
      <th class="text-center" colspan="2">[*death]</th>
      %incr_count;%incr_count;
    %elseif;(evar.death="on" and evar.death_place!="on")
      <th scope="row" class="text-center" rowspan="2">[*date of death]</th>
      %incr_count;
    %elseif;(evar.death!="on" and evar.death_place="on")
      <th scope="row" class="text-center" rowspan="2">[*death place]</th>
      %incr_count;
    %end;
    %if;(evar.age="on")
      <th scope="row" class="pl-2 align-middle" rowspan="2">[*age]</th>
      %incr_count;
    %end;
    %if;(evar.occu="on")
      <th scope="row" class="pl-2 align-middle" rowspan="2">[*occupation/occupations]1</th>
      %incr_count;
    %end;
    </tr>
    <tr class="ascends_table_header">
    %if;(evar.birth="on" and evar.birth_place="on")
      <th class="text-right pr-2" title="[*date of birth]">[*date/dates]0</th>
      <th class="pl-2" title="[*birth place]">[*place]</th>
    %end;
    %if;((evar.marr_date="on" and evar.marr_place="on") or
         (evar.marr_date="on" and evar.child="on") or (evar.marr_place="on" and evar.child="on"))
      %if;(evar.marr_date="on")
        <th class="%if;(evar.marr_place!="on")text-center%else;text-right pr-2%end;"%sp;
          title="[*date of marriage]">[*date/dates]0%nn;
        </th>
      %end;
      %if;(evar.marr_place="on")
        <th class="%if;(evar.marr_date!="on")text-center%else;pl-2%end;"%sp;
          title="[*marriage place]">[*place]%nn;
        </th>
      %end;
      %if;(evar.child="on")
        <th class="text-center px-2" title="[*nb children]/[nb children] [total]">
          <span class="fa fa-child"></span>
        </th>
      %end;
    %end;
    %if;(evar.death="on" and evar.death_place="on")
      <th class="text-right pr-2" title="[*date of death]">[*date/dates]0</th>
      <th class="pl-2" title="[*death place]">[*place]</th>
    %end;
  </tr>
%end;

%define;table_row()
  %lazy_force;
  %if;(ancestor.same = "")%incr_count;%end;
%( Sosa %)
  %if;(evar.num="on")
    <td class="align-middle text-center table_big_cell%if;(ancestor.has_parents) text-alert%end;"%if;(ancestor.nb_families>1 and (evar.marr = "on" or evar.marr_date = "on" or evar.marr_place = "on")) rowspan="%ancestor.nb_families;"%end;>%nn;
      %if;(ancestor.anc_sosa!=1 and not cancel_links)
        %if;ancestor.has_parents;
          <a class="table_big_anchor" title="[*navigation] [with] %ancestor;%nn;
            %if;(ancestor.occ!="" and ancestor.occ!=0) (%ancestor.occ;)%end;"%sp;
                href="%prefix_base_password;%ancestor.access;;%nn;
                  %foreach;env_binding;
                    %if;(not (env.key="p" or env.key="n" or env.key="oc"))%env.key;=%env.val;;%nn;
                    %end;
                  %end;">%nn;
         %else;
          <a class="table_big_anchor text-danger" title="%apply;a_of_b%with;[*add::parents]%and;%ancestor;%end;"%nn;
           href="%prefix_base_password;ip=%ancestor.index;;m=ADD_PAR">%nn;
         %end;
      %end;
          %if;(evar.sosab = 16)%ancestor.anc_sosa.hexa;%nn;
          %elseif;(evar.sosab = 8)%ancestor.anc_sosa.octal;%nn;
          %else;%ancestor.anc_sosa;%nn;
          %end;
      %if;(ancestor.anc_sosa!=1 and not cancel_links)
        </a>
      %end;
    </td>
  %end;
%( Ancêtre %)
  <td%if;(ancestor.nb_families>1 and (evar.marr = "on" or evar.marr_date = "on" or evar.marr_place = "on")) rowspan="%ancestor.nb_families;"%end;%sp;
      class="align-middle%if;(ancestor.nb_families > 1) border-bottom-0%end;%if;(evar.nowrap="on") text-nowrap%end; pl-2%nn;
    %if;(evar.ns="on")
        %if;(ancestor.has_notes and not ancestor.has_psources) note%nn;
        %elseif;(not ancestor.has_notes and ancestor.has_psources) source%nn;
        %elseif;(ancestor.has_notes and ancestor.has_psources) notesource%nn;
        %end;
    %end;"%sp;
    %if;(evar.ns="on" and (ancestor.has_notes or ancestor.has_psources))
      tabindex="0" data-trigger="focus" data-toggle="popover" data-placement="right" data-html="true"%sp;
      data-content='%if;(ancestor.has_notes)%ancestor.notes;%end;
                    %if;(ancestor.has_notes and ancestor.has_psources)<hr>%end;
                    %if;(ancestor.has_psources)%apply;capitalize(ancestor.psources)%end;'%sp;
      title="%if;(ancestor.has_notes and not ancestor.has_psources)[*note/notes]1%nn;
            %elseif;(not ancestor.has_notes and ancestor.has_psources)[*source/sources]1%nn;
            %elseif;(ancestor.has_notes and ancestor.has_psources)[*note/notes]1 [and] [source/sources]1%nn;
            %end;"%nn;
    %end;>
    <div class="d-flex justify-content-between">
      <div class="align-self-center mr-2">
        %apply;image_MF("ancestor")
        %apply;link%with;%ancestor.access;%and;
          %ancestor;
        %end;
        %if;(evar.title="on")%ancestor.title;%end;
        %if;(ancestor.same != "" and evar.repeat = "on")
          %sp;→
          %if(evar.sosab = 16)%ancestor.same.hexa;
          %elseif(evar.sosab = 8)%ancestor.same.octal;
          %else;%ancestor.same;
          %end;
        %end;
      </div>
      %if;(evar.image!="off" and ancestor.has_image)
        <img src="%ancestor.image_url;" class="rounded align-self-center" height="%if;(evar.px!="")%evar.px;%else;60%end;" alt="%ancestor;">
      %end;
    </div>
%( Date de naissance %)
  </td>
  %if;(evar.birth = "on")
    <td class="align-middle text-right table_big_cell"%if;(ancestor.nb_families>1 and (evar.marr = "on" or evar.marr_date = "on" or evar.marr_place = "on")) rowspan="%ancestor.nb_families;"%end;>
      %if;(wizard and not cancel_links)
        <a class="d-block table_big_anchor" href="%prefix;m=MOD_IND;i=%ancestor.index;#birth_"%sp;
          title="%if;(ancestor.has_approx_birth_date)[*update::birth]%else;[*add::birth]%end;&#010;
           %ancestor.first_name; %ancestor.surname; %if;(ancestor.occ!="0")(%ancestor.occ;)%end;&#010;%if;(ancestor.has_birth_date and ancestor.birth_date.prec="" or ancestor.birth_date.prec="?")° %ancestor.birth_date;%end;">%nn;
        %if;(ancestor.has_approx_birth_date)%ancestor.slash_approx_birth_date;%else;°%end;%nn;
        </a>
      %else;
        %ancestor.slash_approx_birth_date;
      %end;
    </td>
  %end;
%( Lieu de naissance %)
  %if;(evar.birth_place = "on")
    <td%if;(ancestor.nb_families>1 and (evar.marr = "on" or evar.marr_date = "on" or evar.marr_place = "on")) rowspan="%ancestor.nb_families;"%end;%sp;
      class="align-middle%nn;
        %if;(evar.ns="on")
          %if;((ancestor.has_birth_note or ancestor.has_baptism_note) and not
               (ancestor.has_birth_source or ancestor.has_baptism_source)) note%nn;
          %elseif;(not (ancestor.has_birth_note or ancestor.has_baptism_note) and
               (ancestor.has_birth_source or ancestor.has_baptism_source)) source%nn;
          %elseif;((ancestor.has_birth_note or ancestor.has_baptism_note) and
               (ancestor.has_birth_source or ancestor.has_baptism_source)) notesource%nn;
          %end;
        %end;"%sp;
        %if;(evar.ns="on")
          tabindex="0" data-trigger="focus" data-toggle="popover" data-placement="bottom" data-html="true"%sp;
          data-content='%if;(ancestor.has_birth_note or ancestor.has_baptism_note)
                          %if;(ancestor.has_birth_note)%if;(ancestor.has_baptism_note)[*birth][:] %end;%ancestor.birth_note;%end;%nn;
                          %if;(ancestor.has_baptism_note)[*baptism][:] %ancestor.baptism_note;%end;%nn;
                        %end;
                        %foreach;ancestor.source;
                          %let;birthbaptism;[birth], [baptism]%in;
                          %let;birthdeath;[birth], [death]%in;
                          %if;(not ancestor.has_baptism_note and ((not ancestor.has_baptism_source and source_type=[birth]) or source_type=birthbaptism or source_type=birthdeath))
                            %apply;capitalize(ancestor.source).%nn;
                          %elseif;((ancestor.has_baptism_note or ancestor.has_baptism_source) and (source_type=[birth] or source_type=[baptism]))
                            <li>%apply;capitalize(source_type)[:] %ancestor.source;.</li>%nn;
                          %end;
                        %end;'%sp;
            title="%if;(ancestor.has_birth_source or ancestor.has_baptism_source or ancestor.has_birth_note or ancestor.has_baptism_note)
                     %if;((ancestor.has_birth_note or ancestor.has_baptism_note) and not (ancestor.has_birth_source or ancestor.has_baptism_source))[*note/notes]1%nn;
                     %elseif;(not (ancestor.has_birth_note or ancestor.has_baptism_note) and (ancestor.has_birth_source or ancestor.has_baptism_source))[*source/sources]1%nn;
                     %elseif;((ancestor.has_birth_note or ancestor.has_baptism_note) and (ancestor.has_birth_source or ancestor.has_baptism_source))[*note/notes]1 [and] [source/sources]1%nn;
                     %end;
                   %end;"%nn;
        %end;>%nn;
      %if;ancestor.has_approx_birth_place;
        %ancestor.approx_birth_place;%nn;
      %else;
        &nbsp;%nn;
      %end;
    </td>
  %end;
%( Conjoints %)
  %if;(evar.marr = "on")
    %if;(ancestor.nb_families = 0)
      <td>&nbsp;</td>
    %else;
      %foreach;ancestor.family;
        %if;(family_cnt = 1)
          <td class="align-middle">
            %apply;image_MF("spouse")
            %apply;link%with;%spouse.access;%and;
              %spouse;
            %end;
          </td>
        %end;
      %end;
    %end;
  %end;
%( Date du mariage %)
  %if;(evar.marr_date = "on")
    %if;(ancestor.nb_families = 0)
      <td>&nbsp;</td>
    %else;
      %foreach;ancestor.family;
        %if;(family_cnt = 1)
          <td class="align-middle text-right table_big_cell">
            %if;(wizard and not cancel_links)
              <a class="d-block table_big_anchor" href="%prefix;m=MOD_FAM;i=%family.index;;ip=%index;"%sp;
                title="%if;(slash_marriage_date="")[*add::marriage/marriages]0%else;
                [*update::family/families]0%end;&#010;
                %ancestor; [and] %spouse;&#010;%if;(marriage_date!="" and marriage_date.prec="" or marriage_date.prec="?")& %marriage_date;%end;">%nn;
                %if;(slash_marriage_date != "")%slash_marriage_date;%else;<span class="fa fa-%nn;
                  %if;(ancestor.sex!=spouse.sex)venus-mars%elseif;
                    (ancestor.is_male and ancestor.sex=spouse.sex)mars-double text-secondary%else;
                    venus-double text-danger
                  %end;"></span>
                %end;
              </a>%nn;
            %else;
              %slash_marriage_date;%nn;
            %end;
          </td>
        %end;
      %end;
    %end;
  %end;
%( Lieu du mariage %)
  %if;(evar.marr_place = "on")
    %if;(ancestor.nb_families = 0)
      <td>&nbsp;</td>
    %else;
      %foreach;ancestor.family;
        %if;(family_cnt = 1)
          <td class="align-middle%nn;
            %if;(evar.ns="on")
              %if;(has_marriage_note and not has_marriage_source) note%nn;
              %elseif;(not has_marriage_note and has_marriage_source) source%nn;
              %elseif;(has_marriage_note and has_marriage_source) notesource%nn;
              %end;
            %end;"%sp;
            %if;(evar.ns="on")
              tabindex="0" data-trigger="focus" data-toggle="popover" data-placement="bottom" data-html="true"%sp;
              data-content='%if;(has_marriage_note)%marriage_note;%end;
                            %if;(has_marriage_note and has_marriage_source)<hr>%end;
                            %if;(has_marriage_source)%apply;capitalize(marriage_source)%end;'%sp;
              title="%if;(has_marriage_source or has_marriage_note)
                       %if;(has_marriage_note and not has_marriage_source)[*note/notes]1%nn;
                       %elseif;(not has_marriage_note and has_marriage_source)[*source/sources]1%nn;
                       %elseif;(has_marriage_note and has_marriage_source)[*note/notes]1 [and] [source/sources]1%nn;
                       %end;
                     %end;"%nn;
            %end;>%nn;
            %if;(marriage_place != "")
              %marriage_place;%nn;
            %else;
              &nbsp;%nn;
            %end;
          </td>
        %end;
      %end;
    %end;
  %end;
%( Nombre d'enfants %)
  %if;(evar.child = "on")
    %if;(ancestor.nb_families = 0)
      <td>&nbsp;</td>
    %else;
      %if;(evar.marr = "on" or evar.marr_date = "on" or evar.marr_place = "on")
        %foreach;ancestor.family;
          %if;(family_cnt = 1)
            <td class="align-middle text-center">%nb_children;</td>
          %end;
        %end;
      %else;
        <td>%ancestor.nb_children;</td>
      %end;
    %end;
  %end;
%( Date du décès %)
  %if;(evar.death = "on")
    <td class="align-middle text-right table_big_cell" %if;(ancestor.nb_families>1 and (evar.marr = "on" or evar.marr_date = "on" or evar.marr_place = "on"))rowspan="%ancestor.nb_families;"%end;>
      %if;(wizard and not cancel_links)
        <a class="d-block table_big_anchor" href="%prefix;m=MOD_IND;i=%ancestor.index;#death_"%sp;
           title="%if;(ancestor.has_approx_death_date)[*update::death]%else;[*add::death]%end;&#010;
           %ancestor.first_name; %ancestor.surname; %if;(ancestor.occ!="0")(%ancestor.occ;)%end;&#010;%if;(ancestor.has_death_date and ancestor.death_date.prec="" or ancestor.death_date.prec="?")† %ancestor.death_date;%end;">%nn;
        %if;ancestor.has_approx_death_date;%ancestor.slash_approx_death_date;%elseif;ancestor.is_dead;†%end;%nn;
        </a>
      %else;
        %if;ancestor.has_approx_death_date;%ancestor.slash_approx_death_date;%elseif;ancestor.is_dead;†%end;
      %end;
    </td>
  %end;
%( Lieu du décès %)
  %if;(evar.death_place = "on")
    <td%if;(ancestor.nb_families>1 and (evar.marr = "on" or evar.marr_date = "on" or evar.marr_place = "on")) rowspan="%ancestor.nb_families;"%end;%sp;
      class="align-middle%nn;
        %if;(evar.ns="on")
          %if;((ancestor.has_death_note or ancestor.has_burial_note) and not
               (ancestor.has_death_source or ancestor.has_burial_source)) note%nn;
          %elseif;(not (ancestor.has_death_note or ancestor.has_burial_note) and
               (ancestor.has_death_source or ancestor.has_burial_source)) source%nn;
          %elseif;((ancestor.has_death_note or ancestor.has_burial_note) and
               (ancestor.has_death_source or ancestor.has_burial_source)) notesource%nn;
          %end;
        %end;"%sp;
        %if;(evar.ns="on")
          tabindex="0" data-trigger="focus" data-toggle="popover" data-placement="bottom" data-html="true"%sp;
          data-content='%if;(ancestor.has_death_note or ancestor.has_burial_note)
                          %if;(ancestor.has_death_note)%if;(ancestor.has_burial_note)[*death][:] %end;%ancestor.death_note;%end;%nn;
                          %if;(ancestor.has_burial_note)[*burial][:] %ancestor.burial_note;%end;%nn;
                        %end;
                        %foreach;ancestor.source;
                          %let;deathburial;[death], [burial]%in;
                          %let;birthdeath;[birth], [death]%in;
                          %if;(not ancestor.has_burial_note and ((not ancestor.has_burial_source and source_type=[death]) or source_type=deathburial or source_type=birthdeath))
                            %apply;capitalize(ancestor.source).
                          %elseif;((ancestor.has_burial_note or ancestor.has_burial_source) and (source_type=[death] or source_type=[burial]))
                            %if;(source_type=[burial] and ancestor.is_cremated)
                               <li>%apply;capitalize([cremation])[:] %ancestor.source;.</li>%nn;
                            %else;
                              <li>%apply;capitalize(source_type)[:] %ancestor.source;.</li>%nn;
                            %end;
                          %end;
                        %end;'%sp;
            title="%if;(ancestor.has_death_source or ancestor.has_burial_source or ancestor.has_death_note or ancestor.has_burial_note)
                     %if;((ancestor.has_death_note or ancestor.has_burial_note) and not (ancestor.has_death_source or ancestor.has_burial_source))[*note/notes]1%nn;
                     %elseif;(not (ancestor.has_death_note or ancestor.has_burial_note) and (ancestor.has_death_source or ancestor.has_burial_source))[*source/sources]1%nn;
                     %elseif;((ancestor.has_death_note or ancestor.has_burial_note) and (ancestor.has_death_source or ancestor.has_burial_source))[*note/notes]1 [and] [source/sources]1%nn;
                     %end;
                   %end;"%nn;
        %end;>%nn;
      %if;ancestor.has_approx_death_date;
        %ancestor.approx_death_place;%nn;
      %else;
        &nbsp;%nn;
      %end;
    </td>
  %end
%( Âge %)
  %if;(evar.age = "on")
    <td class="align-middle"%if;(ancestor.nb_families>1 and (evar.marr = "on" or evar.marr_date = "on" or evar.marr_place = "on")) rowspan="%ancestor.nb_families;"%end;>%nn;
      %if;ancestor.computable_death_age;%ancestor.death_age;%end;%nn;
      %if;ancestor.computable_age;%ancestor.age;%end;%nn;
    </td>
  %end;
%( Profession %)
  %if;(evar.occu = "on")
    <td class="align-middle"%if;(ancestor.nb_families>1 and (evar.marr = "on" or evar.marr_date = "on" or evar.marr_place = "on")) rowspan="%ancestor.nb_families;"%end;>%nn;
      %if;(ancestor.has_occupation)
        %ancestor.occupation%nn;
      %else;
        &nbsp;%nn;
      %end;
    </td>
  %end;
%end;

%define;table_family()
  %if;(evar.marr = "on" or evar.marr_date = "on" or evar.marr_place = "on")
    %foreach;ancestor.family;
      %if;(family_cnt != 1)
        <tr>
          %if;(evar.marr = "on")
            <td class="border-top-0 align-middle
                %if;(evar.ns="on")
                  %if;(spouse.has_pnotes and not spouse.has_psources) note%nn;
                  %elseif;(not spouse.has_pnotes and spouse.has_psources) source%nn;
                  %elseif;(spouse.has_pnotes and spouse.has_psources) notesource%nn;
                  %end;
                %end;"
              %if;(evar.ns="on")
              tabindex="0" data-trigger="focus" data-toggle="popover" data-placement="bottom" data-html="true"%sp;
              data-content='%if;(spouse.has_pnotes)%spouse.pnotes;%end;
                            %if;(spouse.has_psources)
                              %if;(spouse.has_pnotes)<hr>%end;
                              %spouse.psources;
                            %end;'
                title="%if;(spouse.has_psources or spouse.has_pnotes)
                         %if;(spouse.has_pnotes and not spouse.has_psources)[*note/notes]1%nn;
                         %elseif;(not spouse.has_pnotes and spouse.has_psources)[*source/sources]1%nn;
                         %elseif;(spouse.has_pnotes and spouse.has_psources)[*note/notes]1 [and] [source/sources]1%nn;
                         %end;
                       %end;"%nn;
              %end;>
              %apply;image_MF("spouse")
              %apply;link%with;%spouse.access;%and;
                %spouse;
              %end;
            </td>
          %end;
          %if;(evar.marr_date = "on")
            <td class="align-middle text-right table_big_cell">
              %if;(wizard and not cancel_links)
                <a class="d-block table_big_anchor" href="%prefix;m=MOD_FAM;i=%family.index;;ip=%index;"
                  title="%if;(slash_marriage_date="")[*add::marriage/marriages]0%else;
                  [*update::family/families]0%end;&#010;
                  %ancestor; [and] %spouse;&#010;%if;(marriage_date!="" and marriage_date.prec="" or marriage_date.prec="?")& %marriage_date;%end;">
                  %if;(slash_marriage_date != "")%slash_marriage_date;%else;<span class="fa fa-%nn;
                    %if;(ancestor.sex!=spouse.sex)venus-mars%elseif;
                      (ancestor.is_male and ancestor.sex=spouse.sex)mars-double text-secondary%else;
                      venus-double text-danger
                    %end;"></span>
                  %end;
                </a>%nn;
              %else;
                %slash_marriage_date;
              %end;
            </td>
          %end;
          %if;(evar.marr_place = "on")
            <td class="border-top-0 align-middle
              %if;(evar.ns="on")
                %if;(has_marriage_note and not has_marriage_source) note%nn;
                %elseif;(not has_marriage_note and has_marriage_source) source%nn;
                %elseif;(has_marriage_note and has_marriage_source) notesource%nn;
                %end;
              %end;"
              %if;(evar.ns="on")
                tabindex="0" data-trigger="focus" data-toggle="popover" data-placement="bottom" data-html="true"%sp;
                data-content='%if;(has_marriage_note)%marriage_note;%end;
                              %if;(has_marriage_source)
                                %if;(has_marriage_note)<hr>%end;
                                %apply;capitalize(marriage_source).
                              %end;'
                title='%if;(has_marriage_note or has_marriage_source)
                         %if;(has_marriage_note and not has_marriage_source)[*note/notes]1%nn;
                         %elseif;(not has_marriage_note and has_marriage_source)[*source/sources]1%nn;
                         %elseif;(has_marriage_note and has_marriage_source)[*note/notes]1 [and] [source/sources]1%nn;
                         %end;
                       %end;'
              %end;
              >
              %if;(marriage_place != "")
                %marriage_place;
              %else;
                &nbsp;
              %end;
            </td>
          %end;
          %if;(evar.child = "on")
            <td class="text-center align-middle%nn;
              %if;(evar.ns="on")
                %if;(has_fnotes and not has_fsources) note%nn;
                %elseif;(not has_fnotes and has_fsources) source%nn;
                %elseif;(has_fnotes and has_fsources) notesource%nn;
                %end;
              %end;"%sp;
              %if;(evar.ns="on")
                tabindex="0" data-trigger="focus" data-toggle="popover" data-placement="bottom" data-html="true"%sp;
                data-content='%if;(has_fnotes)%fnotes;%end;
                              %if;(has_fsources)
                                %if;(has_fnotes)<hr>%end;
                                %apply;capitalize(fsources)
                              %end;'
                title="%if;(has_fsources or has_fnotes)
                         %if;(has_fnotes and not has_fsources)[*note/notes]1%nn;
                         %elseif;(not has_fnotes and has_fsources)[*source/sources]1%nn;
                         %elseif;(has_fnotes and has_fsources)[*note/notes]1 [and] [source/sources]1%nn;
                         %end;
                       %end;"%nn;
              %end;>%nb_children;%nn;
            </td>
          %end;
        </tr>
      %end;
    %end;
  %end;
%end;

%( Main %)
<h1>%nn;
  %apply;a_of_b%with;
    %if;(evar.t = "M")
      %if;(evar.evt = "on")[*missing events]%else;[*missing ancestors]%end;%nn;
    %else;[*ancestors]%nn;
    %end;
  %and;
    %if;(public_name != "")%public_name;%else;%first_name;%end;
    %if;(qualifier != "") <em>%qualifier;</em>%end;
    %sp;%surname;
    %if;(alias != "") <em>(%alias;)</em>%end;
  %end;
  %if;(evar.t = "D") [up to] %pvar.1;
  %else;
     %if;(cancel_links) %apply;togena(evar.v)%end;
  %end;
</h1>

%if;(evar.t = "Z" and not cancel_links)
  <div class="d-flex">
    <a role="button" class="btn btn-link my-0 px-0 mb-1 ml-2"%sp;
      href="%prefix_base_password;%access;;m=A">
      <i class="fa fa-cog fa-lg fa-fw mr-1"></i>[*options] [ancestors]
    </a>
    <a role="button" class="btn btn-link ml-2 my-0 px-0 mb-1%if;(not has_children) disabled%end;"%sp;
      href="%prefix_base_password;%nn;
            %foreach;env_binding;
              %if;(env.key="m")m=D;%nn;
              %elseif;(env.key="t")t=I;%nn;
              %elseif;(env.key="v")v=%max_desc_level;;%nn;
              %else;%env.key=%env.val;;%nn;
              %end;%nn;
            %end;" >
      <span class="fa fa-table fa-lg fa-fw mr-1"></span>[*table] [descendants]%nn;
    </a>
    <a role="button" class="btn btn-link ml-2 my-0 px-0 mb-1" href="%prefix_base_password;%access;;m=A;t=T;v=%evar.v;;marriage=on;%if;(evar.image="off")image=off%end;">
      <span class="fa fa-sitemap fa-rotate-180 fa-lg fa-fw mr-1"></span>[*ascendants tree]
    </a>
    <div class="input-group ml-3 mb-1">
      <a role="button" class="btn btn-link pl-3%if;(evar.v<3) disabled" aria-disabled="true"%else;"%end;%sp;
        title="[*delete] 1 [generation/generations]0"%sp;
        href="%prefix_base_password;%nn;
              %foreach;env_binding;
                %if;(env.key="v")v=%expr(evar.v-1);%nn;
                %else;%env.key=%env.val;;%nn;
                %end;
              %end;"><i class="fa fa-minus fa-lg"></i>%nn;
      </a>
      <a role="button" class="btn pl-2"%sp;
        title="[*add] 1 [generation/generations]0"%sp;
        href="%prefix_base_password;%nn;
              %foreach;env_binding;
                %if;(env.key="v")v=%expr(evar.v+1);%nn;
                %else;%env.key=%env.val;;%nn;
                %end;
              %end;"><i class="fa fa-plus fa-lg"></i>%nn;
        </a>
      <span class="text-primary mt-2">%apply;togena%with;%if;(evar.v="")0%else;%evar.v;%end;%end;</span>
    </div>
  </div>
  <div class="d-flex">
    <a role="button" class="btn btn-link ml-2 px-0 mb-1"%sp;
      href="%prefix_base_password;%nn;
            %foreach;env_binding;
              %if;(env.key!="image")%env.key=%env.val;;%nn;%end;
            %end;
            %if;(evar.image!="off")image=off%end;">
      <i class="fa fa-image fa-lg fa-fw %if;(evar.image!="off")text-danger%end; mr-1"></i>%nn;
      %if;(evar.image="off")[*visualize/show/hide/summary]1%else;[*visualize/show/hide/summary]2%end; [image/images]1%nn;
    </a>
    %if;(evar.image!="off")
      <a role="button" class="btn btn-link ml-2 px-0 mb-1"%sp;
        title="%if;(evar.px="120")60%elseif;(evar.px!="")120%else;90%end; px"%sp;
         href="%prefix_base_password;%nn;
               %foreach;env_binding;
                 %if;(env.key!="px")%env.key=%env.val;;%end;%nn;
               %end;
               %if;(evar.px="")px=90%elseif;(evar.px="90")px=120%end;">%nn;
        <i class="fa %if;(evar.px="120")fa-compress%else;fa-expand%end; fa-lg fa-fw mr-1"></i>[*modify] [image/images]1%nn;
      </a>
    %end;
    <a role="button" class="btn btn-link ml-2 px-0 mb-1"%sp;
      title="Small arrow in corner shows existence of note or source."%sp;
      href="%prefix_base_password;%nn;
            %foreach;env_binding;
              %if;(env.key!="ns")%env.key=%env.val;;%end;%nn;
            %end;
            %if;(evar.ns!="on")ns=on%end;">%nn;
      <i class="far fa-sticky-note fa-flip-vertical fa-lg fa-fw %if;(evar.ns="on")text-danger%end; mr-1"></i>%nn;
      %if;(evar.ns="" or evar.ns!="on")[*visualize/show/hide/summary]1%else;[*visualize/show/hide/summary]2%end;%sp;
      <span class="notecolor">[note/notes]1</span> <span class="notesourcecolor">[and]</span> <span class="sourcecolor">[source/sources]1</span>%nn;
    </a>
    %if;(evar.cgl="" or evar.cgl!="on")
      <a role="button" class="btn btn-link ml-2 px-0 mb-1"%sp;
        title="Cancel all URL links"
        href="%prefix_base_password;%nn;
              %foreach;env_binding;
                %env.key=%env.val;;%nn;
              %end;cgl=on;">%nn;
        <i class="fa fa-unlink fa-fw mr-1"></i>%nn;[*cancel GeneWeb links]%nn;
      </a>
    %end;
  </div>
%end;

%if;(evar.t = "P")
  %include.perso_short;
%elseif;((evar.v = "" and evar.t != "D") or evar.v <= 1)
  [*specify::generation/generations]0.
%else;
  %if;(evar.t = "N" and evar.only = "on")
    %( short display; only the selected generation %)
    %reset_count;
    <ul>
      %foreach;ancestor_level2;
        %if;(evar.v != "" and level = evar.v)
          <li>%nl;<b>%apply;gen("v")</b>%nl;
            <ul>%nl;
              %foreach;ancestor;
                <li>%sp;
                  %if;(ancestor.interval != "")%ancestor.interval;
                  %else;
                    %if;(ancestor.same = "")%incr_count;%end;
                    %ancestor.anc_sosa;%sp;
                    %if;(ancestor.same != "")=&gt;%else;-%end;%sp;
                    %apply;link%with;%ancestor.access;%and;
                      %if;(ancestor.same != "")%ancestor.same;
                      %else;%ancestor;%end;
                    %end;
                    %if;(ancestor.same = "")%ancestor.title;%ancestor.dates;%end;
                  %end;
                </li>%nl;
              %end;
            </ul>
          </li>
        %end;
      %end;
    </ul>
    <p>[*total][:] %count; [[person/persons]1@(c)]</p>

  %elseif;(evar.t = "N")
    %( short display %)
    %let;nb_gen;%apply;min(evar.v, max_anc_level)%in;
    <p>%apply;togen(nb_gen).</p>
    %reset_count;
    <ul>
      %foreach;ancestor_level(nb_gen)
        %apply;lazy_print%with;
          <li>%nl;<b>[*generation/generations]0 %level;</b>%nl;
          <ul>%nl;
        %end;
        %foreach;ancestor;
          %lazy_force;
          %if;(ancestor.same = "")%incr_count;%end;
          <li class="%if;ancestor.has_parents;goway%else;noway%end;">%nn;
            %if;(evar.sosab = 16)%ancestor.anc_sosa.hexa;
            %elseif;(evar.sosab = 8)%ancestor.anc_sosa.octal;
            %else;%ancestor.anc_sosa;
            %end;%sp;
            %if;(ancestor.same != "")=&gt;%else;-%end;%sp;
            %apply;link%with;%ancestor.access;%and;
               %if;(ancestor.same != "")%nn;
                 %if(evar.sosab = 16)%ancestor.same.hexa;
                 %elseif(evar.sosab = 8)%ancestor.same.octal;
                 %else;%ancestor.same;
                 %end;
               %else;%ancestor;
               %end;
            %end;
            %if;(ancestor.same = "")%ancestor.title;%ancestor.dates;%end;
          </li>%nl;
        %end;
        %if;lazy_printed;
          </ul>
          </li>
        %end;
      %end;
    </ul>
    <p>[*total][:] %count; [[person/persons]1@(c)]</p>

  %elseif;(evar.t = "M" and evar.evt = "on")
    %include.miss_evt;

  %elseif;(evar.t = "M" and evar.al = "on")
    %( missing ancestors alphabetically %)
    %let;nb_gen;%apply;min(evar.v, max_anc_level)%in;
    <p>
      %apply;togen(nb_gen)
      %apply;living_interval_dates(evar.after, evar.before).
    </p>
    <div class="not_printable" style="margin-bottom:25px;">
      <table class="display_search">
        <tr>
          <td><b>[*sort by/generation/alphabetic order]0</b></td>
          <td><img src="%image_prefix;/picto_branch.png"%/></td>
          <td>
            <a href="%prefix;&amp;m=A&amp;p=%first_name_key;&amp;n=%surname_key;&amp;oc=%evar.oc;%nn;
              &amp;t=%evar.t;&amp;v=%evar.v;&amp;birth=%evar.birth;&amp;death=%evar.death;&amp;spouse=%evar.spouse;&amp;al="
            >[sort by/generation/alphabetic order]1
            </a>
          </td>
          <td><img src="%image_prefix;/picto_alphabetic_order.png"%/></td>
          <td>[sort by/generation/alphabetic order]2</td>
        </tr>
      </table>
    </div>

    %empty_sorted_list;
    %reset_count;
    %foreach;ancestor_level(nb_gen)
      %foreach;ancestor;
        %if;(ancestor.same = "")
          %if;(ancestor.first_name != "?" and ancestor.surname != "?" and (not ancestor.has_parents or (ancestor.has_families and (ancestor.spouse.first_name = "?" and ancestor.spouse.surname = "?"))))
            %if;(dates_in_interval(ancestor.var) = "true")
              %incr_count;
              %apply;add_in_sorted_list%with
                %ancestor.surname_end;
                %and;%ancestor.first_name;
                %and;%ancestor.surname_begin;
                %and;%ancestor.access;
                %and;%apply;image_MF("ancestor")
                %and;%ancestor.nobility_title;
                %and;%apply;ancestor_missing_birth("ancestor")
                %and;%apply;ancestor_missing_death("ancestor")
                %and;
                  %if;(not ancestor.has_parents)
                    x
                  %else;
                    &nbsp;
                  %end;
                %and;
                  %if;(ancestor.has_families and (ancestor.spouse.first_name = "?" and ancestor.spouse.surname = "?"))
                    x
                  %else;
                    &nbsp;
                  %end;
              %end;
            %end;
          %end;
        %end;
      %end;
    %end;

    %let;nb_ind;%count;%in;
    %reset_count;
    %if;(nb_ind > 100)
      <p>
        %foreach;sorted_list_item;
          %if;(initial(prev_item.1) != initial(item.1))
            <a href="#a_%apply;hexa(initial(item.1))">%apply;initial(item.1)</a>
          %end;
        %end;
      </p>
    %end;

    <ul class="missing_ancestors_sort">
      %if;(nb_ind <= 100)
        <li>%nn;
        <a name="a_%apply;hexa(initial(item.1))">%apply;initial(item.1)</a>
        <table class="missing_ancestors_table">
          <tr class="missing_ancestors_table_header">
            <th width="20%%">[*person/persons]0</th>
            %if;(evar.birth = "on")
              <th %if;(evar.death = "on")width="30%%"%else;width="60%%"%end;>[*birth date and birth place]</th>
            %end;
            %if;(evar.death = "on")
              <th %if;(evar.birth = "on")width="30%%"%else;width="60%%"%end;>[*death date and death place]</th>
            %end;
            <th width="10%%">[*missing parents]</th>
            <th width="10%%">[*missing spouse]</th>
          </tr>
      %end;
      %foreach;sorted_list_item;
        %if;(initial(prev_item.1) != initial(item.1) and nb_ind > 100)
          <li>%nn;
          <a name="a_%apply;hexa(initial(item.1))">%apply;initial(item.1)</a>
          <table class="missing_ancestors_table">
            <tr class="missing_ancestors_table_header">
              <th width="20%%">[*person/persons]0</th>
              %if;(evar.birth = "on")
                <th %if;(evar.death = "on")width="30%%"%else;width="60%%"%end;>[*birth date and birth place]</th>
              %end;
              %if;(evar.death = "on")
                <th %if;(evar.birth = "on")width="30%%"%else;width="60%%"%end;>[*death date and death place]</th>
              %end;
              <th width="10%%">[*missing parents]</th>
              <th width="10%%">[*missing spouse]</th>
            </tr>
        %end;
        <tr>
          <td>
            %if;(evar.cgl = "on")
              %item.5;%item.1;%sp;%item.2;%item.3;
            %else;
              %item.5;<a href="%prefix;%item.4;">%item.1;%sp;%item.2;</a>%item.3;
            %end;
            %if;(item.6 != ""), <em>%item.6;</em>%end;
          </td>
          %if;(evar.birth = "on")
            <td>%item.7;</td>
          %end;
          %if;(evar.death = "on")
            <td>%item.8;</td>
          %end;
          <td align="center">
            %item.9;
            %if;(initial(item.9) = "x")%incr_count;%incr_count;%end;
          </td>
          <td align="center">
            %item.10;
            %if;(initial(item.10) = "x")%incr_count;%end;
          </td>
        </tr>
        %if;(initial(item.1) != initial(next_item.1) and nb_ind > 100)
          </table>
          </li>
        %end;
      %end;
      %if;(nb_ind <= 100)
        </table>
        </li>
      %end;
    </ul>
    <p style="clear:both;">[*total][:] %count; [[person/persons]1@(c)]</p>

  %elseif;(evar.t = "M")
    %( missing ancestors by generation %)
    %let;nb_gen;%apply;min(evar.v, max_anc_level)%in;
    <p>
      %apply;togen(nb_gen)
      %apply;living_interval_dates(evar.after, evar.before)
    </p>
    <div class="not_printable" style="margin-bottom:25px;">
      <table class="display_search">
        <tr>
          <td><b>[*sort by/generation/alphabetic order]0</b></td>
          <td><img src="%image_prefix;/picto_branch.png"%/></td>
          <td>[sort by/generation/alphabetic order]1</td>
          <td><img src="%image_prefix;/picto_alphabetic_order.png"%/></td>
          <td>
            <a href="%prefix;&amp;m=A&amp;p=%first_name_key;&amp;n=%surname_key;&amp;oc=%evar.oc;&amp;t=%evar.t;&amp;v=%evar.v;&amp;birth=%evar.birth;&amp;death=%evar.death;&amp;spouse=%evar.spouse;&amp;al=on">
              [sort by/generation/alphabetic order]2
            </a>
          </td>
        </tr>
      </table>
    </div>

    %reset_count;
    <table class="table missing_ancestors_table">
      <tr class="missing_ancestors_table_header align-middle">
        <th>[*missing sosa]</th>
        <th>[*missing parents]</th>
        <th>[*missing spouse]</th>
        <th>[*person/persons]0</th>
        %if;(evar.birth = "on") <th>[*birth date and birth place]</th> %incr_count; %end;
        %if;(evar.death = "on") <th>[*death date and death place]</th> %incr_count; %end;
        %if;(evar.spouse = "on") <th>[*spouse/spouses]1</th> %incr_count; %end;
      </tr>
      %let;nb_col;%expr(count + 4)%in;
      %reset_count;
      %foreach;ancestor_level(nb_gen)
        %apply;lazy_print%with;
          <tr>
            <th align="left" colspan="%nb_col;">[*generation/generations]0 %expr(level+1)</th>
          </tr>
        %end;
        %foreach;ancestor;
          %if;(ancestor.same = "")
            %if;(not ancestor.has_parents and ancestor.first_name != "?" and ancestor.surname != "?")
              %if;(dates_in_interval(ancestor.var) = "true")
                %incr_count;%incr_count;
                %lazy_force;
                <tr>
                  <td>
                    %expr(ancestor.anc_sosa.v * 2) - %expr(ancestor.anc_sosa.v * 2 + 1)
                  </td>
                  <td align="center"> x </td>
                  <td> &nbsp; </td>
                  <td>
                    %apply;image_MF("ancestor")
                    %apply;link(ancestor.access, ancestor)
                    %ancestor.title;
                  </td>
                  %apply;display_missing_ancestor_info("ancestor")
                </tr>
              %end;
            %elseif;(ancestor.has_parents)
              %if;(ancestor.father.first_name = "?" and ancestor.father.surname = "?")
                %if;(dates_in_interval(ancestor.mother.var) = "true")
                  %incr_count;
                  %lazy_force;
                  <tr>
                    <td>
                      %expr(ancestor.anc_sosa.v * 2)
                    </td>
                    <td> &nbsp; </td>
                    <td align="center"> x </td>
                    <td>
                      %apply;image_MF("ancestor.mother")
                      %apply;link(ancestor.mother.access, ancestor.mother)
                      %ancestor.mother.title;
                    </td>
                    %apply;display_missing_ancestor_info("ancestor.mother")
                  </tr>
                %end;
              %end;
              %if;(ancestor.mother.first_name = "?" and ancestor.mother.surname = "?")
                %if;(dates_in_interval(ancestor.father.var) = "true")
                  %incr_count;
                  %lazy_force;
                  <tr>
                    <td>
                      %expr(ancestor.anc_sosa.v * 2 + 1)
                    </td>
                    <td> &nbsp; </td>
                    <td align="center"> x </td>
                    <td>
                      %apply;image_MF("ancestor.father")
                      %apply;link(ancestor.father.access, ancestor.father)
                      %ancestor.father.title;
                    </td>
                    %apply;display_missing_ancestor_info("ancestor.father")
                  </tr>
                %end;
              %end;
            %end;
          %end;
        %end;
      %end;
    </table>
    <p>[*total][:] %count; [[person/persons]1@(c)]</p>

  %elseif;(evar.t = "G" and evar.only= "on")
    %( long display; only the selected generation %)
    %if;((evar.notes = "on" or evar.src = "on") and evar.inline != "on")
      <p class="not_printable">
        [*see]: <a href="#asc">[*ancestors]</a>%sp;%nn;
        %if;((evar.notes = "on" or evar.src = "on") and evar.inline != "on")
          | <a href="#ns">[*note/notes]1</a>
        %end;
      </p>
    %end;
    <h3>
      <em>%apply;gen("v").</em>
      <a name="asc">&nbsp;</a>
    </h3>
    %foreach;ancestor_level;
      %if;(evar.v != "" and level = evar.v)
        %foreach;ancestor;
          %if;(ancestor.same != "")
            <p>
              <b><a name="%ancestor.anc_sosa.v;">%ancestor.anc_sosa;</a></b>:
              [see] <b><a href="#%ancestor.same.v;">%ancestor.same;</a></b>.
            </p>
          %else;
            <p>
              <b><a name="%ancestor.anc_sosa.v;">%ancestor.anc_sosa;</a></b>
              %apply;long_display_ancestor_personal()
            </p>
            %if;(ancestor.index != self.index)
              <p>%apply;long_display_ancestor_families()</p>
            %end;
          %end;
        %end;
      %end;
    %end;
    %if;((evar.notes = "on" or evar.src = "on") and evar.inline != "on")
      <p><hr%/></p>
      <p>%apply;long_display_notes()</p>
    %end;

  %elseif;(evar.t = "G")
    %( long display %)
    %if;((evar.notes = "on" or evar.src = "on") and evar.inline != "on")
      <p class="not_printable">
        [*see]: <a href="#asc">[*ancestors]</a>%sp;%nn;
        %if;((evar.notes = "on" or evar.src = "on") and evar.inline != "on")
          | <a href="#ns">[*note/notes]1</a>
        %end;
      </p>
    %end;
    %let;nb_gen;%apply;min(evar.v, max_anc_level)%in;
    <p>
      %apply;togen(nb_gen).
      <a name="asc">&nbsp;</a>
    </p>
    %foreach;ancestor_level(nb_gen)
      <h3><em>[*generation/generations]0 %level;</em></h3>
      %foreach;ancestor;
        %if;(ancestor.same != "")
          <p>
            <b><a name="%ancestor.anc_sosa.v;">%ancestor.anc_sosa;</a></b>:
            [see] <b><a href="#%ancestor.same.v;">%ancestor.same;</a></b>.
          </p>
        %else;
          <p>
            <b><a name="%ancestor.anc_sosa.v;">%ancestor.anc_sosa;</a></b>
            %apply;long_display_ancestor_personal()
          </p>
          %if;(ancestor.index != self.index)
            <p>%apply;long_display_ancestor_families()</p>
          %end;
        %end;
      %end;
    %end;
    %if;((evar.notes = "on" or evar.src = "on") and evar.inline != "on")
      <p><hr%/></p>
      <p>%apply;long_display_notes()</p>
    %end;

  %elseif;(evar.t = "D")
    %( ancestors up to somebody %)
    %pvar.1.mark_descendants;
    <ul>
      %foreach;ancestor_level;
        %apply;lazy_print%with;
          <li>[*generation/generations]0 %level;%nl;
          <ul>
        %end;
        %if;(level <= evar.l + 1)
          %foreach;ancestor;
            %if;(ancestor.same = "" and ancestor.is_descendant)
              %lazy_force;
              <li>[Sosa] %ancestor.anc_sosa; -%sp;
                <a href="%prefix;%ancestor.access;">%ancestor;</a>%nn;
                %ancestor.title;%ancestor.dates;
              </li>
            %end;
          %end;
        %end;
        %if;lazy_printed;</ul>%nl;</li>%nl;%end;
      %end;
    </ul>

  %elseif;(evar.t = "Z" and evar.only = "on")
    <p>%apply;gen("v").</p>
    %reset_count;
    <table class="table table-hover ascends_table mt-1">
      %apply;table_header()
      %let;nb_col;%count;%in;
      %reset_count;
      %foreach;ancestor_level;
        %if;(evar.v != "" and level = evar.v)
          %if;(evar.gen = "on")
            <tr>
              <th align="left" colspan="%nb_col;">[*generation/generations]0 %level;</th>
            </tr>
          %end;
          %foreach;ancestor;
            <tr>
              %apply;table_row()
            </tr>
            %if;(ancestor.nb_families > 1)
              %apply;table_family()
            %end;
          %end;
        %end;
      %end;
    </table>
    <p>[*total][:] %count; [[person/persons]1@(c)]</p>

  %elseif;(evar.t = "Z")
    %let;nb_gen;%apply;min(evar.v, max_anc_level)%in;
    %reset_count;
    <table class="table table-hover ascends_table mt-1">
      %apply;table_header()
      %let;nb_col;%count;%in;
      %reset_count;
      %foreach;ancestor_level(nb_gen)
        %if;(evar.gen = "on" and level!=1)
          <tr>
            <td class="pl-2 font-weight-bold color-gray" colspan="%nb_col;">[*generation/generations]0 %level;</td>
          </tr>
        %end;
        %foreach;ancestor;
          <tr>
            %apply;table_row()
          </tr>
          %if;(ancestor.nb_families > 1)
            %apply;table_family()
          %end;
        %end;
      %end;
    </table>
    <p>[*total][:] %count; [[person/persons]1@(c)]</p>
  %end;
%end;

%include.trl;
%include.copyr;
</div>
%include.js;
<script>
// Initialize Bootstrap tooltip and popover component, dismiss on next click function
$(function () {
  $('[data-toggle="tooltip"]').tooltip()
})
$(function () {
  $('[data-toggle="popover"]').popover()
})
$('.popover-dismiss').popover({
  trigger: 'focus'
})
</script>

</body>
</html>
