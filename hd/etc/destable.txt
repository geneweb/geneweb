<!DOCTYPE html>
<html lang="%if;(bvar.default_lang!="" and evar.lang="")%bvar.default_lang;%elseif;(evar.lang!="")%evar.lang;%else;en%end;">
<head>
  <!-- $Id: destable.txt 16/02/2017 01:19:21 $ -->
  <!-- Copyright (c) 1998-2017 INRIA -->
<title>%nn;
  %apply;a_of_b%with;[*descendants]%and;%self;%end;
     %sp;[up to] %evar.v; %if;(evar.v>1)[generation/generations]1%else;[generation/generations]0%end;
</title>
  <meta name="robots" content="none">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="shortcut icon" href="%image_prefix;/favicon_gwd.png">
%include.css;
%base_header;
</head>
<body%body_prop;>
%message_to_wizard;
<div class="container-fluid">
<h1>%nn;
  %apply;a_of_b%with;[*descendants]%and;%self;%end;
     %sp;[up to] %evar.v; %if;(evar.v>1)[generation/generations]1%else;[generation/generations]0%end;
</h1>

%if;not cancel_links;
  <div class="btn-group float-%right; mt-2">
    %if;(referer != "")
      <a href="%referer;"><span class="fa fa-arrow-left fa-lg" title="<<"></span></a>
    %end;
    <a href="%prefix;"><span class="fa fa-home fa-lg" title="[*home]"></span></a>
  </div>
%end;

%let;central_index;%index;%in;

%define;tothegen(xx)
  [*to the %s generation:::xx]%nn;
%end;

%define;thegen(xx)
  [*the %s generation:::xx]%nn;
%end;

%define;image_MF(xx)
  %if;(wizard and not cancel_links)
    <a href="%prefix;m=MOD_IND;i=%xx.index;" title="[*modify::] %xx.first_name;%if;(xx.occ!="0").%xx.occ;%end; %xx.surname;">
  %end;
  %if;xx.is_male;
    <i class="fa fa-mars male"></i>%nn;
  %elseif;xx.is_female;
    <i class="fa fa-venus female"></i>%nn;
  %else;
    <i class="fa fa-neuter neuter"></i>%nn;
  %end;%nn;
  %if;(wizard and not cancel_links and not xx.is_restricted)</a>%end;
%end;

%define;letter(xx)
  %apply;nth%with;
    /a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y/z
  %and;xx%end;
%end;

%define;living_interval_dates(xxx, yyy)
  %if;(evar.after != "" and evar.before != "")
    ,%sp;[living between %s and %s:::xxx:yyy]
  %elseif;(evar.before != "")
    ,%sp;[living before %s:::yyy]
  %elseif;(evar.after != "")
    ,%sp;[living after %s:::xxx]
  %else; %( On n'affiche rien %)
  %end;
%end;

%define;somebody_long_info(xx)
  %if;xx.has_aliases;
    %foreach;xx.alias;, [alias] <em>%alias;</em>%end;
  %end;
  %if;(("xx" = "ancestor" or xx.sosa_in_list = "") and xx.has_nobility_titles)
    <em>%nn;
    %foreach;xx.nobility_title;, %nobility_title;%end;
    </em>%nn;
  %end;
  %if;(xx.has_birth_date or xx.has_birth_place)
    , %if;xx.is_male;[born]0%elseif;xx.is_female;[born]1%else;[born]2%end;
    %if;xx.has_birth_date; %xx.on_birth_date;%end;
    %if;xx.has_birth_place;, %xx.birth_place;%end;
  %end;
  %if;(xx.has_baptism_date or xx.has_baptism_place)
    , %if;xx.is_male;[baptized]0%elseif;xx.is_female;[baptized]1%nn;
    %else;[baptized]2%end;
    %if;xx.has_baptism_date; %xx.on_baptism_date;%end;
    %if;xx.has_baptism_place;, %xx.baptism_place;%end;
  %end;
  %if;xx.is_dead;, %xx.died;
    %if;(xx.has_death_date) %xx.on_death_date;%end;
    %if;(xx.has_death_place), %xx.death_place;%end;
  %end;
  %if;xx.is_buried;,
    %if;xx.is_male;[buried]0%else;[buried]1%end;
    %if;xx.has_burial_date; %xx.on_burial_date;%end;
    %if;xx.has_burial_place;, %xx.burial_place;%end;%nl;
  %end;
  %if;xx.is_cremated;,
    %if;xx.is_male;[cremated]0%else;[cremated]1%end;
    %if;xx.has_cremation_date; %xx.on_cremation_date;%end;
    %if;xx.has_cremation_place;, %xx.cremation_place;%end;%nl;
  %end;
  %if;xx.computable_death_age;%sp;
    ([age at death:] %xx.death_age;)%nn;
  %end;
%end;

%define;link(aa, xx)
  %if;(evar.cgl = "on")xx%else;<a href="%prefix;aa">xx</a>%end;
%end;

%define;link2(xx)
  %if;(evar.cgl = "on")%xx;%else;<a href="%prefix;%xx.access;">%xx;</a>%end;
  %xx.title;%xx.dates;
%end;

%define;my_link(aa, xx, rr)
  %if;(evar.cgl = "on" or rr)xx%else;<a href="%prefix;aa">xx</a>%end;
%end;

%define;somebody_extra_info(xx)
  %if;xx.has_occupation;, %xx.occupation;%end;
  %if;(evar.rel = "on" and xx.has_relations)
    %foreach;xx.relation;%nl;
      (%relation_type;:
      %if;has_relation_him;
        %apply;link2(relation_him.var)
        %if;(relation_him.sosa_in_list != ""),
          [see] <a href="#%relation_him.sosa_in_list;">%nn;
          %relation_him.sosa_in_list;</a>%nn;
        %end;
      %end;
      %if;has_relation_her;
        %if;has_relation_him;,%nl;%end;
        %apply;link2(relation_her.var)
        %if;(relation_her.sosa_in_list != ""),
          [see] <a href="#%relation_her.sosa_in_list;">%nn;
          %relation_her.sosa_in_list;</a>%nn;
        %end;
      %end;)%nn;
    %end;
    %foreach;xx.related;%nl;
      (%related_type;:
       %apply;link2(related.var)
       %if;(related.sosa_in_list != ""),
         [see] <a href="#%related.sosa_in_list;">%nn;
         %related.sosa_in_list;</a>%nn;
       %end;)%nn;
    %end;
  %end;
%end;

%define;somebody(xx)
  <b>%apply;my_link(xx.access, xx, xx.is_restricted)</b>%nn;
  %apply;somebody_long_info("xx")
  %apply;somebody_extra_info("xx")
%end;

%define;somebody_spouse_parent(xx)
  <b>%apply;my_link(spouse.xx.access, spouse.xx, spouse.is_restricted)</b>%nn;
  %if;spouse.xx.has_nobility_titles;,
    <a href="%prefix;m=TT;sm=S;t=%spouse.xx.nobility_title.ident_key;
    ;p=%spouse.xx.nobility_title.place_key;">%nn;
      <em>%spouse.xx.nobility_title;</em></a>%nn;
  %end;
  %spouse.xx.dates;
  %if;(spouse.xx.sosa_in_list != "")%sp;
    ([see] <a href="#%spouse.xx.sosa_in_list;"><b>%spouse.xx.sosa_in_list;
    </b></a>)%nn;
  %end;
%end;

%define;image_sosa(xxx,yyy)
  <img src="%image_prefix;/sosa.png" class="border-0" alt="sosa" title="[direct ancestor of %s:::xxx], [*Sosa] yyy"%/>%nn;
%end;

%define;display_sosa(xx)
  %if;(xx.has_sosa and bvar.display_sosa="yes")
    %if;not cancel_links;<a href="%prefix;%xx.sosa_link;">%end;
    %apply;image_sosa%with;%sosa_ref.first_name_key_strip;%sp;
    %sosa_ref.surname_key_strip;
    %and;%xx.sosa;%end;
    %if;not cancel_links;</a>%end;%sp;
  %end;
%end;

%define;short_display_person(xx)
  %apply;display_sosa("xx")
  %if;(xx.index=central_index)<b>%xx;</b>%else;
    %if;(cancel_links or xx.is_restricted)%xx;
    %else;<a href="%prefix;%xx.access;">%xx;</a>%end;
  %end;
  %xx.title;%xx.dates;
%end;

%define;married_to(is_male, date_place)
  %if;("is_male" = 1)
    %if;are_married;[married%t to:::date_place]0%nn;
    %elseif;are_not_married;[relationship%t to:::date_place]0%nn;
    %elseif;are_engaged;[engaged%t to:::date_place]0%nn;
    %elseif;is_no_sexes_check;[relationship%t to:::date_place]0%nn;
    %elseif;is_no_mention;date_place [with]%nn;
    %end;
  %else;
    %if;are_married;[married%t to:::date_place]1%nn;
    %elseif;are_not_married;[relationship%t to:::date_place]1%nn;
    %elseif;are_engaged;[engaged%t to:::date_place]1%nn;
    %elseif;is_no_sexes_check;[relationship%t to:::date_place]1%nn;
    %elseif;is_no_mention;date_place [with]%nn;
    %end;
  %end;
%end;

%(
  Long display
%)

%define;child_notes(spec)
  %if;(child.sosa_in_list = "" and
       (evar.src = "on" and child.has_sources or
        evar.notes = "on" and (child.has_notes or child.has_event)))
    <dt><a href="#%ancestor.anc_sosa.v;" name="notes-%ancestor.anc_sosa.v;
    %if;("spec" != "")-spec%end;
    %apply;letter(child_cnt)"><b>%ancestor.anc_sosa;
    %if;("spec" != "")-spec%end;
    %apply;letter(child_cnt)</b></a>:</dt>
    <dd>
    %if;(evar.notes = "on" and (child.has_notes or child.has_event))
      <table><tr><td>
        %child.notes;
        %if;child.has_event;
          <table>
            %foreach;child.event;
              <tr>
                <td valign="top" class="text-nowrap" width="1">
                  <span class="edate">
                    %if;event.has_date;%event.date; :
                    %else;--- :
                    %end;
                  </span>
                </td>
                <td valign="top">
                  <span>
                    %apply;capitalize(event.name)%sp;
                    %if;event.has_spouse;([with] %event.spouse;)%end;
                    %if;event.has_place; - %event.place; %end;
                  </span>
                  %if;event.has_witnesses;
                    <p style="margin:0;">
                      %foreach;event_witness;
                        <span>%apply;capitalize(event_witness_kind) :</span>
                        %apply;short_display_person("event_witness")<br/>
                      %end;
                    </p>
                  %end;
                  %if;event.has_note;<div>%event.note;</div>%end;
                    %if;event.has_src;<span><em>[*source/sources]1: %event.src;</em></span>%end;
                </td>
              </tr>
            %end;
          </table>
        %end;
      </td></tr></table>
      <br>
    %end;
    %if;(evar.src = "on" and child.has_sources)
      <em style="font-size:80%%">[*source/sources]1:<br>
      %foreach;child.source;
        - %source_type;: %source;<br>
      %end;
      </em>
      <br>
    %end;
    </dd>
  %end;
%end;

%define;long_display_notes()
  <h3>
    %if;(evar.notes = "on")[*note/notes]1%else;[*source/sources]1%end;
    <a name="ns">&nbsp;</a>
  </h3>
  <dl>
  %foreach;ancestor_level;
    %if;(evar.v != "" and level <= evar.v
         and (evar.only != "on" or level = evar.v))
      %foreach;ancestor;
        %if;((evar.src = "on" and ancestor.has_sources or
              evar.notes = "on" and (ancestor.has_notes or ancestor.has_event))
             and ancestor.same = "")
          <dt><b><a href="#%ancestor.anc_sosa.v;
          " name="notes-%ancestor.anc_sosa.v;
          ">%ancestor.anc_sosa;</a></b>:</dt>
          <dd>
          %if;(evar.notes = "on" and (ancestor.has_notes or ancestor.has_event))
            <table><tr><td>
              %ancestor.notes;
              %if;ancestor.has_event;
                <table>
                  %foreach;ancestor.event;
                    <tr>
                      <td valign="top" class="text-no-wrap" width="1">
                        <span class="edate">
                          %if;event.has_date;%event.date; :
                          %else;--- :
                          %end;
                        </span>
                      </td>
                      <td valign="top">
                        <span>
                          %apply;capitalize(event.name)%sp;
                          %if;event.has_spouse;([with] %event.spouse;)%end;
                          %if;event.has_place; - %event.place; %end;
                        </span>
                        %if;event.has_witnesses;
                          <p style="margin:0;">
                            %foreach;event_witness;
                              <span>%apply;capitalize(event_witness_kind) :</span>
                              %apply;short_display_person("event_witness")<br/>
                            %end;
                          </p>
                        %end;
                        %if;event.has_note;<div>%event.note;</div>%end;
                          %if;event.has_src;<span><em>[*source/sources]1: %event.src;</em></span>%end;
                      </td>
                    </tr>
                  %end;
                </table>
              %end;
            </td></tr></table>
            <br>
          %end;
          %if;(evar.src = "on" and ancestor.has_sources)
            <em style="font-size:80%%">[*source/sources]1:<br>
            %foreach;ancestor.source;
              - %source_type;: %source;<br>
            %end;
            </em>
            <br>
          %end;
          </dd>
        %end;
        %if;(evar.siblings = "on" and
       ancestor.is_female and ancestor.same = "")
          %( siblings %)
          %if;(ancestor.index != self.index)
            %foreach;ancestor.family;
              %if;(family.index = ancestor.family.index)
                %foreach;child;
                  %apply;child_notes("")
                %end;
              %end;
            %end;
            %( father's other families %)
            %foreach;ancestor.spouse.family;
              %if;(spouse.index != ancestor.index)
                %foreach;child;
                  %apply;child_notes(family_cnt)
                %end;
              %end;
            %end;
            %( mother's other families %)
            %foreach;ancestor.family;
              %if;(spouse.index != ancestor.spouse.index)
                %foreach;child;
                  %apply;child_notes(family_cnt)
                %end;
              %end;
            %end;
          %end;
        %end;
      %end;
    %end;
  %end;
  </dl>
%end;

%define;long_display_ancestor_personal()
  %apply;somebody("ancestor").
  %if;(evar.only != "on" and ancestor.father_sosa != "")
    [*parents]:%sp;
    <b><a href="#%ancestor.father_sosa;">%ancestor.father_sosa;</a></b>%sp;
    [and]%sp;
    <b><a href="#%ancestor.mother_sosa;">%ancestor.mother_sosa;</a></b>.
  %end;
  %if;(evar.siblings = "on")
    %foreach;ancestor.family;
      %if;(ancestor.index = index or family.index != ancestor.family.index)
        %apply;capitalize%with;
          %apply;married_to%with;
            %ancestor.is_male;
          %and;
            %if;(ancestor.index != index) (%family_cnt;)%end;
            %if;(on_marriage_date != "") %on_marriage_date;%end;
            %if;(marriage_place != ""), %marriage_place;, %end;
          %end;%sp;
        %end;
        %apply;somebody("spouse")%nn;
        %if;spouse.has_parents;,%sp;
          %apply;a_of_b%with;
            %if;spouse.is_male;[son/daughter/child]0
            %else;[son/daughter/child]1%end;
          %and;
            %apply;somebody_spouse_parent("father") [and]
            %apply;somebody_spouse_parent("mother")
          %end;
        %end;.
      %end;
    %end;
  %end;
  %if;((evar.notes = "on" and (ancestor.has_notes or ancestor.has_event) and evar.inline = "on") or (evar.src = "on" and ancestor.has_sources and evar.inline = "on"))
    <p class="asc_notes_src_inline">
      %if;(evar.notes = "on" and (ancestor.has_notes or ancestor.has_event))
        [*note/notes]0 : %apply;clean_html_tags(ancestor.notes)
        <br>
        %if;ancestor.has_event;
          <table>
            %foreach;ancestor.event;
              <tr>
                <td valign="top" style="white-space: nowrap;" width="1">
                  <span class="edate">
                    %if;event.has_date;%event.date; :
                    %else;--- :
                    %end;
                  </span>
                </td>
                <td valign="top">
                  <span>
                    %apply;capitalize(event.name)%sp;
                    %if;event.has_spouse;([with] %event.spouse;)%end;
                    %if;event.has_place; - %event.place; %end;
                  </span>
                  %if;event.has_witnesses;
                    <p style="margin:0;">
                      %foreach;event_witness;
                        <span>%apply;capitalize(event_witness_kind) :</span>
                        %apply;short_display_person("event_witness")<br/>
                      %end;
                    </p>
                  %end;
                  %if;event.has_note;<div>%event.note;</div>%end;
                    %if;event.has_src;<span><em>[*source/sources]1: %event.src;</em></span>%end;
                </td>
              </tr>
            %end;
          </table>
        %end;
        <br>
      %end;
      %if;(evar.src = "on" and ancestor.has_sources)
        <em>
          [*source/sources]1 :
          %foreach;ancestor.source;
            %source_type;: %apply;clean_html_tags(source)
            %if;(not is_last),%sp;%end;
          %end;
        </em>
      %end;
    </p>
  %end;
  %if;((evar.notes = "on" and (ancestor.has_notes or ancestor.has_event) or evar.src = "on" and ancestor.has_sources) and evar.inline != "on")
    %if;(evar.notes = "on")%[[*note/notes]0%sp;
    %else;%[[*source/sources]1%sp;
    %end;
    <b><a href="#notes-%ancestor.anc_sosa.v;">%ancestor.anc_sosa;</a></b>%].
  %end;
%end;

%define;child_long_info(spec)
  <b>%apply;my_link(child.access, child.child_name, child.is_restricted)%nn;</b>%nn;
  %apply;somebody_long_info("child")
  %if;(child.sosa_in_list != "").
    %if;(evar.only != "on")[*see]%sp;
      <a href="#%child.sosa_in_list;"><b>%child.sosa_in_list;</b></a>.
    %end;
  %else;
    %apply;somebody_extra_info("child").
    %foreach;child.family;
      %if;(evar.inline= "on" and (((child.has_notes or child.has_event) and evar.notes = "on") or (child.has_sources and evar.src = "on")))
        <br>
      %end;
      %apply;capitalize%with;
        %apply;married_to%with;
          %child.is_male;
        %and;
          %if;(on_marriage_date != "") %on_marriage_date;%end;
          %if;(marriage_place != ""), %marriage_place;, %end;
        %end;%sp;
      %end;
      %apply;somebody("spouse")%nn;
      %if;spouse.has_parents;,%sp;
        %apply;a_of_b%with;
          %if;spouse.is_male;[son/daughter/child]0
          %else;[son/daughter/child]1%end;
        %and;
          %apply;somebody_spouse_parent("father") [and]
          %apply;somebody_spouse_parent("mother")
        %end;
      %end;.
      %if;are_divorced;[*divorced]0%divorce_date;.%nl;
      %elseif;are_separated;[*separated]0.%nl;
      %end;
    %end;
    %if;((evar.notes = "on" and (child.has_notes or child.has_event) and evar.inline = "on") or (evar.src = "on" and child.has_sources and evar.inline = "on"))
      <p class="asc_notes_src_inline">
        %if;(evar.notes = "on" and (child.has_notes or child.has_event))
          [*note/notes]0 : %apply;clean_html_tags(child.notes)
          <br>
          %if;child.has_event;
            <table>
              %foreach;child.event;
                <tr>
                  <td valign="top" style="white-space: nowrap;" width="1">
                    <span class="edate">
                      %if;event.has_date;%event.date; :
                      %else;--- :
                      %end;
                    </span>
                  </td>
                  <td valign="top">
                    <span>
                      %apply;capitalize(event.name)%sp;
                      %if;event.has_spouse;([with] %event.spouse;)%end;
                      %if;event.has_place; - %event.place; %end;
                    </span>
                    %if;event.has_witnesses;
                      <p style="margin:0;">
                        %foreach;event_witness;
                          <span>%apply;capitalize(event_witness_kind) :</span>
                          %apply;short_display_person("event_witness")<br/>
                        %end;
                      </p>
                    %end;
                    %if;event.has_note;<div>%event.note;</div>%end;
                      %if;event.has_src;<span><em>[*source/sources]1: %event.src;</em></span>%end;
                  </td>
                </tr>
              %end;
            </table>
          %end;
          <br>
        %end;
        %if;(evar.src = "on" and child.has_sources)
          <em>
            [*source/sources]1 :
            %foreach;child.source;
              %source_type;: %apply;clean_html_tags(source)
              %if;(not is_last),%sp;%end;
            %end;
          </em>
        %end;
      </p>
    %end;
    %if;((evar.notes = "on" and (child.has_notes or child.has_event) or evar.src = "on" and child.has_sources) and evar.inline != "on")
      %if;(evar.notes = "on")%[[*note/notes]0%sp;
      %else;%[[*source/sources]1%sp;
      %end;
      <b>
        <a href="#notes-%ancestor.anc_sosa.v;%if;("spec" != "")-spec%end;%apply;letter(child_cnt)">
          %ancestor.anc_sosa;%if;("spec" != "")-spec%end;%apply;letter(child_cnt)
        </a>
      </b>%].
    %end;
  %end;
%end;

%define;long_display_ancestor_families()
  %if;ancestor.is_male;
    ...
    %foreach;ancestor.family;
      %if;(family.index = ancestor.family.index)
        %apply;married_to%with
          %ancestor.is_male;
        %and;
          %if;(on_marriage_date != "") %on_marriage_date;%end;
          %if;(marriage_place != ""), %marriage_place;, %end;
        %end;...
      %end;
    %end;
  %else;
    %foreach;ancestor.family;
      %if;(family.index = ancestor.family.index)
        ...
        %if;(evar.witn = "on" and has_witnesses)([witness/witnesses]1:
          %foreach;witness;
            %if;(not is_first),%nl;%end;
            %apply;link2(witness.var)
          %end;),
        %end;
        %if;(evar.comm = "on" and (has_comment or has_marriage_note))
          (%comment;
           %if;has_marriage_note;
             %marriage_note;
           %end;)%nl;
        %end;
        <i>[having as children]:</i>
        <p>
          <ol style="list-style-type:lower-latin">
          %foreach;child;
            %if;(evar.siblings = "on" or child.sosa_in_list != "")
              <li>%apply;child_long_info("")</li>
            %end;
          %end;
          </ol>
        </p>
      %end;
    %end;
    %if;(evar.siblings = "on")
      %( father's other children %)
      %foreach;ancestor.spouse.family;
        %if;(spouse.index != ancestor.index and nb_children > 0)
          <i>... [having as children]%sp;</i>
          <a href="#%family.father.sosa_in_list;
          "><b>%family.father.sosa_in_list;
          </b></a>-(X%family_cnt;):
          <p><ol style="list-style-type:lower-latin">
          %foreach;child;
            <li>%apply;child_long_info(family_cnt)</li>
          %end;
          </ol></p>
        %end;
      %end;
      %( mother's other children %)
      %foreach;ancestor.family;
        %if;(spouse.index != ancestor.spouse.index and nb_children > 0)
          <i>... [having as children]%sp;</i>
          <a href="#%family.mother.sosa_in_list;
          "><b>%family.mother.sosa_in_list;
          </b></a>-(X%family_cnt;):
          <p><ol style="list-style-type:lower-latin">
          %foreach;child;
            <li>%apply;child_long_info(family_cnt)</li>
          %end;
          </ol></p>
        %end;
      %end;
    %end;
  %end;
%end;

%define;dates_in_interval(xx)
  %if;(evar.after != "" and
       (xx.birth_date.year = "" and
        xx.baptism_date.year = "" and
        xx.death_date.year = "" and
        xx.burial_date.year = "" and
        xx.cremated_date.year = "" or
        xx.birth_date.year != "" and
        xx.birth_date.year < evar.after or
        xx.baptism_date.year != "" and
        xx.baptism_date.year < evar.after or
        xx.death_date.year != "" and
        xx.death_date.year < evar.after or
        xx.burial_date.year != "" and
        xx.burial_date.year < evar.after or
        xx.cremated_date.year != "" and
        xx.cremated_date.year < evar.after) or
       evar.before != "" and
       (xx.birth_date.year = "" and
        xx.baptism_date.year = "" and
        xx.death_date.year = "" and
        xx.burial_date.year = "" and
        xx.cremated_date.year = "" or
        xx.birth_date.year != "" and
        xx.birth_date.year > evar.before or
        xx.baptism_date.year != "" and
        xx.baptism_date.year > evar.before or
        xx.death_date.year != "" and
        xx.death_date.year > evar.before or
        xx.burial_date.year != "" and
        xx.burial_date.year > evar.before or
        xx.cremated_date.year != "" and
        xx.cremated_date.year > evar.before))false%nn;
  %else;true%end;
%end;

%define;table_header()
  %reset_count;
  <th>[*d'Aboville]</th>
  %incr_count;
  <th>[*person/persons]0</th>
  %incr_count;
  %if;(evar.birth = "on")
    <th>[*birth]</th>
    %incr_count;
  %end;
  %if;(evar.birth_place = "on")
    <th>[*where born]</th>
    %incr_count;
  %end;
  %if;(evar.marr = "on" and evar.t="H")
    <th>[*spouse/spouses]1</th>
    %incr_count;
  %end;
  %if;(evar.spouse_date = "on" and evar.marr = "on" and evar.t="H")
    <th>[*birth]</th>
    %incr_count;
  %end;
  %if;(evar.marr_date = "on")
    <th>[*marriage/marriages]1</th>
    %incr_count;
  %end;
  %if;(evar.marr_place = "on")
    <th>[*where married]</th>
    %incr_count;
  %end;
  %if;(evar.child = "on")
    <th>[*nb children]</th>
    %incr_count;
  %end;
  %if;(evar.death = "on")
    <th>[*death]</th>
    %incr_count;
  %end;
  %if;(evar.death_place = "on")
    <th>[*where dead]</th>
    %incr_count;
  %end;
  %if;(evar.death_age = "on")
    <th>[*age]</th>
    %incr_count;
  %end;
  %if;(evar.occu = "on")
    <th>[*occupation/occupations]1</th>
    %incr_count;
  %end;
%end;

%(
si t=H on active rowspan pour les données du mari et du couple
si t=I on affiche pas les données 
%)
%define;table_row(xx, prefx, fam_cnt, ch_count, yy)

  %let;famx;%if;(not has_families or evar.t="I")1%else;fam_cnt%end;%in;
  %let;zro;%if;("prefx"="-1")0%else;1%end;%in;
  %let;row_span;%if;(nb_families>1 and evar.t="H" and (evar.marr = "on" or evar.marr_date = "on" or evar.marr_place = "on"))rowspan="%xx.nb_families;"%end;%in;
  %if;(famx=1)
    %if;("yy"="0")
      <td %row_span;>
      %if;(zro=1)%if;("prefx"!="")prefx.%end;ch_count%else;1%end;
      </td>
    %elseif;(evar.t="I")
      <td style="text-align:right">& &nbsp;
      </td>
    %end;
  %end;
  %if;(famx=1)
    %if;("yy"="0")
      <td %row_span;>
        %apply;image_MF("xx")
        %apply;link%with;%xx.access;%and;
          %xx.first_name; %xx.surname;
        %end
        %xx.title;
      </td>
    %elseif;(evar.t="I")
      <td style="text-align:right">
        %apply;image_MF("xx")
        %apply;link%with;%xx.access;%and;
          %xx.first_name; %xx.surname;
        %end
        %xx.title;
        &nbsp; 
      </td>
    %end;
  %end;
  %if;(evar.birth = "on" and famx=1)
    <td %row_span;>
      %if;xx.has_approx_birth_date;
        %xx.slash_approx_birth_date;
      %end;
    </td>
  %end;
  %if;(evar.birth_place = "on" and famx=1)
    <td %row_span;>
      %if;xx.has_approx_birth_place;
        %xx.approx_birth_place;
      %end;
    </td>
  %end;
  %if;(evar.marr = "on" and evar.t="H")
    %if;(xx.nb_families = 0)
      <td></td>
    %else;
      %foreach;xx.family;
        %if;(family_cnt = fam_cnt)
          <td class="%if;(xx.nb_families > 1)border-bottom-0%end;">
            %apply;image_MF("spouse")
            %apply;link%with;%spouse.access;%and;
              %spouse;
            %end;
          </td>
        %end;
      %end;
    %end;
  %end;
  %if;(evar.spouse_date = "on" and evar.marr = "on" and evar.t="H")
    %if;(xx.nb_families = 0)
      <td></td>
    %else;
      %foreach;xx.family;
        %if;(family_cnt = fam_cnt)
          <td class="%if;(xx.nb_families > 1)border-bottom-0%end;">
          %if;spouse.has_approx_birth_date;
            %spouse.slash_approx_birth_date;
          %end;
          </td>
        %end;
      %end;
    %end;
  %end;
  %if;(evar.marr_date = "on")
    %if;(xx.nb_families = 0)
      <td></td>
    %else;
      %foreach;xx.family;
        %if;(family_cnt = fam_cnt)
          <td class="%if;(family_cnt > 1)border-bottom-0%end; text-nowrap">
            %if;(slash_marriage_date != "")
              %if;(wizard and not cancel_links and ("yy"="1" or evar.t="H"))
                <a href="%prefix;m=MOD_FAM;i=%family.index;;ip=%index;">
                  <img class="ml-0 mr-1 mb-1" src="%image_prefix;/picto_molette.png" width="13" height="13" alt="[modify::family/families]0" title="[modify::family/families]0"%/>%nn;
                </a>%nn;
              %end;
              %if;("yy"="1" or evar.t="H")%slash_marriage_date;%end;
            %end;
          </td>
        %end;
      %end;
    %end;
  %end;
  %if;(evar.marr_place = "on")
    %if;(xx.nb_families = 0)
      <td></td>
    %else;
      %foreach;xx.family;
        %if;(family_cnt = fam_cnt)
          <td class="%if;(xx.nb_families>1)border-bottom-0%end;">
            %if;(marriage_place != "")
              %if;("yy"="1" or evar.t="H")%marriage_place;%end;
            %end;
          </td>
        %end;
      %end;
    %end;
  %end;
  %if;(evar.child = "on" and famx=1)
    %if;(xx.nb_families = 0)
      <td></td>
    %else;
      %if;(evar.marr = "on" or evar.marr_date = "on" or evar.marr_place = "on")
        %foreach;xx.family;
          %if;(family_cnt = fam_cnt)
            <td align="center" class="%if;(xx.nb_families > 1)border-bottom-0%end;">
              %if;("yy"="1" or evar.t="H")%xx.nb_children;%end;
            </td>
          %end;
        %end;
      %else;
        <td>%xx.nb_children_tot;
          %if;(xx.nb_families>1) (%xx.nb_families; fam.)%end;
        </td>
      %end;
    %end;
  %end;
  %if;(evar.death = "on" and famx=1)
    <td %row_span;>
      %if;xx.has_approx_death_date;
        %xx.slash_approx_death_date;
      %end;
    </td>
  %end;
  %if;(evar.death_place = "on" and famx=1)
    <td %row_span;>
      %if;xx.has_approx_death_date;
        %xx.approx_death_place;
      %end;
    </td>
  %end;
  %if;(evar.death_age = "on" and famx=1)
    <td %row_span;>
      %if;xx.computable_death_age;+ %xx.death_age;%end;
      %if;xx.computable_age;%xx.age;%end;
    </td>
  %end;
  %if;(evar.occu = "on" and famx=1)
    <td %row_span;>
      %if;(xx.has_occupation)
        %xx.occupation
      %end;
    </td>
  %end;
%end;


%define;table_family()
  %if;(evar.marr = "on" or evar.marr_date = "on" or evar.marr_place = "on")
    %foreach;ancestor.family;
      %if;(family_cnt != 1)
        <tr>
          %if;(evar.marr = "on")
            <td class="border-top-0 %if;(ancestor.nb_families != family_cnt)border-bottom-0%end;">
              %apply;image_MF("spouse")
              %apply;link%with;%spouse.access;%and;
                %spouse;
              %end;
            </td>
          %end;
          %if;(evar.marr_date = "on")
            <td class="border-top-0 %if;(ancestor.nb_families != family_cnt)border-bottom-0%end;">
              %if;(slash_marriage_date != "")
                %slash_marriage_date;
              %end;
            </td>
          %end;
          %if;(evar.marr_place = "on")
            <td class="border-top-0 %if;(ancestor.nb_families != family_cnt)border-bottom-0%end;">
              %if;(marriage_place != "")
                %marriage_place;
              %end;
            </td>
          %end;
          %if;(evar.child = "on")
            <td class="border-top-0 %if;(ancestor.nb_families != family_cnt)border-bottom-0%end;">
              %nb_children;
            </td>
          %end;
        </tr>
      %end;
    %end;
  %end;
%end;

%( initialise le compteur à/avec la valeur passée en paramètre %)
%define;init_count(prev_count)
  %reset_count;
  %for;i;0;prev_count;
    %incr_count;
  %end;
%end;

%define;one_child(xx, prefx)
  %incr_count;
  %let;prfx;prefx%in;
  %if;xx.has_families;
    %if;(evar.t="H")
      %foreach;family;
        <tr>
        %apply;table_row("xx", prfx, family_cnt, count, "0")
        </tr>
      %end;
    %elseif;(evar.t="I")
        <tr>
        %apply;table_row("xx", prfx, 1, count, "0")
        </tr>
      %if;(evar.marr = "on" or evar.marr_date = "on" or evar.marr_place = "on")
        %foreach;family;
          <tr>
          %apply;table_row("xx.spouse", prfx, 1, count, "1")
          </tr>
        %end;
      %end;
    %end;
  %else;
    <tr>
      %apply;table_row("xx", prfx, family_cnt, count, "0")
    </tr>
  %end;
%end;

%define;one_family(xx, prefx)
  %reset_count;
    %let;prfx;prefx%in;
    %foreach;family;
        %let;fam;%apply;letter(family_cnt)%in;
        %let;nprfx;%if;(nb_families>1)%prfx;%fam;%else;%prfx;%end;%in;
        %foreach;xx.child;
        %apply;one_child("xx", nprfx)
      %end;
    %end;
%end;

%define;one_level(xx, lv, max_l, prefx, ch_cnt)
  %let;npref;%if;("prefx"!="")prefx.%end;ch_cnt%in;
  %if;(lv<max_l)
    %if;xx.has_families;
      %foreach;family;
        %let;fam;%apply;letter(family_cnt)%in;
        %let;nnpref;%if;(nb_families>1)%npref;%fam;%else;%npref;%end;%in;
        %foreach;child;
          %apply;one_level("child", lv+1, max_l, nnpref, child_cnt)
        %end;
      %end;
    %else;
    %end
  %else;
    %apply;one_family("self", npref)
  %end;
%end;

%define;rebuild_url(X)
  %let;new_url;%prefix;m=D;
  p=%first_name;;n=%surname;;t=X;
  %if;(evar.birth = "on")
    birth=on;
  %end;
  %if;(evar.birth_place = "on")
    birth_place=on;
  %end;
  %if;(evar.marr = "on")
    marr=on;
  %end;
  %if;(evar.spouse_date = "on")
    spouse_date=on;
  %end;
  %if;(evar.marr_date = "on")
    marr_date=on;
  %end;
  %if;(evar.marr_place = "on")
    marr_place=on;
  %end;
  %if;(evar.child = "on")
    child=on;
  %end;
  %if;(evar.death = "on")
    death=on;
  %end;
  %if;(evar.death_place = "on")
    death_place=on;
  %end;
  %if;(evar.death_age = "on")
    death_age=on;
  %end;
  %if;(evar.occu = "on")
    ;occu=on;
  %end;
  %if;(evar.gen = "on")
    gen=on;
  %end;
  %if;(evar.cgl = "on")
    cgl=on;
  %end;
  v=%evar.v;;%in;
  %new_url;
%end;

[
en: Click here
fr: Cliquer ici
]
%if;(evar.t="H")
  <a role="button" class="btn btn-link ml-1 px-0" href="%apply;rebuild_url("I")"><i class="fa fa-chain-broken fa-lg" title="[*toggle table mode]"></i></a>%nn;
%else;
  <a role="button" class="btn btn-link ml-1 px-0" href="%apply;rebuild_url("H")"><i class="fa fa-chain-broken fa-lg" title="[*toggle table mode]"></i></a>%nn;
%end; 
[
en: to switch display mode (one line per descendant/one line per couple), and here
fr: pour changer le mode d'affichage (une ligne par descendant/une ligne par couple), et ici
]
<a role="button" class="btn btn-link ml-1 px-0" href="%prefix;p=%first_name;;n=%surname;;m=D"><i class="fa fa-chain-broken fa-lg" title="[*back to menu]"></i></a>
[
en: to return to Descendants menu.
fr: pour retourner au menu des Descendants.
]
<br>
<table class="table table-bordered ascends_table">
  %reset_count;
  <tr class="ascends_table_header">%apply;table_header()</tr>
  %let;nb_col;%count;%in;
  %let;max;%evar.v;%in;
  %reset_count;
  %apply;one_child("self", "-1")
  %for;lev;0;max;
    <tr>
      <th align="left" colspan="%nb_col;">[*generation/generations]0 %expr(lev+1)</th>
    </tr>
    %apply;one_level("self", 0, lev, "", 1)
  %end;
</table>
%(<p>[*total]: %count; [[person/persons]1@(c)]</p>%)

%include.trl;
%include.copyr;
</div>
%include.js;
</body>
</html>
