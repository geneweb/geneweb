function t(t){return t+L.t}function e(t){const e=[],n=s(t);if(n&&e.push(n),k){const n=s("-N"+t);n&&e.push(n);const i=s("-S"+t);i&&e.push(i)}return e}function n(t,e){const n=Math.PI/180*e;return{x:l+t*Math.cos(n),y:u+t*Math.sin(n)}}const i=document.documentElement,s=t=>document.getElementById(t),o=s("fanchart"),a=s("pixel").getContext("2d",{i:!0});var c,r,l,u,h,d,f,p;for(var m in document.styleSheets)if("fc-auto"==document.styleSheets[m].title){document.styleSheets[m];break}var g={},v=[],$="frequency",b=!1,w=0,x=0,M=0,S=0;const y={eventOrder:["birth","baptism","marriage","death","burial"],eventToClass:{birth:"n",baptism:"b",marriage:"m",death:"d",burial:"s"},eventToLabel:{birth:"N",baptism:"B",marriage:"M",death:"D",burial:"S"}},C={get types(){return y.eventOrder},o:t=>y.eventToClass[t],label:t=>y.eventToLabel[t],count:t=>t+"_count",place:t=>t+"_place",l:t=>t.substring(0,2),u:t=>"has_"+C.l(t),h:t=>y.eventOrder.find(e=>C.o(e)===t),p:t=>y.eventOrder.find(e=>C.l(e)===t),m:t=>y.eventOrder.includes(t),translate:(t,e=1)=>{const n=e>1?t+"s":t;return window.FC_TRANSLATIONS?.[n]||t}},P={security:.95,v:1.12,$:220,M:[180,220,359],S:[56,56,54,54,70,72,100,150,130,90],C:["S1","C3","C2","C1","R4","R3","R2","R1","R1","R1"],P:{A:1.1,k:1.05},L:[4,14,24,34,44,54],R:1,_:4},A=t=>document.createElementNS("http://www.w3.org/2000/svg",t);let k=!1,L={target:null,t:""},R=P.$,_=0;const N={elements:{},collections:{},getElementById:function(t){return this.elements[t]||(this.elements[t]=s(t)),this.elements[t]},getElementsByClassName:function(t){return this.collections[t]||(this.collections[t]=Array.from(document.getElementsByClassName(t))),this.collections[t]},N:function(t="all"){"all"===t?(this.elements={},this.collections={}):"collections"===t&&(this.collections={})},preload:function(){["b-age","b-places-colorise","b-sort-places"].forEach(t=>{this.getElementById(t)}),["DA0","DA1","DA2","DA3","DA4","DA5","DA6"].forEach(t=>{this.getElementById(t)}),["DAM0","DAM1","DAM2","DAM3","DAM4","DAM5","DAM6"].forEach(t=>{this.getElementById(t)})}},T={config:{T:link_to_person,D:{module:"A",I:"FC"},O:{place:{module:"MOD_DATA",data:"place"}}},B:function(){const t=new URLSearchParams(window.location.search);return{H:t.get("tool")||"",F:t.has("sort")?"alphabetical":"frequency",G:t.has("events"),j:"couple"===t.get("mode"),angle:parseInt(t.get("angle"))||220,q:"num"===t.get("implex")?"numbered":"full"===t.get("implex")?"full":"reduced",U:t.get("lock")||null}},V:function(t,e={}){const n={W:!0,Z:!1,J:null,K:!0,Y:!0,X:!0,...e};return n.Z?this.tt(t):this.et(t,n)},nt:function(t,e={}){const n={it:!0,st:!0,...e},i=this.config.T,s=[];if(s.push(`m=${this.config.O.place.module}`),s.push(`data=${this.config.O.place.data}`),n.it&&t.length>2){const e=t.slice(0,-2);s.push(`s=${encodeURIComponent(e)}`)}return s.push(`s1=${encodeURIComponent(t)}`),i+s.join("&")},ot:function(t={}){const e=ancestor.S1;if(!e)return;const n={W:!0,K:!0,Y:!0,X:!1,...t},i=this.V(e,n);history.replaceState(null,"",i)},ct:function(t,e={}){const n=ancestor.S1;if(!n)return;const i=p;p=t;const s={J:t,W:!0,K:!0,Y:!0,...e},o=this.V(n,s);p=i,window.location=o},rt:function(t,e=!1,n=!1){if(n||e||I.lt(),!t||!t.fnk||!t.snk)return console.warn("URLManager: Personne invalide pour navigation",t),!1;const i=this.V(t,{Z:!n,W:n});return e?window.open(i,"_blank"):window.location.href=i,!0},ut:function(t,e=!1){const n=this.nt(t);return e?window.open(n,"_blank"):window.location.href=n,!0},tt:function(t){const e=[`p=${t.fnk}`,`n=${t.snk}`];return t.oc&&e.push(`oc=${t.oc}`),this.config.T+e.join("&")},et:function(t,e){const n=[`m=${this.config.D.module}`,`t=${this.config.D.I}`,`p=${t.fnk}`,`n=${t.snk}`];return t.oc&&n.push(`oc=${t.oc}`),e.W&&this.ht(n,e),this.config.T+n.join("&")},ht:function(t,e){const n=e.J||p;if(t.push(`v=${n}`),e.Y&&(k?t.push("mode=couple"):220!==R&&t.push(`angle=${R}`)),e.K){if(tool&&t.push(`tool=${tool}`),"place"===tool){"alphabetical"===$&&t.push("sort");const e=document.querySelector(".places-panel");e?.classList.contains("show-events")&&t.push("events");const n=E?.state?.U||new URLSearchParams(window.location.search).get("lock");n&&t.push(`lock=${encodeURIComponent(n)}`)}"numbered"===implexMode?t.push("implex=num"):"full"===implexMode&&t.push("implex=full")}}},D={dt:function(t){const e=Number(t);if(!Number.isFinite(e)||e<=0)return null;const n=[40,55,70,85];for(let t=0;t<n.length;t++)if(e<n[t])return t;return 4},ft:function(t){const e=this.dt(t);return null!==e?"DA"+e:""},gt:function(t){const e=Number(t);if(!Number.isFinite(e)||e<0)return"";const n=[10,25,40,55];for(let t=0;t<n.length;t++)if(e<n[t])return"DAM"+t;return"DAM4"},vt:function(t){a.fillStyle=t,a.fillRect(0,0,1,1);const e=a.getImageData(0,0,1,1).data,n=e[0]/255,i=e[1]/255,s=e[2]/255;return.2126*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))+.7152*(i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4))+.0722*(s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4))},$t:function(t,e){return(this.vt(t)+.05)/(this.vt(e)+.05)}},I={bt:new Map,wt:new Map,xt:function(t=null){const e=t||p;if(z.cache&&z.cache.Mt(),this.wt.has(e)){const t=this.wt.get(e);return g=t.St,v=t.yt,void this.Ct()}this.Pt();const n=this.At(e);Object.values(n).forEach(t=>{this.kt(t)}),this.Lt(),this.wt.set(e,{St:{...g},yt:[...v],flags:this.Rt()})},At:function(t){const e={};for(let n=1;n<=t+1;n++){const t=(1<<n)-1;for(let i=1<<n-1;i<=t;i++){const t="S"+i;ancestor[t]&&(e[t]=ancestor[t])}}return e},Pt:function(){g={},v=[],C.types.forEach(t=>{window[C.u(t)]=!1})},kt:function(t){C.types.forEach(e=>{const n=C.place(e);t[n]?.trim()&&this._t(t[n],e,t)})},_t:function(t,e,n){const i=t.replace(/^\?, /,"");if(!g[i]){const t=this.Nt(i,e,n);g[i]=this.Tt(i,t)}this.Dt(g[i],e),n.sosa},Nt:function(t,e,n){const i=e+"_sub",s=e+"_main";return{fullName:t,It:!!n[i],zt:n[i]||null,Ot:n[s]||null}},Tt:function(t,e){const n={Et:0,c:null,Bt:0,It:e.It,zt:e.zt,Ot:e.Ot,Ht:{Ft:t,Gt:e.It,jt:[]}};return C.types.forEach(t=>{n[C.count(t)]=0,n[C.l(t)]=!1}),n},Dt:function(t,e,n){const i=C.count(e),s=C.l(e),o=n?Math.floor(Math.log2(n))+1:0;t.Bt=Math.max(t.Bt,o),t[i]++,t.Et++,t[s]||(t[s]=!0,window[C.u(e)]=!0,t.Ht["jt"].push(e))},Lt:function(){if(!g||"object"!=typeof g)return console.error("‚ùå Objet lieux corrompu, r√©initialisation"),g={},void(v=[]);try{v=Object.entries(g)}catch(t){return console.error("‚ùå Erreur lors de la conversion lieux->array:",t),void(v=[])}v.forEach(([t,e],n)=>{e&&"object"==typeof e?e.c="L"+n:console.warn(`‚ö†Ô∏è Donn√©es corrompues pour le lieu: ${t}`)})},Rt:function(){const t={};return C.types.forEach(e=>{t[C.u(e)]=window[C.u(e)]}),t},Ct:function(){const t=this.wt.get(p);t?.flags&&Object.entries(t.flags).forEach(([t,e])=>{window[t]=e})},qt:function(){let t=0,e=0,n=[];return Object.entries(g).forEach(([i,s])=>{s.It&&s.Ot&&(e++,g[s.Ot]||(n.push(i),s.It=!1,s.zt=null,s.Ot=null,s.Ht["Gt"]=!1,t++))}),n.length>0&&console.warn("‚ö†Ô∏è Sous-lieux orphelins corrig√©s:",n),{Ut:t,Vt:e,orphans:n,Wt:Object.keys(g).length}},Zt:function(t,e){const n={Jt:"color-"+(e%12+1),Kt:[]};return C.types.forEach(e=>{t[C.l(e)]&&n.Kt.push(C.o(e))}),n},Qt:function(){const t={};return C.types.forEach(e=>{t[e]=0}),Object.values(g).forEach(e=>{C.types.forEach(n=>{const i=C.count(n);t[n]+=e[i]||0})}),t},lt:function(){this.bt.clear(),this.wt.clear()}},z={cache:{elements:{},Yt:null,Xt:null,fragment:null,Mt:function(){this.Yt=null}},initialize:function(){return this.cache.elements={te:document.querySelector(".places-panel"),ee:document.querySelector(".places-list"),ne:document.querySelector(".summary-places-info"),ie:document.querySelectorAll(".summary-event-count"),se:document.querySelector(".summary-total-events"),oe:document.querySelector(".summary-persons-count")},this.cache.elements.ee?(this.ae(),this.ce(),this.re(),!0):(console.error("‚ùå √âl√©ments HTML requis manquants"),!1)},le:function(t,e,n){const i=n%12+1;return`\n      <div class="place-row" data-index="${n}">\n        <div class="place-indicators" id="indic-${n}"></div>\n        <div class="place-content" id="place-${n}" ${`\n      data-place="${t}"\n      data-place-class="${e.c||""}"\n      data-total="${e.Et||0}"\n    `.trim()}>\n          <div class="place-left">\n            <div class="place-color color-${i}"></div>\n            <div class="place-name">${this.ue(t,e)}</div>\n          </div>\n          <div class="place-right">\n            <div class="place-events">\n              ${this.he(e)}\n            </div>\n            <div class="place-count">${e.Et||0}</div>\n          </div>\n        </div>\n      </div>\n    `},ue:function(t,e){return"alphabetical"===$&&e.It?`<span class="sublocation-indicator">‚îî </span>${e.zt||t}`:t},he:function(t){return C.types.map(e=>{const n=C.label(e),i=C.count(e),s=t[i]||0;return`\n        <div class="event-item ${s>0?"active":""}" data-event="${e}">\n          <span class="event-count">${s>1?s:""}</span>\n          <span class="event-label">${n}</span>\n        </div>\n      `}).join("")},ae:function(){const t=this.cache.elements.ee;if(!t)return;const e=this.de(),n=document.createDocumentFragment();e.forEach(([t,e],i)=>{const s=this.fe(t,e,i);e.pe=s.querySelector(".place-content"),e.me=i,e.ge=s.querySelector(".place-indicators"),n.appendChild(s)}),t.innerHTML="",t.appendChild(n)},de:function(){return this.cache.Yt&&this.cache.Xt===$||(this.cache.Yt=this.ve(),this.cache.Xt=$),this.cache.Yt},ve:function(){if("alphabetical"===$){const t=new Map;Object.entries(g).forEach(([e,n])=>{n.It&&n.Ot?(t.has(n.Ot)||t.set(n.Ot,{$e:null,be:[]}),t.get(n.Ot).be.push([e,n])):(t.has(e)||t.set(e,{$e:null,be:[]}),t.get(e).$e=[e,n])});const e=[];return Array.from(t.entries()).sort(([t],[e])=>t.localeCompare(e,"fr",{we:"base"})).forEach(([t,n])=>{n.$e&&e.push(n.$e),n.be.sort(([t],[e])=>t.localeCompare(e,"fr",{we:"base"})).forEach(t=>e.push(t))}),e}return Object.entries(g).sort((t,e)=>e[1].Et-t[1].Et)},fe:function(t,e,n){const i=document.createElement("div");i.className="place-row",i.dataset.index=n;const s=document.createElement("div");s.className="place-indicators",s.id=`indic-${n}`;const o=document.createElement("div");return o.className="place-content",o.id=`place-${n}`,o.dataset.place=t,o.dataset.placeClass=e.c||"",o.dataset.total=e.Et||0,o.innerHTML=this.xe(t,e,n),i.appendChild(s),i.appendChild(o),i},xe:function(t,e,n){return`\n      <div class="place-left">\n        <div class="place-color color-${n%12+1}"></div>\n        <div class="place-name">${this.Me(t,e)}</div>\n      </div>\n      <div class="place-right">\n        <div class="place-events">${this.Se(e)}</div>\n        <div class="place-count">${e.Et||0}</div>\n      </div>\n    `},Me:function(t,e){return"alphabetical"===$&&e.It&&e.zt?`<span class="sublocation-indicator">‚îî </span>${e.zt}`:t},Se:function(t){return C.types.map(e=>{const n=t[C.count(e)]||0;return`\n        <div class="event-item ${n>0?"active":""}" data-event="${e}">\n          <span class="event-count">${n>1?n:""}</span>\n          <span class="event-label">${C.label(e)}</span>\n        </div>\n      `}).join("")},ce:function(){const t=this.cache.elements.te.querySelector(".generation-count");if(t){const e=window.FC_TRANSLATIONS?.[p>1?"ye":"Ce"]||"g√©n√©ration";t.textContent=`${p} ${e}`}const e=Object.keys(g).length,n=window.FC_TRANSLATIONS?.[e>1?"Pe":"place"]||"lieu";this.cache.elements.ne.textContent=`${e} ${n}`;const i=I.Qt();C.types.forEach((t,e)=>{const n=this.cache.elements.ie[e];if(n){const e=i[t]||0;n.textContent=e;const s=n.previousElementSibling;s&&(s.dataset.eventType=t,s.dataset.eventCount=e)}});const s=Object.values(i).reduce((t,e)=>t+e,0);this.cache.elements.se.textContent=s,this.Ae()},Ae:function(){const t=this.cache.elements.oe;if(!t)return;const e=I.At(p);let n=0;Object.values(e).forEach(t=>{C.types.some(e=>{const n=C.place(e);return t[n]?.trim()})&&n++}),t.textContent=n;const i=window.FC_TRANSLATIONS?.[n>1?"ke":"Le"]||"personne";t.title=`${n} ${i} avec lieux`},re:function(){this.cache.elements.ee&&(E.initialize(),this.cache.elements.ee.addEventListener("click",t=>{const e=t.target.closest(".place-content");if(e&&(t.preventDefault(),t.stopPropagation(),t.ctrlKey||t.metaKey)){const t=e.dataset.place;t&&T.ut&&T.ut(t,!0)}}))},Re:function(){let t=null;document.querySelectorAll(".summary-event-label").forEach(e=>{const n=e.dataset.eventType;n&&(e.style.cursor="pointer",e.addEventListener("mouseenter",()=>{t=E.state.U?{place:E.state.U,events:[...E.state._e]}:null,E.Ne(n)}),e.addEventListener("mouseleave",()=>{if(E.Te(),t){E.state.U=t.place,E.state._e=t.events;const e=g[t.place];e?.pe&&e.pe.classList.add("locked"),E.De()}t=null}))})},Ie:function(t,e){if(e.ctrlKey||e.metaKey){if(t&&T.ut){const e=!0;T.ut(t,e)}}else e.preventDefault()}},O={ze:null,initialize:function(){return z.cache.elements.te?(this.Oe(),this.re(),!0):(console.error("‚ùå PlacesInterface doit √™tre initialis√© avant PlacesPanelControls"),!1)},re:function(){const t=z.cache.elements.te;this.Ee&&t.removeEventListener("click",this.Ee),this.Ee=t=>{t.target.matches(".panel-close")||t.target.closest(".panel-close")||t.target.matches(".panel-toggle")||t.target.closest(".panel-toggle")?(t.preventDefault(),this.Be()):t.target.closest(".sort-toggle")?(t.preventDefault(),this.He()):t.target.closest(".events-toggle")?(t.preventDefault(),this.Fe()):t.target.matches(".search-clear")&&(t.preventDefault(),this.Ge())},t.addEventListener("click",this.Ee),this.je()},je:function(){const t=z.cache.elements.te.querySelector(".search-input");t&&t.addEventListener("input",t=>{clearTimeout(this.ze);const e=t.target.value;e?this.ze=setTimeout(()=>{this.qe(e)},150):this.qe("")})},Oe:function(){this.Ue();const t=z.cache.elements.te;if(b){t.classList.add("show-events");const e=document.querySelector(".events-toggle i");e&&(e.className="far fa-lightbulb")}const e=t.querySelector(".search-input");e&&(e.value="")},Be:function(){const t=z.cache.elements.te,e=t.classList.contains("panel-collapsed");t.classList.toggle("panel-collapsed"),J.Ve(),J.We();const n=t.querySelector(".panel-close i");n&&(n.className=e?"fas fa-chevron-right":"fas fa-chevron-left")},He:function(){$="frequency"===$?"alphabetical":"frequency",z.cache.Mt(),this.Ue(),z.ae(),E.Ze(),T.ot()},Ue:function(){const t=document.querySelector(".sort-toggle i");t&&(t.className="alphabetical"===$?"fas fa-arrow-down-wide-short":"fas fa-arrow-down-a-z");const e=document.querySelector(".sort-toggle");if(e){const t="alphabetical"===$?"sort_alphabetically":"sort_by_frequency";e.title=window.FC_TRANSLATIONS?.[t]||"Changer le tri"}},Fe:function(){b=!b;const t=z.cache.elements.te;t.classList.toggle("show-events");const e=document.querySelector(".events-toggle i");e&&(e.className=t.classList.contains("show-events")?"fas fa-lightbulb":"far fa-lightbulb"),T.ot()},qe:function(t){const e=t.toLowerCase().trim();requestAnimationFrame(()=>{const t=document.querySelectorAll(".place-row");let n=0,i=t.length;e?t.forEach(t=>{const i=t.querySelector(".place-name"),s=(i?i.textContent.toLowerCase():"").includes(e);t.style.display=s?"":"none",s&&n++}):(t.forEach(t=>{t.style.display=""}),n=i),this.Je(e),this.Ke(n,i)})},Ke:function(t,e){let n=document.querySelector(".search-results-count");if(t<e){if(!n){n=document.createElement("div"),n.className="search-results-count",n.style.cssText="font-size: 10px; color: #666; margin-top: 2px;";const t=document.querySelector(".controls-search-section");t&&t.appendChild(n)}n.textContent=`${t}/${e}`,n.style.display="block"}else n&&(n.style.display="none")},Je:function(t){const e=document.querySelector(".search-clear");e&&(e.style.display=t?"block":"none")},Ge:function(){const t=document.querySelector(".search-input");t&&(t.value="",t.focus()),this.qe("")}},E={state:{Qe:new Set,Ye:new Map,Xe:new Map,tn:new Map,en:null,nn:null,U:null,_e:[],an:!1},cn:function(){const t=document.querySelector(".places-list");t&&(t.addEventListener("click",t=>{const e=t.target.closest(".place-content");if(!e)return;const n=e.dataset.place;if(n)if(this.state.U===n){const t=g[n];t?.ge&&t.ge.querySelectorAll(".indicator").forEach(t=>t.remove()),this.state.U=null,this.state._e=[],e.classList.remove("locked"),this.Te(),T.ot()}else{if(this.state.U){const t=g[this.state.U];t?.ge&&t.ge.querySelectorAll(".indicator, .line-break").forEach(t=>t.remove()),document.querySelector(".place-content.locked")?.classList.remove("locked")}this.Te(),this.state.U=n;const t=g[n];t&&(this.state._e=C.types.filter(e=>t[C.l(e)])),e.classList.add("locked"),this.rn(n,"list"),T.ot()}}),t.addEventListener("mousemove",t=>{const e=t.target.closest(".place-content");if(!e)return this.ln(),this.De(),void(this.state.en=null);const n=e.dataset.place;if(!n||this.state.en===n)return;const i=this.state.en;if(this.state.en=n,n===this.state.U)return i&&i!==n&&this.un(i),void this.De();if(i&&i!==this.state.U&&this.un(i),this.state.U){const t=g[this.state.U];t&&(this.hn(this.state.U,t,!1),t.ge&&t.ge.querySelectorAll(".indicator, .line-break").forEach(t=>t.remove()))}this.rn(n,"list")},{capture:!0,passive:!0}),t.addEventListener("mouseleave",e=>{t.contains(e.relatedTarget)||(clearTimeout(this.state.nn),this.state.nn=setTimeout(()=>{this.ln(),this.state.en=null,this.state.U?this.De():this.Te()},50))}),t.addEventListener("mouseenter",()=>{clearTimeout(this.state.nn)}))},ln:function(){this.state.Qe.forEach(t=>{t!==this.state.U&&this.un(t)})},dn:function(){this.state.Xe.forEach((t,e)=>{t.forEach(t=>t.remove())}),this.state.Xe.clear(),this.state.an=!1},De:function(){if(!this.state.U)return;if(!document.body.classList.contains("place"))return;this.state.Qe.clear(),this.state.Qe.add(this.state.U);const t=g[this.state.U];t&&(t.pe&&t.pe.classList.remove("person-match"),this.hn(this.state.U,t,!0),t.ge&&this.state._e.length>0&&this.pn(t.ge,this.state._e),this.mn())},un:function(t){const e=g[t];if(e){if(e.pe){e.pe.classList.remove("person-match");const t=e.pe.closest(".place-row");t&&(t.style.minHeight="",t.classList.remove("tall-row"))}if(this.state.tn.has(e.pe)){const t=this.state.tn.get(e.pe),n=e.pe.querySelector(".place-name");n&&(n.innerHTML=t,n.style.fontWeight=""),this.state.tn.delete(e.pe)}e.ge&&(e.ge.querySelectorAll(".indicator, .line-break").forEach(t=>t.remove()),this.state.Xe.delete(e.ge)),this.hn(t,e,!1),this.state.Qe.delete(t)}},highlight:function(t,e,n="svg",i=!1){if(this.Te(i),!t?.length)return;const s=new Map;t.forEach((t,n)=>{const i=g[t];if(!i)return;const o=e[n]||[];if(s.has(t)){const e=s.get(t),n=[...new Set([...e.events,...o])];s.set(t,{gn:i,events:n})}else s.set(t,{gn:i,events:[...o]});this.state.Qe.add(t)}),this.vn(s,n)},$n:function(t,e){const n=t.ge,i=n.closest(".place-row");if(!n||!e.length)return;n.style.visibility="hidden";const s=[];e.forEach((t,i)=>{const o=document.createElement("div");if(o.className=`indicator ${C.o(t)}`,o.textContent=C.label(t),n.appendChild(o),s.push(o),1===i&&e.length>=4){const t=document.createElement("div");t.className="line-break",n.appendChild(t),s.push(t)}}),e.length>=4&&i&&i.classList.add("tall-row"),requestAnimationFrame(()=>{n.style.visibility="visible",n.style.opacity="0",n.style.transition="opacity 0.1s ease-in",requestAnimationFrame(()=>{n.style.opacity="1"})}),this.state.Xe.set(n,s)},vn:function(t,e){const n=[];t.forEach(({gn:t,events:i},s)=>{t.pe&&(t.pe.classList.add("person-match"),t.It&&"alphabetical"===$&&this.bn(t),t.ge&&i.length>0&&this.pn(t.ge,i),n.push({element:t.pe,index:t.me,wn:s})),"list"!==e&&"totals"!==e||this.hn(s,t,!0)}),this.mn(),n.length>0&&void 0!==V&&setTimeout(()=>{V.xn(n)},50)},rn:function(t,e="list"){const n=!!this.state.U,i=this.state.U===t;this.Te(n);const s=g[t];if(s){if(s.pe){i||s.pe.classList.add("person-match"),this.state.Qe.add(t),s.It&&"alphabetical"===$&&this.bn(s);const e=[];C.types.forEach(t=>{s[C.l(t)]&&e.push(t)}),s.ge&&e.length>0&&this.pn(s.ge,e)}this.hn(t,s,!0),this.mn()}},hn:function(t,e,n){const i=e.c;C.types.forEach(s=>{if(e[C.l(s)]){const e=`${C.l(s)}-${i}`,o=document.getElementsByClassName(e);Array.from(o).forEach(e=>{if(n){const n=e.parentNode,i=(n?.id||"").replace(/^-[NS]/,"");"marriage"===s?i.startsWith("M")&&this.Mn(e,s,t):i.startsWith("S")&&this.Mn(e,s,t)}else this.Sn(e)})}})},Mn:function(t,e,n){t.dataset.originalFill||(t.dataset.originalFill=t.style.fill||""),t.classList.add("svg-place-highlight"),t.classList.add(`event-highlight-${e}`),this.state.Ye.set(t,n)},Sn:function(t){t.classList.remove("svg-place-highlight"),C.types.forEach(e=>{t.classList.remove(`event-highlight-${e}`)}),void 0!==t.dataset.originalFill&&(t.style.fill=t.dataset.originalFill,delete t.dataset.originalFill),this.state.Ye.delete(t)},Ne:function(t){this.Te();const e=[];Object.entries(g).forEach(([n,i])=>{i[C.l(t)]&&e.push(n)}),e.forEach(t=>{const e=g[t];e?.pe&&(e.pe.classList.add("person-match"),this.state.Qe.add(t))}),"marriage"===t?this.yn(e):this.Cn(e,t),this.mn()},yn:function(t){t.forEach(t=>{const e=g[t];if(!e)return void console.warn(`PlacesHighlighter: Lieu inexistant "${t}"`);const n=`ma-${e.c}`,i=document.getElementsByClassName(n);Array.from(i).forEach(e=>{const n=e.parentNode;(n?.id?.replace(/^-[NS]/,"")||"").startsWith("M")&&this.Mn(e,"marriage",t)})})},Cn:function(t,e){C.m(e)?t.forEach(t=>{const n=g[t];if(!n)return void console.warn(`PlacesHighlighter: Lieu inexistant "${t}"`);const i=n.c,s=`${C.l(e)}-${i}`,o=document.getElementsByClassName(s);Array.from(o).forEach(n=>{const i=n.parentNode;(i?.id?.replace(/^-[NS]/,"")||"").startsWith("S")&&this.Mn(n,e,t)})}):console.error(`PlacesHighlighter: Type d‚Äô√©v√©nement invalide "${e}"`)},Pn:function(t,e){t.forEach(t=>{const n=g[t];if(!n)return;const i=n.c,s=`${C.l(e)}-${i}`,o=document.getElementsByClassName(s);Array.from(o).forEach(n=>{const i=n.parentNode;i&&i.id&&i.id.startsWith("S")&&(n.dataset.originalFill||(n.dataset.originalFill=n.style.fill||""),n.classList.add(`event-highlight-${e}`),this.state.Ye.set(n,t))})})},bn:function(t){const e=t.pe.querySelector(".place-name");if(!e||this.state.tn.has(t.pe))return;this.state.tn.set(t.pe,e.innerHTML);const n=t.Ot?`¬†¬†¬†${t.zt} ‚Äì ${t.Ot}`:placeName;e.textContent=n},pn:function(t,e){if(t.querySelectorAll(".indicator, .line-break").forEach(t=>t.remove()),!t||!e.length)return;Array.isArray(e);const n=[];e.forEach((i,s)=>{const o=document.createElement("div");if(o.className=`indicator ${C.o(i)}`,o.textContent=C.label(i),t.appendChild(o),n.push(o),1===s&&e.length>=4){const e=document.createElement("div");e.className="line-break",t.appendChild(e),n.push(e)}}),e.length>=4&&t.closest(".place-row")?.classList.add("tall-row"),this.state.Xe.set(t,n)},mn:function(){document.querySelectorAll(".place-content").forEach(t=>{t.classList.contains("person-match")||t.classList.contains("locked")||t.classList.add("grayed-out")})},Te:function(t=!1){const e=t?this.state.U:null;if(this.state.Qe.forEach(t=>{t!==e&&this.un(t)}),document.querySelectorAll(".grayed-out").forEach(t=>{t.classList.remove("grayed-out")}),this.state.Qe.clear(),this.state.Ye.clear(),this.state.Xe.clear(),this.state.tn.clear(),t||(this.state.en=null),e&&this.state.Qe.add(e),void 0!==V&&V.An&&V.An(),!t){const t=document.querySelector(".place-content.locked");t&&t.classList.remove("locked"),this.state.U=null,this.state._e=[]}},kn:function(){C.types.forEach(t=>{document.querySelectorAll(`svg .event-highlight-${t}`).forEach(e=>{e.classList.remove(`event-highlight-${t}`)})}),document.querySelectorAll(".grayed-out").forEach(t=>{t.classList.remove("grayed-out")})},Ze:function(){if(!this.state.U){const t=new URLSearchParams(window.location.search).get("lock");if(t&&g[t]){this.state.U=t;const e=g[t];e&&(this.state._e=C.types.filter(t=>e[C.l(t)]))}}if(!this.state.U)return;const t=g[this.state.U];if(!t||!t.pe)return this.state.U=null,void(this.state._e=[]);t.pe.classList.add("locked"),this.De()},initialize:function(){this.cn(),z.Re()}},B={Ln:function(){const t=A("g");t.setAttribute("id","couple-center"),(s("fanchart-content")||o).appendChild(t);const e=ancestor.S2,n=ancestor.S3,i=P.S[0];if(e){const n=A("g");n.setAttribute("id","S2-N"),t.appendChild(n),H.Rn(n,0,i,-180,0,e,{type:"person",_n:!0}),this.Nn(n,e,l,u-i/2,!1),e.sosa=2,H.Rn(n,0,i,-180,0,e,{type:"person"}),this.Tn(n,e,i,"north")}if(n){const e=A("g");e.setAttribute("id","S3-S"),t.appendChild(e),H.Rn(e,0,i,0,180,n,{type:"person",_n:!0}),this.Nn(e,n,l,u+i/2,!0),n.sosa=3,H.Rn(e,0,i,0,180,n,{type:"person"}),this.Tn(e,n,i,"south")}const a=A("line");a.setAttribute("x1",l-i+10),a.setAttribute("y1",u),a.setAttribute("x2",l+i),a.setAttribute("y2",u),a.setAttribute("stroke","#ccc"),a.setAttribute("class","middle"),t.appendChild(a),e&&e.marriage_date&&this.Dn(t,e,i)},Tn:function(t,e,n,i){if(!e||!e.fn||"?"===e.fn)return;const s=Math.max(35,Math.min(65,Math.round(n/2*2))),o=A("text");o.setAttribute("x",l),o.setAttribute("text-anchor","middle"),o.setAttribute("dominant-baseline","middle");const a=.87*n,c="north"===i?u-a:u+a;o.setAttribute("y",c);const r=e.has_parents?"north"===i?"&#x25B2;":"&#x25BC;":"&#x2716;";o.setAttribute("class",e.has_parents?"link icon":"no-link"),o.innerHTML=`<tspan style="font-size:${s}%;">${r}</tspan>`,e.has_parents&&(o.onclick=t=>{const n=t.ctrlKey||t.metaKey;T.rt(e,n,!0)});const h=A("title");return h.textContent=e.has_parents?`Recentrer l‚Äôarbre sur ${e.fn} ${e.sn}`:`${e.fn} ${e.sn} : aucun parent connu`,o.appendChild(h),t.appendChild(o),o},Dn:function(t,e,n){const i={In:n-10,zn:n,On:165,En:195},s=A("g");if(s.setAttribute("id","M1-NS"),e.marriage_place&&s.setAttribute("data-place-name",e.marriage_place),t.appendChild(s),H.Rn(s,i.In,i.zn,i.On,i.En,e,{type:"marriage",_n:!0}),H.Bn(s,i.In,i.zn,i.On,i.En),H.Rn(s,i.In,i.zn,i.On,i.En,e,{type:"marriage"}),e.marriage_date){let t="";e.marriage_place&&g[e.marriage_place]&&(t=" ma-t"+g[e.marriage_place].c);const n=(i.In+i.zn)/2,o=A("g");o.setAttribute("transform",`rotate(90 ${l} ${u})`),s.appendChild(o),o.style.pointerEvents="none",F.Hn(o,"1-NS",n,75,105,e.marriage_date,t)}},Nn:function(t,e,n,i,s){const o=P.S[0],a=1.7*o,c=r/10,l=[e.fn,e.sn,e.dates||""].map(t=>{if(!t)return 100;const e=F.Fn(t),n=a*c,i=e.width>n?n/e.width:1;return Math.round(88*i)}),u=Math.min(o/3,16),h=A("text");h.setAttribute("x",n),h.setAttribute("y",i),h.setAttribute("text-anchor","middle"),h.setAttribute("dominant-baseline","middle"),s&&h.setAttribute("transform",`rotate(180, ${n}, ${i})`),h.innerHTML=`<tspan x="${n}" dy="-${.4*u}px" style="font-size:${l[0]}%">${e.fn}</tspan><tspan x="${n}" dy="${.9*u}px" class="bold-sn" style="font-size:${l[1]}%">${e.sn}</tspan><tspan x="${n}" dy="${.7*u}px" class="dates" style="font-size:${Math.round(.7*l[2])}%">${e.dates||""}</tspan>`,t.appendChild(h)},Gn:function(t,e){const n={},i=t["S"+e];i&&(n.S1={...i,jn:e});const s=(e,i)=>{const o=t["S"+e];o&&(n["S"+i]={...o,jn:e},s(2*e,2*i),s(2*e+1,2*i+1))};return s(2*e,2),s(2*e+1,3),n}},H={Bn:function(t,e,i,s,o){var a=A("path");const c=n(i,s),r=n(i,o),l=n(e,o),u=n(e,s);a.setAttribute("d",`M ${c.x},${c.y} A ${i} ${i} 0 ${o-s>180?1:0} 1 ${r.x},${r.y} L ${l.x},${l.y} A ${e} ${e} 0 ${o-s>180?1:0} 0 ${u.x},${u.y} Z`),a.setAttribute("class","contour"),t.append(a)},qn:function(t,e,i,s){var o=A("path");const a=n(i,s),c=n(e,s);o.setAttribute("d",`M ${a.x},${a.y} L ${c.x},${c.y}`),o.setAttribute("class","middle"),t.append(o)},Un:function(t,e,n,i,s,o={}){const a=A("circle");if(a.setAttribute("cx",n),a.setAttribute("cy",i),a.setAttribute("r",e),o._n){let t=["bg"];if(s.birth_place&&g[s.birth_place]&&t.push("bi-"+g[s.birth_place].c),s.baptism_place&&g[s.baptism_place]&&t.push("ba-"+g[s.baptism_place].c),s.death_place&&g[s.death_place]&&t.push("de-"+g[s.death_place].c),s.burial_place&&g[s.burial_place]&&t.push("bu-"+g[s.burial_place].c),s.age){const e=D.ft(Number(s.age));e&&t.push(e)}a.setAttribute("class",t.join(" "))}else{a.setAttribute("class","link");const t=A("title");t.textContent=`(Sosa 1) ${s.fn} ${s.sn} (${s.Vn})\nCtrl+clic pour la fiche individuelle`,a.appendChild(t),this.Wn(a,s,"person")}return t.append(a),a},Rn:function(t,e,i,s,o,a,c={}){const r=A("path"),l=n(i,s),u=n(i,o),h=n(e,o),d=n(e,s);return r.setAttribute("d",`M ${l.x},${l.y} A ${i} ${i} 0 ${o-s>180?1:0} 1 ${u.x},${u.y} L ${h.x},${h.y} A ${e} ${e} 0 ${o-s>180?1:0} 0 ${d.x},${d.y} Z`),c._n?this.Zn(r,a,c.type):"marriage"!==c.type||a.marriage_place?this.Wn(r,a,c.type):r.setAttribute("class",""),t.append(r),r},Zn:function(t,e,n){let i=["bg"];if("person"===n){if(C.types.forEach(t=>{if("marriage"===t)return;const n=C.place?C.place(t):`${t}_place`,s=C.l(t);e[n]&&g[e[n]]&&i.push(s+"-"+g[e[n]].c)}),e.age){const t=D.ft(Number(e.age));t&&i.push(t)}}else if("marriage"===n){if(e.marriage_place&&g[e.marriage_place]){const t=C.l("marriage");i.push(t+"-"+g[e.marriage_place].c)}if(e.marriage_length){const t=D.gt(e.marriage_length);t&&i.push(t)}}t.setAttribute("class",i.join(" "))},Wn:function(t,e,n){e&&("?"!==e.fn||e.sosasame)&&(e.fn||e.sosasame||"marriage"===n)&&(t.setAttribute("class","link"),t.addEventListener("click",t=>{t.stopPropagation(),this.Jn(t,e)}),t.addEventListener("mouseenter",t=>{t.stopPropagation(),this.Kn(e,n,t)}),t.addEventListener("mouseleave",t=>{t.stopPropagation(),this.Qn(e,n,t)}))},Yn:function(t,e,n){if(t.className="person-panel","person"===n){const n=void 0!==e.sosasame;let i=e,s=e.sosa||parseInt(e.id?.replace("S",""))||1,o="<h2>";if(o+=`${i.fn} ${i.sn}`,n)if("reduced"===implexMode)o+=`<small> (Sosa ${s} ‚Üí ${e.sosasame})</small>`;else if("numbered"===implexMode)if(void 0!==W&&W.Xn){const t=W.Xn(s);t&&t.chain?o+=`<small> (${t.chain.join(" ‚Ä∫ ")})</small>`:o+=`<small> (Sosa ${s} ‚Ä∫ ${e.sosasame})</small>`}else o+=`<small> (Sosa ${s} ‚Ä∫ ${e.sosasame})</small>`;else o+=`<small> (Sosa ${s})</small>`;else o+=`<small> (Sosa ${s})</small>`;o+="</h2>",(i.ti||i.birth_place)&&(o+="<div><strong>Naissance :</strong> ",i.ti&&(o+=`${i.ti}`),i.birth_place&&(o+=` ‚Äì ${i.birth_place}`),o+="</div>"),(i.baptism_date||i.baptism_place)&&(o+="<div><strong>Bapt√™me :</strong> ",i.baptism_date&&(o+=`${i.baptism_date}`),i.baptism_place&&(o+=` ‚Äì ${i.baptism_place}`),o+="</div>"),(i.death_date||i.death_place)&&(o+="<div><strong>D√©c√®s :</strong> ",i.death_date&&(o+=`${i.death_date}`),i.death_place&&(o+=` ‚Äì ${i.death_place}`),o+="</div>"),(i.burial_date||i.burial_place)&&(o+="<div><strong>S√©pulture :</strong> ",i.burial_date&&(o+=`${i.burial_date}`),i.burial_place&&(o+=` ‚Äì ${i.burial_place}`),o+="</div>"),i.Vn&&(o+=`<div><strong>√Çge :</strong> ${i.Vn}</div>`),n&&(o+='<div class="implex-notice">',o+=`<strong>üí° Implexe :</strong> appara√Æt ${W.ei(e.sosasame||s).length+1} fois.`,o+="</div>"),t.innerHTML=o}else if("marriage"===n){const n=parseInt(e.marriage_length)||-1;let i="<h2>Mariage</h2>";const s=e.marriage_date_||e.marriage_date;s&&(i+=`<div><strong>Date :</strong> ${s}</div>`),e.marriage_place&&(i+=`<div><strong>Lieu :</strong> ${e.marriage_place}</div>`),n>=0&&(i+=`<div><strong>Dur√©e :</strong> ${n} ${1===n?"an":"ans"}</div>`),e.marriage_age&&(i+=`<div><strong>√Çge au mariage :</strong> ${e.marriage_age} ans</div>`),t.innerHTML=i}},Jn:function(t,e){if(t.target.closest("#b-sort-places"))return t.preventDefault(),void G.He();if(!t.ctrlKey&&!t.metaKey)return;if(!link_to_person)return void alert("Erreur: Impossible d'acc√©der √† la fiche individuelle");const n=t.target.closest("li[data-location]");if(e&&e.fnk&&e.snk)T.rt(e,!0,!1);else if(n&&"1"===document.body.dataset.wizard){t.preventDefault();const e=n.dataset.location;return void T.ut(e,!0)}},Kn:function(t,n,i){const o=s("person-panel");if(o&&"person"===n&&t.sosa){const e=t.jn||t.sosa,i=k?t:W.ni(t.sosa);if(i){const s={...i,sosa:e,sosasame:t.sosasame};this.Yn(o,s,n),o.style.display="block"}}else o&&(this.Yn(o,t,n),o.style.display="block");if(i?.target){i.target.classList.add("highlight");const e=i.target.parentNode;if(e){const s=e.querySelector(".bg");s&&(s.classList.add("highlight"),"marriage"===n&&t.marriage_place&&document.body.classList.contains("place")&&(i.target.classList.add("highlight"),s.classList.add("highlight")))}}if(document.body.classList.contains("age")&&q.ii(t,n,"enter"),document.body.classList.contains("place")&&z.cache.elements.te){const e=k?t:"person"===n&&t.sosa?W.ni(t.sosa):t;if(e){t.jn||t.sosa;const i={...e,sosa:t.sosa},s=this.si(i,n);if(s.length>0){const t=new Map;s.forEach(({place:e,event:n})=>{t.has(e)||t.set(e,[]),t.get(e).push(n)});const e=Array.from(t.keys()),n=Array.from(t.values());if(E.state.U){const t=g[E.state.U];t?.ge&&(t.ge.querySelectorAll(".indicator").forEach(t=>t.remove()),E.state.Xe.delete(t.ge)),E.state.an=!0}const i=!!E.state.U;E.highlight(e,n,"svg",i)}else if(E.state.U){const t=g[E.state.U];t?.ge&&(t.ge.querySelectorAll(".indicator").forEach(t=>t.remove()),E.state.Xe.delete(t.ge)),E.state.an=!0}}}if("person"===n&&t.sosa){const n=k&&t.jn||t.sosa;W.oi(n).forEach(t=>{t!==n&&(k?Array.from(document.getElementsByClassName("os-"+t)):e("S"+t)).forEach(t=>{t.classList.add("same_hl");const e=t.querySelector("path.link");e&&e.classList.add("highlight")})})}},Qn:function(t,n,i){const o=s("person-panel");if(o&&(o.style.display="none",o.innerHTML=""),i?.target){i.target.classList.remove("highlight"),i.target.classList.remove("event-highlight-marriage");const t=i.target.parentNode;t&&t.querySelectorAll(".bg").forEach(t=>{t.classList.remove("highlight"),t.classList.remove("event-highlight-marriage")})}if(document.body.classList.contains("place")&&(E.state.U?(E.dn(),E.ln(),E.De()):E.Te()),document.body.classList.contains("age")&&q.Te(),"person"===n&&t.sosa){const n=k&&t.jn||t.sosa;W.oi(n).forEach(t=>{(k?Array.from(document.getElementsByClassName("os-"+t)):e("S"+t)).forEach(t=>{t.classList.remove("same_hl"),t.querySelectorAll(".highlight").forEach(t=>{t.classList.remove("highlight")})})})}},si:function(t,e){const n=[],i=(t,e)=>{t&&n.push({place:t,event:e})};if("marriage"===e)i(t.marriage_place,"marriage");else if("person"===e&&(C.types.forEach(e=>{if("marriage"===e)return;const n=C.place(e);i(t[n],e)}),!k))if(t.sosa&&t.sosa%2==1){const e=ancestor["S"+(t.sosa-1)];i(e?.marriage_place,"marriage")}else i(t.marriage_place,"marriage");return n},ai:function(t,e,n,i,s,o,a,c,r,l=!1){let u;return"C3"===P.C[r-1]?u="C3":"C2"===P.C[r-1]?u="C2":"C1"===P.C[r-1]?u="C1":"R4"!==P.C[r-1]||l?"R3"!==P.C[r-1]||l?"R2"!==P.C[r-1]||l?("R1"===P.C[r-1]||l)&&(u="R1"):u="R2":u="R3":u="R4",K.ci(t,u,{r1:e+10,r2:n,ri:i,li:s,sosa:o,ui:a,hi:c})},di:function(t,e,n,i,s){let o=55;2*r>i&&(o=Math.round(100*i/2/r));const a=A("text");s?(a.setAttribute("class","link icon"),a.innerHTML=`<textPath xlink:href="#${e}" startOffset="50%" style="font-size:${o}%;">&#x25B2;</textPath>`,a.onclick=t=>{const e=t.ctrlKey||t.metaKey;T.rt(n,e,!0)}):(a.setAttribute("class","no-link"),a.innerHTML=`<textPath xlink:href="#${e}" startOffset="50%" style="font-size:${o}%;">&#x2716;</textPath>`);const c=A("title");return c.textContent=s?`Recentrer l‚Äôarbre sur ${n.fn} ${n.sn}`:`${n.fn} ${n.sn} : aucun parent connu`,a.appendChild(c),t.append(a),a},fi:function(t,e,n,i,s,o){if(!o||"?"===o.fn||""===o.fn||!o.fn)return;const a=(n+i)/2,c=`tpiS${s}`,r=Math.min(20,Math.abs(i-n)*Math.PI*e/180)/(2*Math.PI*e)*180,l=F.pi(t,c,e,a-r,a+r);return this.di(t,c,o,l,o.has_parents)}},F={mi:{},Fn:function(t){return this.mi[t]||(c.textContent=t,this.mi[t]=c.getBBox(),c.textContent=""),this.mi[t]},ci:function(t,e,n){const i=this.gi(n.ui,n.hi||""),s=P.P[e]||1;switch(e){case"S1":return this.$i(t,n.x,n.y,n.ui,i);case"C3":case"C2":case"C1":return this.bi(t,n.r1,n.r2,n.ri,n.li,n.sosa,n.ui,i,s);case"R4":return this.wi(t,n.r1,n.r2,n.ri,n.li,n.sosa,n.ui,i,4,s);case"R3":return this.wi(t,n.r1,n.r2,n.ri,n.li,n.sosa,n.ui,i,3,s);case"R2":return this.wi(t,n.r1,n.r2,n.ri,n.li,n.sosa,n.ui,i,2,s);case"R1":return this.wi(t,n.r1,n.r2,n.ri,n.li,n.sosa,n.ui,i,1,s);default:return console.warn(`Mode de texte non reconnu: ${e}`),null}},gi:function(t,e){let n=e;return C.types.forEach(e=>{const i=C.place(e),s=C.l(e);t[i]&&g[t[i]]&&(n+=` ${s}-t${g[t[i]].c}`)}),n.trim()},$i:function(t,e,n,i,s){const o=A("text");o.setAttribute("x",e),o.setAttribute("y",n),o.setAttribute("class",s);const a=this.xi([i.fn,i.sn]);return o.innerHTML=`<tspan style="font-size:${a[0]}%">${i.fn}</tspan><tspan x="${e}" dy="15" class="bold-sn" style="font-size:${a[1]}%">${i.sn}</tspan><tspan class="dates" x="${e}" dy="15">${i.dates}</tspan>`,t.append(o),o},bi:function(e,n,i,s,o,a,c,r,l=1){const u=Math.abs(i-n)/3,h=t(`tp1S${a}`),d=this.pi(e,h,3*(i-n)/4+n,s,o);this.Mi(e,h,c.fn,r,d,u,l);const f=t(`tp2S${a}`),p=this.pi(e,f,2*(i-n)/4+n,s,o);this.Mi(e,f,c.sn,r,p,u,l);const m=t(`tp3S${a}`),g=this.pi(e,m,(i-n)/4+n,s,o);return this.Mi(e,m,c.dates,r+" dates",g,u,l),e},wi:function(e,n,i,s,o,a,c,r,l,u=1){const h=this.Si(n,i,s,o,l),d=Math.abs(o-s)/360*2*Math.PI*n/l;if(l>=3){const n=t(`tp1S${a}`),i=this.yi(e,n,h.r1,h.r2,h.Ci[0]);this.Mi(e,n,c.fn,r,i,d,u);const s=t(`tp2S${a}`),o=this.yi(e,s,h.r1,h.r2,h.Ci[1]);this.Mi(e,s,c.sn,r,o,d,u);const l=t(`tp3S${a}`),f=this.yi(e,l,h.r1,h.r2,h.Ci[2]);this.Mi(e,l,c.dates,r+" dates",f,d,u)}else if(2===l){const n=t(`tp1S${a}`),i=this.yi(e,n,h.r1,h.r2,h.Ci[0]);this.Mi(e,n,`${c.fn} ${c.sn}`,r,i,d);const s=t(`tp2S${a}`),o=this.yi(e,s,h.r1,h.r2,h.Ci[1]);this.Mi(e,s,c.dates,r+" dates",o,d)}else{const n=t(`tp1S${a}`),i=this.yi(e,n,h.r1,h.r2,h.Ci[0]);this.Mi(e,n,`${c.fn} ${c.sn}`,r,i,d)}return e},Si:function(t,e,n,i,s){let o,a,c=[];return n>=-90?(o=t,a=e,c=4===s?[i-4*(i-n)/6,i-3*(i-n)/6,i-2*(i-n)/6]:3===s?[i-3*(i-n)/4,i-2*(i-n)/4,i-(i-n)/4]:2===s?[i-2*(i-n)/3,i-(i-n)/3]:[i-(i-n)/2]):(o=e,a=t,c=4===s?[n+4*(i-n)/6,n+3*(i-n)/6,n+2*(i-n)/6]:3===s?[n+3*(i-n)/4,n+2*(i-n)/4,n+(i-n)/4]:2===s?[n+2*(i-n)/3,n+(i-n)/3]:[n+(i-n)/2]),{r1:o,r2:a,Ci:c}},pi:function(t,e,i,s,o){const a=A("path");a.setAttribute("class","none");const c=n(i,s),r=n(i,o);return a.setAttribute("d",`M ${c.x},${c.y} A ${i} ${i} 0 ${o-s>180?1:0} 1 ${r.x},${r.y}`),a.setAttribute("id",e),t.append(a),Math.abs(o-s)/360*2*Math.PI*i},yi:function(t,e,i,s,o){const a=A("path");a.setAttribute("class","none");const c=n(i,o),r=n(s,o);return a.setAttribute("d",`M ${c.x},${c.y} L ${r.x},${r.y}`),a.setAttribute("id",e),t.append(a),Math.abs(s-i)},Mi:function(t,e,n,i,s,o,a=1){const c=this.Fn(n),r=c.width,l=c.height;let u=100;r>s*P.security&&(u=Math.round(100*s*P.security/r));let h=100;l>o*P.security&&(h=Math.round(100*o*P.security/l));let d=Math.min(u,h)*a;const f=A("text");return f.setAttribute("class","text "+i),f.style.pointerEvents="none",f.innerHTML=`<textPath xlink:href="#${e}" startOffset="50%" style="font-size:${d}%;">`+n+"</textPath>",t.append(f),f},xi:function(t){const e=P.R||.9,n=2*P.S[0]*P.security;return t.map(t=>{const i=this.Fn(t).width;return i>n?Math.round(100*n/i*e):Math.round(100*e)})},Hn:function(t,e,n,i,s,o,a){const c="pmS"+e,r=K.pi(t,c,n,i,s);return this.Mi(t,c,o,a,r,10)}},G={Pi:function(){var t=document.createElement("div");t.id="navigation-help",t.style.display="none",t.innerHTML='\n      <div class="help-title">üí° Aide Navigation</div>\n      <div><strong>Souris :</strong></div>\n      <div>‚Äì Glisser : d√©placer l‚Äôarbre</div>\n      <div>‚Äì Molette : zoomer</div>\n      <div>‚Äì Survol : voir les d√©tails</div>\n      <div><strong>Raccourcis :</strong></div>\n      <div>‚Äì <kbd>Ctrl</kbd>+clic : fiche individuelle</div>\n      <div>‚Äì ‚ñ≤ : navigation sur anc√™tre</div>\n      <div style="margin-top: 8px; text-align: center;">\n      </div>\n    ',document.body.appendChild(t)}},j={Ai:["bi","ba","ma","de","bu"],ki:function(t,e,n){const i=document.documentElement,s=[...document.styleSheets].find(t=>"fc-auto"===t.title);i.style.setProperty("--fc-color-"+t,"hsl("+e+",100%,"+n+"%)"),["bi","ba","ma","de","bu"].forEach(e=>{s.insertRule(`body.place svg .${e}-L${t} { fill: var(--fc-color-${t}); }`,s.cssRules.length)}),s.insertRule(`body.place svg .L${t} { fill: var(--fc-color-${t}); }`,s.cssRules.length)},Li:function(t){if(document.body.classList.remove("place","age"),this.Ai.forEach(t=>{const e=s(t);e&&(e.checked=!1)}),"place"===t){document.body.className="place",tool="place";const t=s("ma");t&&(t.checked=!0),this.Ri()}else"age"===t?(document.body.className="age",tool="age"):(document.body.className="",tool="");this._i(),this.Ni(),T.ot()},_i:function(){const t=document.body.classList.contains("place"),e=document.querySelector(".event-toggles");e&&(e.style.display=t?"flex":"none");const n=s("b-sort-places");n&&(n.style.display=t?"inline-flex":"none")},Ni:function(){const t=s("b-age"),e=s("b-places-colorise"),n=s("b-sort-places");t&&t.classList.toggle("active","age"===tool),e&&e.classList.toggle("active","place"===tool),n&&n.classList.toggle("active","alphabetical"===$)},Ri:function(){const t=s("fanchart");C.types.forEach(e=>{const n=C.l(e),i=s(n),o=!!i&&i.checked;t.classList.toggle(n,o)}),T.ot()},Ti:function(){C.types.forEach(t=>{const e=C.l(t),n=s(e);n&&(n.onclick=this.Ri.bind(this))}),s("b-angle-360").onclick=()=>U.Di(360),s("b-places-colorise").onclick=function(){if(document.body.classList.contains("place"))E.Te(),E.kn(),document.body.className="",tool="",this.classList.remove("active"),J.Ve(),J.We();else{document.body.className="place",tool="place",this.classList.add("active");const t=s("b-age");t&&t.classList.remove("active"),E.De(),J.Ve(),J.We()}j.Ri(),j._i(),T.ot()},s("b-age").onclick=function(){if(document.body.classList.contains("age"))document.body.className="",tool="",this.classList.remove("active");else{E.kn(),document.body.className="age",tool="age",this.classList.add("active");const t=s("b-places-colorise");t&&t.classList.remove("active")}T.ot()}}},q={Ii:null,zi:new Set,ii:function(t,e,n){if("enter"!==n)return;let i="";"person"===e&&t.age?i=D.ft(t.age):"marriage"===e&&t.marriage_length&&(i=D.gt(t.marriage_length)),i&&!this.zi.has(i)&&this.Oi(i)},initialize:function(){const t=document.querySelector(".legend-close");t&&(t.onclick=()=>{s("age-legend").style.display="none",document.body.classList.remove("age"),"undefined"!=typeof tool&&(tool=""),this.Te()});const e=s("age-legend");e&&(e.addEventListener("mouseenter",this.Ei.bind(this),!0),e.addEventListener("mouseleave",this.Bi.bind(this),!0))},Hi:function(){this.zi.clear();const t=[{prefix:"DA",title:"Aucune personne dans cette tranche d‚Äô√¢ge"},{prefix:"DAM",title:"Aucun mariage dans cette tranche de dur√©e"}];t.forEach(t=>{for(let e=0;e<=4;e++){const n=t.prefix+e,i=s(n);i&&(i.style.opacity="",i.style.pointerEvents="",i.title="")}});const e=s("fanchart");e&&t.forEach(t=>{for(let n=0;n<=4;n++){const i=t.prefix+n;if(0===e.getElementsByClassName(i).length){this.zi.add(i);const e=s(i);e&&(e.style.opacity="0.3",e.style.pointerEvents="none",e.title=t.title)}}})},Ei:function(t){const e=t.target.closest(".legend-item");e&&e.id&&!this.zi.has(e.id)&&this.Oi(e.id)},Bi:function(t){t.relatedTarget&&s("age-legend").contains(t.relatedTarget)||this.Te()},Oi:function(t){this.zi.has(t)||(this.Te(),this.Ii=t,requestAnimationFrame(()=>{const e=s(t);e&&e.classList.add("hl");const n=document.getElementsByClassName(t);for(let t=0;t<n.length;t++)n[t].classList.add("highlight")}))},Te:function(){document.querySelectorAll(".legend-item.hl").forEach(t=>{t.classList.remove("hl")}),document.querySelectorAll("svg .highlight").forEach(t=>{t.classList.remove("highlight")}),this.Ii=null}},U={Fi:function(){return R},Di:function(t){const e=k;360===t?(k=!0,R=180,_=0):(k=!1,R=t,e&&(_=0)),this.Gi(),T.ot(),J.ji=window.innerWidth,J.qi=window.innerHeight,J.Ve(),J.Ui(),J.We()},Gi:function(){[180,220,359,360].forEach(t=>{const e=s(`b-angle-${t}`);if(e){const n=360===t?k:!k&&R===t;e.classList.toggle("active",n)}})},initialize:function(){this.Gi();const t=s("b-circular-mode");t&&k&&t.classList.add("active")}},V={config:{Vi:30,Wi:28,Zi:{compact:6,Ji:3},Ki:5,Qi:.5},Yi:null,Xi:[],ts:!1,initialize:function(){const t=document.querySelector(".places-list");return!!t&&(this.Yi=t.clientHeight,!0)},xn:function(t){if(this.ts)return;if(this.ts=!0,!this.initialize()||!t?.length)return void(this.ts=!1);const e=this.es(t);this.An(),this.ns(e),this.ts=!1},es:function(t){const e=new Set;return t.filter(t=>{const n=t.wn||t.element?.dataset?.place;return!(!n||e.has(n)||(e.add(n),0))})},ns:function(t){const e=document.querySelector(".places-list");if(!e)return;const n=this.ss(t,e.clientHeight);(n.cs?.length||n.rs?.length)&&this.ls(n)},us:function(t){if(!t||!t.cs?.length&&!t.rs?.length)return 0;let e=0;if(t.cs?.length>0){const n=Math.min(t.cs.length,5);e+=this.config.Wi+n*this.config.Vi}if(t.rs?.length>0){const n=Math.min(t.rs.length,5);e+=this.config.Wi+n*this.config.Vi}const n=Math.floor(this.Yi*this.config.Qi);return Math.min(e,n)},ss:function(t,e){const n=document.querySelector(".places-list");if(!n||!t.length||e<=0)return{cs:[],rs:[]};const i=n.scrollTop,s=i+e,o=[],a=[];return t.forEach(t=>{const e=t.element||t.place;if(!e)return;const n=e.closest(".place-row");if(!n)return;const c=n.offsetTop,r=c+n.offsetHeight;c>=i&&r<=s||((c+r)/2<(i+s)/2?o.push({element:e,index:t.index,hs:n,wn:t.wn}):a.push({element:e,index:t.index,hs:n,wn:t.wn}))}),{cs:o,rs:a}},ds:function(t,e){if(!e)return!1;const n=t.cs?.length||0,i=t.rs?.length||0,s=e.cs?.length||0,o=e.rs?.length||0;return n===s&&i===o},fs:function(t,e){if(!e)return!1;const n=t.cs.map(t=>t.index).join(","),i=t.rs.map(t=>t.index).join(","),s=e.cs.map(t=>t.index).join(",");return n===e.rs.map(t=>t.index).join(",")||i===s},ls:function(t,e){if(this.An(),!t.cs?.length&&!t.rs?.length)return;const n=document.querySelector(".places-container");if(n){if(t.cs?.length>0){const e=this.ps("above",t.cs);e.style.top="0px",n.appendChild(e),this.Xi.push(e)}if(t.rs?.length>0){const e=this.ps("below",t.rs);n.appendChild(e),this.Xi.push(e)}}},ps:function(t,e){const n=document.createElement("div");n.className=`overflow-section ${t} stabilized`;const i=document.createElement("div");i.className="overflow-header",i.innerHTML=`\n      <i class="fas fa-arrow-${"above"===t?"up":"down"} fa-sm"></i>\n      ${e.length} lieu${e.length>1?"x":""} hors √©cran\n    `;const s=document.createElement("div");return s.className="overflow-content",this.gs(e),e.slice(0,5).forEach(t=>{const e=t.hs;if(e){const t=e.cloneNode(!0),n=t.querySelector(".place-indicators"),i=t.querySelector(".place-content");n&&n.removeAttribute("id"),i&&(i.removeAttribute("id"),i.classList.remove("grayed-out")),s.appendChild(t)}}),n.appendChild(i),n.appendChild(s),n},gs:function(t){return t.sort((t,e)=>{const n=t.wn,i=e.wn,s=g[n],o=g[i];return o?.It&&o.Ot===n?-1:s?.It&&s.Ot===i?1:n.localeCompare(i,"fr",{we:"base"})})},An:function(){this.Xi.forEach(t=>{t.parentNode&&t.parentNode.removeChild(t)}),this.Xi=[],document.querySelectorAll(".overflow-section").forEach(t=>t.remove()),this.ts=!1}},W={vs:new Map,$s:new Map,initialize:function(){this.vs.clear(),this.$s.clear(),Object.keys(ancestor).forEach(t=>{const e=parseInt(t.replace("S","")),n=ancestor[t];if(n&&n.sosasame){const t=this.Xn(e);this.$s.has(t.source)||this.$s.set(t.source,[]),this.$s.get(t.source).push(e)}})},Xn:function(t){if(t=parseInt(t),this.vs.has(t))return this.vs.get(t);const e=[];let n=t,i=new Set;for(;n;){if(i.has(n)){console.warn(`ImplexResolver: Boucle d√©tect√©e pour Sosa ${t}`);break}i.add(n),e.push(n);const s=ancestor["S"+n];if(!s||!s.sosasame)break;n=parseInt(s.sosasame)}const s=e[e.length-1],o={source:s,chain:e,data:ancestor["S"+s]||null};return this.vs.set(t,o),o},ei:function(t){return t=parseInt(t),this.$s.get(t)||[]},oi:function(t){t=parseInt(t);const e=ancestor["S"+t];return e?e.sosasame?this.Xn(t).chain||[t]:[t,...this.ei(t)]:[t]},ni:function(t){t=parseInt(t);const e=ancestor["S"+t];return e?e.sosasame&&"numbered"===implexMode?this.Xn(t).data:e:null}},Z=(new Map,function(t){return t%2==0?t:t-1}),J={ji:0,qi:0,v:P.v,zoom:function(t,e,n,i){var s=M,o=S;i>0?(o=Math.round(o/n),s=Math.round(s/n)):(o=Math.round(o*n),s=Math.round(s*n)),this.bs(w+Math.round(t*(M-s)/this.ji),x+Math.round(e*(S-o)/this.qi),s,o)},bs:function(t,e,n,i){w=t,x=e,M=n,S=i,o.setAttribute("viewBox",t+" "+e+" "+n+" "+i)},We:function(){this.bs(0,0,h,d)},init:function(){const t=T.B();if(tool=t.H,$=t.F,b=t.G,k=t.j,R=t.angle,implexMode=t.q,this.ws(),this.Ve(),this.xs(),W.initialize(),I.xt(),document.querySelector(".places-panel")&&(z.initialize(),O.initialize()),U.Gi(),k){const t=s("b-circular-mode");t&&t.classList.add("active")}N.preload(),this.Ms(),this.Ss(),j.Ti(),s("age-legend")&&q.initialize(),this.ys(),this.Cs(),this.Ps(),E.Ze(),G.Pi(),this.We()},ws:function(){"age"===tool?document.body.className="age":"place"===tool?document.body.className="place":document.body.className=""},xs:function(){Object.keys(ancestor).forEach(t=>{const e=ancestor[t];this.As(e,t),this.ks(e,t)}),this.Ls()},As:function(t,e){C.types.forEach(n=>{const i=C.place(n),s=C.u(n);void 0!==t[i]&&(ancestor[e][i]=this.Rs(t[i]),window[s]=!0)})},Rs:function(t){return t.replace(/^\?, /,"")},ks:function(t,e){if(void 0!==t.dates){let n=t.dates;n=this._s(n),n=this.Ns(n),ancestor[e].dates=n}},_s:function(t){return t.replace(/\s?<\/?bdo[^>]*>/g,"")},Ns:function(t){return t.replace(/\bca\s+/g,"~")},Ls:function(){C.types.forEach(t=>{const e=C.u(t);window[e]=!1}),Object.values(ancestor).forEach(t=>{C.types.forEach(e=>{const n=C.place(e),i=C.u(e);t[n]&&(window[i]=!0)})})},Ts:function(){for(let t in ancestor)if(ancestor[t].sosasame)return!0;return!1},Ds:function(){const t=Math.pow(2,p),e=Math.pow(2,p+1)-1;for(let n=t;n<=e;n++){const t=ancestor["S"+n];if(t&&t.has_parents)return!0}return!1},Ni:function(){const t=s("b-implex");t&&(this.Ts()?t.style.display="inline-flex":t.style.display="none");const e=s("b-gen-add");if(e){let t=!1,n=!1;p<f?t=!0:p<10&&(n=J.Ds(),t=n),e.classList.toggle("disabled",!t),e.disabled=!t,e.title=p<f?"Afficher la g√©n√©ration suivante (donn√©es en m√©moire)":n?"Charger la g√©n√©ration suivante":"Aucun parent dans la g√©n√©ration suivante"}},Ve:function(){var t=Object.keys(ancestor);f=Math.trunc(Math.log(Number(t[t.length-1].replace(/^S/,"")))/Math.log(2)),void 0===p&&(p=f),p>f&&(p=f,T.ot());let e=0,n=p+1;k&&(n+=-1);for(let t=0;t<n;t++)e+=P.S[t]||P.S[P.S.length-1];(isNaN(e)||e<=0)&&(console.error("max_r invalide:",e),e=300);const s=P._;if(k){const t=2*(e+s);h=t,d=t,l=t/2,u=t/2}else if(u=e+s,h=2*(l=e+s),180===R)d=e+P.S[0]+2*s;else if(R<=270){u=e+s;const t=Math.PI/180*(R-180)/2,n=Math.max(P.S[0],Math.round(e*Math.sin(t)));d=2*s+e+n}else d=2*(e+s);(isNaN(h)||isNaN(d)||h<=0||d<=0)&&(console.error("Dimensions SVG calcul√©es invalides:",{Is:h,zs:d,Os:e,Es:l,Bs:u}),l=(h=800)/2,u=(d=600)/2);const a=function(){if(!document.body.classList.contains("place"))return document.body.classList.contains("age")?160:0;const t=document.querySelector(".places-panel");return t&&t.classList.contains("panel-collapsed")?64:340}();i.style.setProperty("--fc-tool-size",a+"px");const c=window.innerWidth-a,r=window.innerHeight;this.ji=c,this.qi=r,o.setAttribute("width",this.ji),o.setAttribute("height",this.qi),w=0,x=0,M=h,S=d},ys:function(){for(;o.firstChild;)o.removeChild(o.firstChild);const t=A("g");t.setAttribute("id","fanchart-content"),0!==_&&t.setAttribute("transform",`rotate(${_} ${l} ${u})`),o.appendChild(t);const e=this.Hs();if(c=e.element,r=e.width,k){const e=R,n=ancestor;R=180;const i=A("g");i.setAttribute("id","north-hemisphere"),t.appendChild(i);const s=A("g");s.setAttribute("id","south-hemisphere"),s.setAttribute("transform",`rotate(180 ${l} ${u})`),t.appendChild(s);try{ancestor=B.Gn(n,2),L={target:i,t:"-N"},this.Fs(),ancestor=B.Gn(n,3),L={target:s,t:"-S"},this.Fs()}finally{L={target:null,t:""},ancestor=n,R=e}B.Ln()}else this.Gs(),this.Fs();this.Ni()},Fs:function(){let t=P.S[0];const e=k?p:p+1;for(let n=2;n<=e;n++){const e=t,i=e+P.S[n-1];t=i;const s=R/Math.pow(2,n-1);let o=-90-R/2+s/2;const a=Math.pow(2,n-1),c=Math.pow(2,n)-1;for(let t=a;t<=c;t++,o+=s){const a=this.js(t);if(!a)continue;const c={r1:e,r2:i,ri:o-s/2,li:o+s/2,Ce:n,delta:s};this.qs(t,c,a)}}this.Ni()},Ss:function(){P.M.forEach(t=>{const e=s(`b-angle-${t}`);e&&(e.onclick=function(){U.Di(t)})})},js:function(t){let e=ancestor["S"+t];if(!e&&"reduced"!==implexMode){const e=Math.floor(t/2),n=ancestor["S"+e];if(n&&n.sosasame){const e=n.sosasame,i=t%2==0?2*e:2*e+1,s=ancestor["S"+i];if(s)return{...s,fn:"numbered"===implexMode?"":s.fn,sn:"numbered"===implexMode?`${t}‚ÄØ‚Ä∫‚ÄØ${i}`:s.sn,sosasame:"numbered"===implexMode?i:void 0,dates:"numbered"===implexMode?"":s.dates}}}return e},Hs:function(){const t=L.target||s("fanchart-content")||o,e=A("text");e.textContent="ABCDEFGHIJKLMNOPQRSTUVW abcdefghijklmnopqrstuvwxyz 0123456789 ‚Äô'‚Äì-?~/",e.setAttribute("id","standard"),e.setAttribute("x",l),e.setAttribute("y",u),t.append(e);const n=e.getBBox();return{element:e,width:n.width/e.textContent.length,height:n.height}},Gs:function(){const t=ancestor.S1,e=P.S[0],n=A("g");return n.setAttribute("id","S1"),o.append(n),H.Un(n,e,l,u,t,{_n:!0}),K.ci(n,"S1",{x:l,y:u-10,ui:t,hi:""}),H.Un(n,e,l,u,t),n},Us:function(t,e){if(!e.sosasame)return{Le:e,Vs:!1};const n=e.sosasame,i=ancestor["S"+n];return"reduced"===implexMode?{Le:e,Vs:!1}:"numbered"===implexMode?{Le:{...i,fn:"",sn:`${t} ‚Ä∫ ${n}`,dates:"",sosasame:n},Vs:!0,jn:n}:{Le:i,Vs:!1}},qs:function(e,n,i){const a=L.target||s("fanchart-content")||o,c=t("G"+Z(e));let r=a.querySelector("#"+CSS.escape(c));r||(r=A("g"),r.setAttribute("id",c),a.append(r),e%2==0&&this.Ws(r,e,n,i));const l=A("g");l.setAttribute("id",t("S"+e)),k&&i.jn&&l.classList.add("os-"+i.jn),r.append(l);const u=this.Us(e,i).Le;u.sosa=e;const h=function(t,e){return{On:e.ri,En:e.li,In:e.r1+10,zn:e.r2}}(0,n);if(H.Rn(l,h.In,h.zn,h.On,h.En,u,{type:"person",_n:!0}),"?"!==u.fn){const t=this.Zs(u),s=i.sosasame&&("reduced"===implexMode||"numbered"===implexMode);s&&l.classList.add("implex-compact"),H.ai(l,h.In-10,h.zn,h.On,h.En,e,u,t,n.Ce,s)}return H.Rn(l,h.In,h.zn,h.On,h.En,u,{type:"person"}),H.fi(l,h.In,h.On,h.En,e,u),l},Ws:function(e,n,i,s){const o=A("g");o.setAttribute("id",t("M"+n)),e.firstChild?e.insertBefore(o,e.firstChild):e.appendChild(o);const a=function(t){const e=t.li+t.delta;return{On:t.ri,En:e,In:t.r1,zn:t.r1+10}}(i);if(H.Rn(o,a.In,a.zn,a.On,a.En,s,{type:"marriage",_n:!0}),H.Bn(o,a.In,i.r2,a.On,a.En),H.qn(o,a.zn,i.r2,i.li),H.Rn(o,a.In,a.zn,a.On,a.En,s,{type:"marriage"}),void 0!==s.marriage_date&&""!==s.marriage_date){let t="";s.marriage_place&&g[s.marriage_place]&&(t+=" ma-t"+g[s.marriage_place].c);const e=(a.In+a.zn)/2;F.Hn(o,n,e,a.On,a.En,s.marriage_date,t)}return s.marriage_place&&o.setAttribute("data-place-name",s.marriage_place),o},Js:function(t){const e=Z(t);return s("G"+e)},Ks:function(t){const e=Z(t);return{group:s("G"+e),Qs:s("S"+e),Ys:s("S"+(e+1)),marriage:s("M"+e)}},Zs:function(t){let e="";return t.birth_place&&""!==t.birth_place&&g[t.birth_place]&&(e+=" bi-t"+g[t.birth_place].c),t.baptism_place&&""!==t.baptism_place&&g[t.baptism_place]&&(e+=" ba-t"+g[t.baptism_place].c),t.death_place&&""!==t.death_place&&g[t.death_place]&&(e+=" de-t"+g[t.death_place].c),t.burial_place&&""!==t.burial_place&&g[t.burial_place]&&(e+=" bu-t"+g[t.burial_place].c),e.trim()},Cs:function(){const t=s("generation-section-title");if(t){const e=window.t(p>1?"generations":"generation",p>1?"g√©n√©rations":"g√©n√©ration");t.textContent=`${p} ${e}`}},Ui:function(){p>I.wt.size&&I.lt(),N.N(),this.Ve(),I.xt(p),s("fanchart").innerHTML="",this.ys(),W.initialize(),document.body.classList.contains("age")&&q.Hi(),document.querySelector(".places-panel")&&(z.ae(),z.ce(),O.initialize(),z.re(),E.cn(),E.Ze()),this.We(),this.Ni(),this.Cs()},Ms:function(){o.addEventListener("wheel",t=>{this.zoom(t.clientX,t.clientY,P.v,t.deltaY<0?1:-1)},{passive:!1});let t=!1,e=!1,n=0;const i=t=>{const e=o.getBoundingClientRect(),n=e.left+e.width/2,i=e.top+e.height/2;return 180*Math.atan2(t.clientY-i,t.clientX-n)/Math.PI};o.addEventListener("mousedown",s=>{s.preventDefault(),(2===s.button||0===s.button&&s.shiftKey)&&k?(e=!0,n=i(s)):0===s.button&&(t=!0)}),o.addEventListener("mouseup",n=>{t=!1,e=!1}),o.addEventListener("mouseleave",()=>{t=!1,e=!1}),o.addEventListener("mousemove",s=>{if(t)s.preventDefault(),this.bs(w-Math.round(s.movementX*M/this.ji),x-Math.round(s.movementY*S/this.qi),M,S);else if(e){s.preventDefault();const t=i(s);_=(_+(t-n))%360,n=t,(()=>{const t=o.querySelector("#fanchart-content");t&&t.setAttribute("transform",`rotate(${_} ${l} ${u})`)})()}}),o.addEventListener("contextmenu",t=>{k&&t.preventDefault()}),s("b-no-buttons").onclick=function(){s("fanchart-controls").style.display="none"},s("b-help").onclick=function(){const t=s("navigation-help");if(t){const e="none"!==t.style.display;t.style.display=e?"none":"block",this.classList.toggle("active",!e)}},s("b-home").onclick=()=>{window.location=link_to_person},s("b-rng").onclick=function(){const t=this.getAttribute("data-url");t&&(window.location=t)},s("b-refresh").onclick=()=>{this.Ve(),this.We()},s("b-zoom-in").onclick=()=>{this.zoom(this.ji/2,this.qi/2,this.v,1)},s("b-zoom-out").onclick=()=>{this.zoom(this.ji/2,this.qi/2,this.v,-1)},s("b-gen-add").onclick=()=>{this.disabled||(p<f?(p++,J.Ui(),T.ot()):T.ct(p+1))},s("b-gen-del").onclick=()=>{p>1&&(p--,J.Ui(),T.ot())},s("b-implex").onclick=function(){switch(implexMode){case"reduced":implexMode="numbered",this.title="Afficher tous les anc√™tres",this.querySelector("i").className="fa fa-comment fa-fw";break;case"numbered":implexMode="full",this.title="R√©duire les implexes",this.querySelector("i").className="fa fa-comment-slash fa-fw";break;case"full":implexMode="reduced",this.title="Num√©roter les implexes",this.querySelector("i").className="fa fa-comment-dots fa-fw"}J.Ui(),T.ot()},s("font-selector").onchange=function(){const t=s("fanchart");["mono","serif","large","readable"].forEach(e=>{t.classList.remove(e)}),this.value&&t.classList.add(this.value)}},Ps:function(){if("age"===tool){document.body.className="age";const t=s("b-age");t&&t.classList.add("active"),s("age-legend")&&q.Hi()}else if("place"===tool){document.body.className="place";const t=s("b-places-colorise");t&&t.classList.add("active"),j.Ri()}}},K=F;window.toggleFanchartSort=()=>O.He(),window.toggleFanchartEventsDisplay=()=>O.Fe(),window.filterFanchartPlaces=t=>O.qe(t),window.clearFanchartSearch=()=>O.Ge(),window.toggleFanchartPlacesPanel=()=>document.body.classList.toggle("place"),J.init();