#ifdef API

(rule
  (deps lia_api_link_tree.piqi)
  (targets lia_api_link_tree_piqi.ml lia_api_link_tree_piqi_ext.ml)
  (action (run piqic-ocaml --ext lia_api_link_tree.piqi))
)

(library
  (name plugin_lia_lib)
  (public_name geneweb.plugin_lia_lib)
  (libraries geneweb geneweb.gwd_lib geneweb.util geneweb.plugin_api_lib)
  (preprocess (action (run %{bin:cppo} %%%CPPO_D%%% -V OCAML:%{ocaml_version} %{input-file})))
  (wrapped true)
  (modules
    lia_api_link
    lia_api_link_tree_piqi
    lia_api_link_tree_piqi_ext
    lia_lib
    lia_link
    lia_perso_link
  )
)

(executable
  (name plugin_lia)
  (libraries
    geneweb
    geneweb.gwd_lib
    geneweb.wserver
    plugin_lia_lib
  )
  (embed_in_plugin_libraries plugin_lia_lib)
  (preprocess (action (run %{bin:cppo} %%%CPPO_D%%% -V OCAML:%{ocaml_version} %{input-file})))
  (flags (:standard -w -40-27))
  (modes (native plugin))
  (modules plugin_lia)
)

(alias (name plugin) (deps (source_tree assets) plugin_lia.cmxs))

#endif
